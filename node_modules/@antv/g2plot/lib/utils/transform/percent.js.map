{"version":3,"file":"percent.js","sourceRoot":"","sources":["../../../src/utils/transform/percent.ts"],"names":[],"mappings":";;;;AAAA,mCAAwD;AAGxD,SAAS,KAAK,CAAC,IAAS,EAAE,IAAwB;IAChD,OAAO,aAAM,CACX,IAAI,EACJ,UAAC,CAAS,EAAE,CAAM;QAChB,OAAO,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC,EACD,CAAC,CACF,CAAC;AACJ,CAAC;AAED;;;;;;GAMG;AACH,SAAgB,OAAO,CAAC,IAAU,EAAE,OAAe,EAAE,UAAkB,EAAE,EAAU;IACjF,uBAAuB;IACvB,IAAM,WAAW,GAAG,cAAO,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;IAE9C,IAAM,MAAM,GAAG,EAAE,CAAC;IAClB,WAAI,CAAC,WAAW,EAAE,UAAC,CAAO;QACxB,IAAM,KAAK,GAAG,KAAK,CAAC,CAAC,EAAE,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,OAAO,CAAC,EAAV,CAAU,CAAC,CAAC;QAE1C,IAAM,UAAU,GAAG,UAAG,CAAC,CAAC,EAAE,UAAC,CAAC;;YAAK,OAAA,uCAC5B,CAAC,gBACH,EAAE,IAAG,CAAC,CAAC,OAAO,CAAC,GAAG,KAAK,OACxB;QAH+B,CAG/B,CAAC,CAAC;QAEJ,MAAM,CAAC,IAAI,OAAX,MAAM,EAAS,UAAU,EAAE;IAC7B,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAChB,CAAC;AAjBD,0BAiBC","sourcesContent":["import { groupBy, map, reduce, each } from '@antv/util';\nimport { Data } from '../../types';\n\nfunction sumBy(data: any, func: (d: any) => number): number {\n  return reduce(\n    data,\n    (r: number, d: any) => {\n      return (r += func(d));\n    },\n    0\n  );\n}\n\n/**\n * 对数据进行百分比化\n * @param data\n * @param measure\n * @param groupField\n * @param as\n */\nexport function percent(data: Data, measure: string, groupField: string, as: string) {\n  // 1. 首先根据 dimension 分组\n  const groupedData = groupBy(data, groupField);\n\n  const result = [];\n  each(groupedData, (v: Data) => {\n    const total = sumBy(v, (o) => o[measure]);\n\n    const percentage = map(v, (o) => ({\n      ...o,\n      [as]: o[measure] / total,\n    }));\n\n    result.push(...percentage);\n  });\n\n  return result;\n}\n"]}