{"ast":null,"code":"import { reduce, get } from '@antv/util';\nimport { getLegendItems } from '@antv/g2/lib/util/legend';\nimport { findGeometry } from '../../../utils';\nimport { isLine } from './option';\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\n\nexport function getViewLegendItems(params) {\n  var view = params.view,\n      geometryOption = params.geometryOption,\n      yField = params.yField,\n      legend = params.legend;\n  var userMarker = get(legend, 'marker');\n  var geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n\n  if (!geometryOption.seriesField) {\n    // 返回 g2 设置的图例\n    var colorAttribute = geometry.getAttribute('color');\n    var color = colorAttribute.values[0];\n    var marker = userMarker || (isLine(geometryOption) ? {\n      symbol: function (x, y, r) {\n        return [['M', x - r, y], ['L', x + r, y]];\n      },\n      style: {\n        lineWidth: 2,\n        r: 6,\n        stroke: color\n      }\n    } : {\n      symbol: 'square',\n      style: {\n        fill: color\n      }\n    });\n    return [{\n      value: yField,\n      name: get(view, \"options.scales.\" + yField + \".alias\") || yField,\n      marker: marker,\n      isGeometry: true,\n      viewId: view.id\n    }];\n  }\n\n  var attributes = geometry.getGroupAttributes();\n  return reduce(attributes, function (items, attr) {\n    var attrItems = getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n    return items.concat(attrItems);\n  }, []);\n}","map":{"version":3,"sources":["../../../../src/plots/dual-axes/util/legend.ts"],"names":[],"mappings":"AAAA,SAAS,MAAT,EAAiB,GAAjB,QAA4B,YAA5B;AAEA,SAAS,cAAT,QAA+B,0BAA/B;AACA,SAAS,YAAT,QAA6B,gBAA7B;AAGA,SAAS,MAAT,QAAuB,UAAvB;AAEA;;;AAGG;;AACH,OAAM,SAAU,kBAAV,CAA6B,MAA7B,EAKL;AACS,MAAA,IAAI,GAAqC,MAAM,CAA3C,IAAJ;AAAA,MAAM,cAAc,GAAqB,MAAM,CAA3B,cAApB;AAAA,MAAsB,MAAM,GAAa,MAAM,CAAnB,MAA5B;AAAA,MAA8B,MAAM,GAAK,MAAM,CAAX,MAApC;AACR,MAAM,UAAU,GAAG,GAAG,CAAC,MAAD,EAAS,QAAT,CAAtB;AACA,MAAM,QAAQ,GAAG,YAAY,CAAC,IAAD,EAAO,MAAM,CAAC,cAAD,CAAN,GAAyB,MAAzB,GAAkC,UAAzC,CAA7B;;AACA,MAAI,CAAC,cAAc,CAAC,WAApB,EAAiC;AAC/B;AACA,QAAM,cAAc,GAAG,QAAQ,CAAC,YAAT,CAAsB,OAAtB,CAAvB;AACA,QAAM,KAAK,GAAG,cAAc,CAAC,MAAf,CAAsB,CAAtB,CAAd;AAEA,QAAM,MAAM,GACV,UAAU,KACT,MAAM,CAAC,cAAD,CAAN,GACG;AACE,MAAA,MAAM,EAAE,UAAC,CAAD,EAAY,CAAZ,EAAuB,CAAvB,EAAgC;AACtC,eAAO,CACL,CAAC,GAAD,EAAM,CAAC,GAAG,CAAV,EAAa,CAAb,CADK,EAEL,CAAC,GAAD,EAAM,CAAC,GAAG,CAAV,EAAa,CAAb,CAFK,CAAP;AAID,OANH;AAOE,MAAA,KAAK,EAAE;AACL,QAAA,SAAS,EAAE,CADN;AAEL,QAAA,CAAC,EAAE,CAFE;AAGL,QAAA,MAAM,EAAE;AAHH;AAPT,KADH,GAcG;AACE,MAAA,MAAM,EAAE,QADV;AAEE,MAAA,KAAK,EAAE;AACL,QAAA,IAAI,EAAE;AADD;AAFT,KAfM,CADZ;AAsBA,WAAO,CACL;AACE,MAAA,KAAK,EAAE,MADT;AAEE,MAAA,IAAI,EAAE,GAAG,CAAC,IAAD,EAAO,oBAAkB,MAAlB,GAAwB,QAA/B,CAAH,IAA+C,MAFvD;AAGE,MAAA,MAAM,EAAA,MAHR;AAIE,MAAA,UAAU,EAAE,IAJd;AAKE,MAAA,MAAM,EAAE,IAAI,CAAC;AALf,KADK,CAAP;AASD;;AAED,MAAM,UAAU,GAAG,QAAQ,CAAC,kBAAT,EAAnB;AACA,SAAO,MAAM,CACX,UADW,EAEX,UAAC,KAAD,EAAQ,IAAR,EAAY;AACV,QAAM,SAAS,GAAG,cAAc,CAAC,IAAD,EAAO,QAAP,EAAiB,IAAjB,EAAuB,IAAI,CAAC,QAAL,EAAvB,EAAwC,UAAxC,CAAhC;AACA,WAAO,KAAK,CAAC,MAAN,CAAa,SAAb,CAAP;AACD,GALU,EAMX,EANW,CAAb;AAQD","sourcesContent":["import { reduce, get } from '@antv/util';\nimport { View } from '@antv/g2';\nimport { getLegendItems } from '@antv/g2/lib/util/legend';\nimport { findGeometry } from '../../../utils';\nimport { GeometryOption } from '../types';\nimport { Legend } from '../../../types/legend';\nimport { isLine } from './option';\n\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\nexport function getViewLegendItems(params: {\n  view: View;\n  yField: string;\n  geometryOption: GeometryOption;\n  legend: Legend;\n}) {\n  const { view, geometryOption, yField, legend } = params;\n  const userMarker = get(legend, 'marker');\n  const geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n  if (!geometryOption.seriesField) {\n    // 返回 g2 设置的图例\n    const colorAttribute = geometry.getAttribute('color');\n    const color = colorAttribute.values[0];\n\n    const marker =\n      userMarker ||\n      (isLine(geometryOption)\n        ? {\n            symbol: (x: number, y: number, r: number) => {\n              return [\n                ['M', x - r, y],\n                ['L', x + r, y],\n              ];\n            },\n            style: {\n              lineWidth: 2,\n              r: 6,\n              stroke: color,\n            },\n          }\n        : {\n            symbol: 'square',\n            style: {\n              fill: color,\n            },\n          });\n    return [\n      {\n        value: yField,\n        name: get(view, `options.scales.${yField}.alias`) || yField,\n        marker,\n        isGeometry: true,\n        viewId: view.id,\n      },\n    ];\n  }\n\n  const attributes = geometry.getGroupAttributes();\n  return reduce(\n    attributes,\n    (items, attr) => {\n      const attrItems = getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n      return items.concat(attrItems);\n    },\n    []\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}