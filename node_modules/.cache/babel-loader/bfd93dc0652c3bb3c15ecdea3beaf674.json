{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { mix, isNumber, clone, isNil } from '@antv/util';\nimport Global from '../../global';\nimport Shape from '../shape';\nShape.registerCombo('rect', {\n  // 自定义 Combo 时的配置\n  options: {\n    size: [40, 5],\n    padding: [25, 20, 15, 20],\n    animate: true,\n    style: {\n      radius: 0,\n      stroke: Global.defaultCombo.style.stroke,\n      fill: Global.defaultCombo.style.fill,\n      lineWidth: Global.defaultCombo.style.lineWidth\n    },\n    // 文本样式配置\n    labelCfg: {\n      style: {\n        fill: Global.comboLabel.style.fill,\n        fontSize: Global.comboLabel.style.fontSize\n      }\n    },\n    // 连接点，默认为左右\n    anchorPoints: [[0, 0.5], [1, 0.5]],\n    stateStyles: __assign({}, Global.comboStateStyles)\n  },\n  shapeType: 'rect',\n  labelPosition: 'top',\n  drawShape: function drawShape(cfg, group) {\n    var style = this.getShapeStyle(cfg);\n    var keyShape = group.addShape('rect', {\n      attrs: style,\n      className: 'rect-combo',\n      name: 'rect-combo',\n      draggable: true\n    });\n    return keyShape;\n  },\n  // 私有方法，不希望扩展的 Combo 复写这个方法\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg) {\n    var labelPosition = labelCfg.position || this.labelPosition;\n    var cfgStyle = cfg.style;\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var refX = labelCfg.refX,\n        refY = labelCfg.refY; // 考虑 refX 和 refY = 0 的场景，不用用 labelCfg.refX || Global.nodeLabel.refY\n\n    if (isNil(refX)) {\n      refX = this.refX; // 不居中时的偏移量\n    }\n\n    if (isNil(refY)) {\n      refY = this.refY; // 不居中时的偏移量\n    }\n\n    var leftDis = cfgStyle.width / 2 + padding[3];\n    var topDis = cfgStyle.height / 2 + padding[0];\n    var style;\n\n    switch (labelPosition) {\n      case 'top':\n        style = {\n          x: 0 - leftDis + refX,\n          y: 0 - topDis + refY,\n          textBaseline: 'top',\n          textAlign: 'left'\n        };\n        break;\n\n      case 'bottom':\n        style = {\n          x: 0,\n          y: topDis + refY,\n          textBaseline: 'bottom',\n          textAlign: 'center'\n        };\n        break;\n\n      case 'left':\n        style = {\n          x: 0 - leftDis + refY,\n          y: 0,\n          textAlign: 'left'\n        };\n        break;\n\n      case 'center':\n        style = {\n          x: 0,\n          y: 0,\n          text: cfg.label,\n          textAlign: 'center'\n        };\n        break;\n\n      default:\n        style = {\n          x: leftDis + refX,\n          y: 0,\n          textAlign: 'right'\n        };\n        break;\n    }\n\n    style.text = cfg.label;\n    return style;\n  },\n\n  /**\n   * 获取节点的样式，供基于该节点自定义时使用\n   * @param {Object} cfg 节点数据模型\n   * @return {Object} 节点的样式\n   */\n  getShapeStyle: function getShapeStyle(cfg) {\n    var defaultStyle = this.options.style;\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 如果设置了color，则覆盖默认的stroke属性\n\n    var style = mix({}, defaultStyle, strokeStyle, cfg.style);\n    var size = this.getSize(cfg);\n    var width;\n    var height;\n    if (!isNumber(style.width) || isNaN(style.width)) width = size[0] || Global.defaultCombo.style.width;else width = Math.max(style.width, size[0]) || size[0];\n    if (!isNumber(style.height) || isNaN(style.height)) height = size[1] || Global.defaultCombo.style.height;else height = Math.max(style.height, size[1]) || size[1];\n    var x = -width / 2 - padding[3];\n    var y = -height / 2 - padding[0];\n    style.width = width + padding[1] + padding[3];\n    style.height = height + padding[0] + padding[2];\n\n    var styles = __assign({\n      x: x,\n      y: y\n    }, style);\n\n    if (!cfg.style) {\n      cfg.style = {\n        width: width,\n        height: height\n      };\n    } else {\n      cfg.style.width = width;\n      cfg.style.height = height;\n    }\n\n    return styles;\n  },\n  update: function update(cfg, item) {\n    var size = this.getSize(cfg);\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var cfgStyle = clone(cfg.style);\n    var width = Math.max(cfgStyle.width, size[0]) || size[0];\n    var height = Math.max(cfgStyle.height, size[1]) || size[1];\n    cfgStyle.width = width + padding[1] + padding[3];\n    cfgStyle.height = height + padding[0] + padding[2];\n    var itemCacheSize = item.get('sizeCache');\n\n    if (itemCacheSize) {\n      itemCacheSize.width = cfgStyle.width;\n      itemCacheSize.height = cfgStyle.height;\n    }\n\n    cfgStyle.x = -width / 2 - padding[3];\n    cfgStyle.y = -height / 2 - padding[0]; // 下面这些属性需要覆盖默认样式与目前样式，但若在 cfg 中有指定则应该被 cfg 的相应配置覆盖。\n\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 与 getShapeStyle 不同在于，update 时需要获取到当前的 style 进行融合。即新传入的配置项中没有涉及的属性，保留当前的配置。\n\n    var keyShape = item.get('keyShape');\n    var style = mix({}, keyShape.attr(), strokeStyle, cfgStyle);\n\n    if (cfg.style) {\n      cfg.style.width = width;\n      cfg.style.height = height;\n    } else {\n      cfg.style = {\n        width: width,\n        height: height\n      };\n    }\n\n    this.updateShape(cfg, item, style, false);\n  },\n  updateShape: function updateShape(cfg, item, keyShapeStyle) {\n    var keyShape = item.get('keyShape');\n    var animate = cfg.animate === undefined ? this.options.animate : cfg.animate;\n\n    if (animate && keyShape.animate) {\n      keyShape.animate(keyShapeStyle, {\n        duration: 200,\n        easing: 'easeLinear'\n      });\n    } else {\n      keyShape.attr(__assign({}, keyShapeStyle));\n    }\n\n    this.updateLabel(cfg, item);\n  }\n}, 'single-combo');","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/shape/combos/rect.js"],"names":["__assign","mix","isNumber","clone","isNil","Global","Shape","registerCombo","options","size","padding","animate","style","radius","stroke","defaultCombo","fill","lineWidth","labelCfg","comboLabel","fontSize","anchorPoints","stateStyles","comboStateStyles","shapeType","labelPosition","drawShape","cfg","group","getShapeStyle","keyShape","addShape","attrs","className","name","draggable","getLabelStyleByPosition","position","cfgStyle","refX","refY","leftDis","width","topDis","height","x","y","textBaseline","textAlign","text","label","defaultStyle","strokeStyle","color","getSize","isNaN","Math","max","styles","update","item","itemCacheSize","get","attr","updateShape","keyShapeStyle","undefined","duration","easing","updateLabel"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { mix, isNumber, clone, isNil } from '@antv/util';\nimport Global from '../../global';\nimport Shape from '../shape';\nShape.registerCombo('rect', {\n  // 自定义 Combo 时的配置\n  options: {\n    size: [40, 5],\n    padding: [25, 20, 15, 20],\n    animate: true,\n    style: {\n      radius: 0,\n      stroke: Global.defaultCombo.style.stroke,\n      fill: Global.defaultCombo.style.fill,\n      lineWidth: Global.defaultCombo.style.lineWidth\n    },\n    // 文本样式配置\n    labelCfg: {\n      style: {\n        fill: Global.comboLabel.style.fill,\n        fontSize: Global.comboLabel.style.fontSize\n      }\n    },\n    // 连接点，默认为左右\n    anchorPoints: [[0, 0.5], [1, 0.5]],\n    stateStyles: __assign({}, Global.comboStateStyles)\n  },\n  shapeType: 'rect',\n  labelPosition: 'top',\n  drawShape: function drawShape(cfg, group) {\n    var style = this.getShapeStyle(cfg);\n    var keyShape = group.addShape('rect', {\n      attrs: style,\n      className: 'rect-combo',\n      name: 'rect-combo',\n      draggable: true\n    });\n    return keyShape;\n  },\n  // 私有方法，不希望扩展的 Combo 复写这个方法\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg) {\n    var labelPosition = labelCfg.position || this.labelPosition;\n    var cfgStyle = cfg.style;\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var refX = labelCfg.refX,\n        refY = labelCfg.refY; // 考虑 refX 和 refY = 0 的场景，不用用 labelCfg.refX || Global.nodeLabel.refY\n\n    if (isNil(refX)) {\n      refX = this.refX; // 不居中时的偏移量\n    }\n\n    if (isNil(refY)) {\n      refY = this.refY; // 不居中时的偏移量\n    }\n\n    var leftDis = cfgStyle.width / 2 + padding[3];\n    var topDis = cfgStyle.height / 2 + padding[0];\n    var style;\n\n    switch (labelPosition) {\n      case 'top':\n        style = {\n          x: 0 - leftDis + refX,\n          y: 0 - topDis + refY,\n          textBaseline: 'top',\n          textAlign: 'left'\n        };\n        break;\n\n      case 'bottom':\n        style = {\n          x: 0,\n          y: topDis + refY,\n          textBaseline: 'bottom',\n          textAlign: 'center'\n        };\n        break;\n\n      case 'left':\n        style = {\n          x: 0 - leftDis + refY,\n          y: 0,\n          textAlign: 'left'\n        };\n        break;\n\n      case 'center':\n        style = {\n          x: 0,\n          y: 0,\n          text: cfg.label,\n          textAlign: 'center'\n        };\n        break;\n\n      default:\n        style = {\n          x: leftDis + refX,\n          y: 0,\n          textAlign: 'right'\n        };\n        break;\n    }\n\n    style.text = cfg.label;\n    return style;\n  },\n\n  /**\n   * 获取节点的样式，供基于该节点自定义时使用\n   * @param {Object} cfg 节点数据模型\n   * @return {Object} 节点的样式\n   */\n  getShapeStyle: function getShapeStyle(cfg) {\n    var defaultStyle = this.options.style;\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 如果设置了color，则覆盖默认的stroke属性\n\n    var style = mix({}, defaultStyle, strokeStyle, cfg.style);\n    var size = this.getSize(cfg);\n    var width;\n    var height;\n    if (!isNumber(style.width) || isNaN(style.width)) width = size[0] || Global.defaultCombo.style.width;else width = Math.max(style.width, size[0]) || size[0];\n    if (!isNumber(style.height) || isNaN(style.height)) height = size[1] || Global.defaultCombo.style.height;else height = Math.max(style.height, size[1]) || size[1];\n    var x = -width / 2 - padding[3];\n    var y = -height / 2 - padding[0];\n    style.width = width + padding[1] + padding[3];\n    style.height = height + padding[0] + padding[2];\n\n    var styles = __assign({\n      x: x,\n      y: y\n    }, style);\n\n    if (!cfg.style) {\n      cfg.style = {\n        width: width,\n        height: height\n      };\n    } else {\n      cfg.style.width = width;\n      cfg.style.height = height;\n    }\n\n    return styles;\n  },\n  update: function update(cfg, item) {\n    var size = this.getSize(cfg);\n    var padding = cfg.padding || this.options.padding;\n    if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var cfgStyle = clone(cfg.style);\n    var width = Math.max(cfgStyle.width, size[0]) || size[0];\n    var height = Math.max(cfgStyle.height, size[1]) || size[1];\n    cfgStyle.width = width + padding[1] + padding[3];\n    cfgStyle.height = height + padding[0] + padding[2];\n    var itemCacheSize = item.get('sizeCache');\n\n    if (itemCacheSize) {\n      itemCacheSize.width = cfgStyle.width;\n      itemCacheSize.height = cfgStyle.height;\n    }\n\n    cfgStyle.x = -width / 2 - padding[3];\n    cfgStyle.y = -height / 2 - padding[0]; // 下面这些属性需要覆盖默认样式与目前样式，但若在 cfg 中有指定则应该被 cfg 的相应配置覆盖。\n\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 与 getShapeStyle 不同在于，update 时需要获取到当前的 style 进行融合。即新传入的配置项中没有涉及的属性，保留当前的配置。\n\n    var keyShape = item.get('keyShape');\n    var style = mix({}, keyShape.attr(), strokeStyle, cfgStyle);\n\n    if (cfg.style) {\n      cfg.style.width = width;\n      cfg.style.height = height;\n    } else {\n      cfg.style = {\n        width: width,\n        height: height\n      };\n    }\n\n    this.updateShape(cfg, item, style, false);\n  },\n  updateShape: function updateShape(cfg, item, keyShapeStyle) {\n    var keyShape = item.get('keyShape');\n    var animate = cfg.animate === undefined ? this.options.animate : cfg.animate;\n\n    if (animate && keyShape.animate) {\n      keyShape.animate(keyShapeStyle, {\n        duration: 200,\n        easing: 'easeLinear'\n      });\n    } else {\n      keyShape.attr(__assign({}, keyShapeStyle));\n    }\n\n    this.updateLabel(cfg, item);\n  }\n}, 'single-combo');"]},"metadata":{},"sourceType":"module"}