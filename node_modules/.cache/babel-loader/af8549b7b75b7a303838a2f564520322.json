{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isArray, isNil, mix } from '@antv/util';\nimport { formatPadding } from '../util/base';\nimport Global from '../global';\nimport Shape from './shape';\nimport { shapeBase } from './shapeBase';\nvar singleNode = {\n  itemType: 'node',\n  // 单个图形的类型\n  shapeType: 'single-node',\n\n  /**\n   * 文本相对图形的位置，默认以中心点\n   * 位置包括： top, bottom, left, right, center\n   * @type {String}\n   */\n  labelPosition: 'center',\n\n  /**\n   * 文本相对偏移，当 labelPosition 不为 center 时有效\n   * @type {Number}\n   */\n  offset: Global.nodeLabel.offset,\n\n  /**\n   * 获取节点宽高\n   * @internal 返回节点的大小，以 [width, height] 的方式维护\n   * @param  {Object} cfg 节点的配置项\n   * @return {Array} 宽高\n   */\n  getSize: function getSize(cfg) {\n    var size = cfg.size || this.getOptions({}).size || Global.defaultNode.size; // size 是数组，但长度为1，则补长度为2\n\n    if (isArray(size) && size.length === 1) {\n      size = [size[0], size[0]];\n    } // size 为数字，则转换为数组\n\n\n    if (!isArray(size)) {\n      size = [size, size];\n    }\n\n    return size;\n  },\n  // 私有方法，不希望扩展的节点复写这个方法\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg) {\n    var labelPosition = labelCfg.position || this.labelPosition; // 默认的位置（最可能的情形），所以放在最上面\n\n    if (labelPosition === 'center') {\n      return {\n        x: 0,\n        y: 0,\n        text: cfg.label\n      };\n    }\n\n    var offset = labelCfg.offset;\n\n    if (isNil(offset)) {\n      // 考虑 offset = 0 的场景，不用用 labelCfg.offset || Global.nodeLabel.offset\n      offset = this.offset; // 不居中时的偏移量\n    }\n\n    var size = this.getSize(cfg);\n    var width = size[0];\n    var height = size[1];\n    var style;\n\n    switch (labelPosition) {\n      case 'top':\n        style = {\n          x: 0,\n          y: 0 - height / 2 - offset,\n          textBaseline: 'bottom'\n        };\n        break;\n\n      case 'bottom':\n        style = {\n          x: 0,\n          y: height / 2 + offset,\n          textBaseline: 'top'\n        };\n        break;\n\n      case 'left':\n        style = {\n          x: 0 - width / 2 - offset,\n          y: 0,\n          textAlign: 'right'\n        };\n        break;\n\n      default:\n        style = {\n          x: width / 2 + offset,\n          y: 0,\n          textAlign: 'left'\n        };\n        break;\n    }\n\n    style.text = cfg.label;\n    return style;\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, cfg, labelCfg, group) {\n    if (!label) {\n      return {};\n    }\n\n    var bbox = label.getBBox();\n    var backgroundStyle = labelCfg.style && labelCfg.style.background;\n\n    if (!backgroundStyle) {\n      return {};\n    }\n\n    var padding = formatPadding(backgroundStyle.padding);\n    var backgroundWidth = bbox.width + padding[1] + padding[3];\n    var backgroundHeight = bbox.height + padding[0] + padding[2];\n    var offset = labelCfg.offset;\n\n    if (isNil(offset)) {\n      // 考虑 offset = 0 的场景，不用用 labelCfg.offset || Global.nodeLabel.offset\n      offset = this.offset; // 不居中时的偏移量\n    }\n\n    var style;\n    style = {\n      x: bbox.minX - padding[3],\n      y: bbox.minY - padding[0]\n    };\n    style = __assign(__assign(__assign({}, style), backgroundStyle), {\n      width: backgroundWidth,\n      height: backgroundHeight\n    });\n    return style;\n  },\n  drawShape: function drawShape(cfg, group) {\n    var shapeType = this.shapeType; // || this.type，都已经加了 shapeType\n\n    var style = this.getShapeStyle(cfg);\n    var shape = group.addShape(shapeType, {\n      attrs: style,\n      draggable: true,\n      name: 'node-shape'\n    });\n    return shape;\n  },\n\n  /**\n   * 更新linkPoints\n   * @param {Object} cfg 节点数据配置项\n   * @param {Group} group Item所在的group\n   */\n  updateLinkPoints: function updateLinkPoints(cfg, group) {\n    var defaultLinkPoints = this.getOptions(cfg).linkPoints;\n    var markLeft = group.find(function (element) {\n      return element.get('className') === 'link-point-left';\n    });\n    var markRight = group.find(function (element) {\n      return element.get('className') === 'link-point-right';\n    });\n    var markTop = group.find(function (element) {\n      return element.get('className') === 'link-point-top';\n    });\n    var markBottom = group.find(function (element) {\n      return element.get('className') === 'link-point-bottom';\n    });\n    var currentLinkPoints;\n\n    if (markLeft) {\n      currentLinkPoints = markLeft.attr();\n    }\n\n    if (markRight && !currentLinkPoints) {\n      currentLinkPoints = markRight.attr();\n    }\n\n    if (markTop && !currentLinkPoints) {\n      currentLinkPoints = markTop.attr();\n    }\n\n    if (markBottom && !currentLinkPoints) {\n      currentLinkPoints = markBottom.attr();\n    }\n\n    if (!currentLinkPoints) currentLinkPoints = defaultLinkPoints;\n    var linkPoints = mix({}, currentLinkPoints, cfg.linkPoints);\n    var markFill = linkPoints.fill,\n        markStroke = linkPoints.stroke,\n        borderWidth = linkPoints.lineWidth;\n    var markSize = linkPoints.size / 2;\n    if (!markSize) markSize = linkPoints.r;\n\n    var _a = cfg.linkPoints ? cfg.linkPoints : {\n      left: undefined,\n      right: undefined,\n      top: undefined,\n      bottom: undefined\n    },\n        left = _a.left,\n        right = _a.right,\n        top = _a.top,\n        bottom = _a.bottom;\n\n    var size = this.getSize(cfg);\n    var width = size[0];\n    var height = size[1];\n    var styles = {\n      r: markSize,\n      fill: markFill,\n      stroke: markStroke,\n      lineWidth: borderWidth\n    };\n\n    if (markLeft) {\n      if (!left && left !== undefined) {\n        markLeft.remove();\n      } else {\n        markLeft.attr(__assign(__assign({}, styles), {\n          x: -width / 2,\n          y: 0\n        }));\n      }\n    } else if (left) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: -width / 2,\n          y: 0\n        }),\n        className: 'link-point-left',\n        name: 'link-point-left',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markRight) {\n      if (!right && right !== undefined) {\n        markRight.remove();\n      }\n\n      markRight.attr(__assign(__assign({}, styles), {\n        x: width / 2,\n        y: 0\n      }));\n    } else if (right) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: width / 2,\n          y: 0\n        }),\n        className: 'link-point-right',\n        name: 'link-point-right',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markTop) {\n      if (!top && top !== undefined) {\n        markTop.remove();\n      }\n\n      markTop.attr(__assign(__assign({}, styles), {\n        x: 0,\n        y: -height / 2\n      }));\n    } else if (top) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: 0,\n          y: -height / 2\n        }),\n        className: 'link-point-top',\n        name: 'link-point-top',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markBottom) {\n      if (!bottom && bottom !== undefined) {\n        markBottom.remove();\n      } else {\n        markBottom.attr(__assign(__assign({}, styles), {\n          x: 0,\n          y: height / 2\n        }));\n      }\n    } else if (bottom) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: 0,\n          y: height / 2\n        }),\n        className: 'link-point-bottom',\n        name: 'link-point-bottom',\n        isAnchorPoint: true\n      });\n    }\n  },\n  updateShape: function updateShape(cfg, item, keyShapeStyle, hasIcon) {\n    var keyShape = item.get('keyShape');\n    keyShape.attr(__assign({}, keyShapeStyle));\n    this.updateLabel(cfg, item); // special for some types of nodes\n\n    if (hasIcon) {\n      this.updateIcon(cfg, item);\n    }\n  },\n  updateIcon: function updateIcon(cfg, item) {\n    var _this = this;\n\n    var group = item.getContainer();\n    var icon = this.getOptions(cfg).icon;\n    var show = (cfg.icon ? cfg.icon : {\n      show: undefined\n    }).show;\n    var iconShape = group.find(function (element) {\n      return element.get('className') === _this.type + \"-icon\";\n    });\n\n    if (iconShape) {\n      // 若原先存在 icon\n      if (show || show === undefined) {\n        // 若传入 show: true, 或没有设置，则更新原有的 icon 样式\n        var iconConfig = mix({}, iconShape.attr(), icon);\n        var w = iconConfig.width,\n            h = iconConfig.height;\n        iconShape.attr(__assign(__assign({}, iconConfig), {\n          x: -w / 2,\n          y: -h / 2\n        }));\n      } else {\n        // 若传入了 show: false 则删除原先的 icon\n        iconShape.remove();\n      }\n    } else if (show) {\n      // 如果原先不存在 icon，但传入了 show: true，则新增 icon\n      var w = icon.width,\n          h = icon.height;\n      group.addShape('image', {\n        attrs: __assign(__assign({}, icon), {\n          x: -w / 2,\n          y: -h / 2\n        }),\n        className: this.type + \"-icon\",\n        name: this.type + \"-icon\"\n      }); // to ensure the label is on the top of all the shapes\n\n      var labelShape = group.find(function (element) {\n        return element.get('className') === \"node-label\";\n      });\n\n      if (labelShape) {\n        labelShape.toFront();\n      }\n    }\n  }\n};\n\nvar singleNodeDef = __assign(__assign({}, shapeBase), singleNode);\n\nShape.registerNode('single-node', singleNodeDef);","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/shape/node.js"],"names":["__assign","isArray","isNil","mix","formatPadding","Global","Shape","shapeBase","singleNode","itemType","shapeType","labelPosition","offset","nodeLabel","getSize","cfg","size","getOptions","defaultNode","length","getLabelStyleByPosition","labelCfg","position","x","y","text","label","width","height","style","textBaseline","textAlign","getLabelBgStyleByPosition","group","bbox","getBBox","backgroundStyle","background","padding","backgroundWidth","backgroundHeight","minX","minY","drawShape","getShapeStyle","shape","addShape","attrs","draggable","name","updateLinkPoints","defaultLinkPoints","linkPoints","markLeft","find","element","get","markRight","markTop","markBottom","currentLinkPoints","attr","markFill","fill","markStroke","stroke","borderWidth","lineWidth","markSize","r","_a","left","undefined","right","top","bottom","styles","remove","className","isAnchorPoint","updateShape","item","keyShapeStyle","hasIcon","keyShape","updateLabel","updateIcon","_this","getContainer","icon","show","iconShape","type","iconConfig","w","h","labelShape","toFront","singleNodeDef","registerNode"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { isArray, isNil, mix } from '@antv/util';\nimport { formatPadding } from '../util/base';\nimport Global from '../global';\nimport Shape from './shape';\nimport { shapeBase } from './shapeBase';\nvar singleNode = {\n  itemType: 'node',\n  // 单个图形的类型\n  shapeType: 'single-node',\n\n  /**\n   * 文本相对图形的位置，默认以中心点\n   * 位置包括： top, bottom, left, right, center\n   * @type {String}\n   */\n  labelPosition: 'center',\n\n  /**\n   * 文本相对偏移，当 labelPosition 不为 center 时有效\n   * @type {Number}\n   */\n  offset: Global.nodeLabel.offset,\n\n  /**\n   * 获取节点宽高\n   * @internal 返回节点的大小，以 [width, height] 的方式维护\n   * @param  {Object} cfg 节点的配置项\n   * @return {Array} 宽高\n   */\n  getSize: function getSize(cfg) {\n    var size = cfg.size || this.getOptions({}).size || Global.defaultNode.size; // size 是数组，但长度为1，则补长度为2\n\n    if (isArray(size) && size.length === 1) {\n      size = [size[0], size[0]];\n    } // size 为数字，则转换为数组\n\n\n    if (!isArray(size)) {\n      size = [size, size];\n    }\n\n    return size;\n  },\n  // 私有方法，不希望扩展的节点复写这个方法\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg) {\n    var labelPosition = labelCfg.position || this.labelPosition; // 默认的位置（最可能的情形），所以放在最上面\n\n    if (labelPosition === 'center') {\n      return {\n        x: 0,\n        y: 0,\n        text: cfg.label\n      };\n    }\n\n    var offset = labelCfg.offset;\n\n    if (isNil(offset)) {\n      // 考虑 offset = 0 的场景，不用用 labelCfg.offset || Global.nodeLabel.offset\n      offset = this.offset; // 不居中时的偏移量\n    }\n\n    var size = this.getSize(cfg);\n    var width = size[0];\n    var height = size[1];\n    var style;\n\n    switch (labelPosition) {\n      case 'top':\n        style = {\n          x: 0,\n          y: 0 - height / 2 - offset,\n          textBaseline: 'bottom'\n        };\n        break;\n\n      case 'bottom':\n        style = {\n          x: 0,\n          y: height / 2 + offset,\n          textBaseline: 'top'\n        };\n        break;\n\n      case 'left':\n        style = {\n          x: 0 - width / 2 - offset,\n          y: 0,\n          textAlign: 'right'\n        };\n        break;\n\n      default:\n        style = {\n          x: width / 2 + offset,\n          y: 0,\n          textAlign: 'left'\n        };\n        break;\n    }\n\n    style.text = cfg.label;\n    return style;\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, cfg, labelCfg, group) {\n    if (!label) {\n      return {};\n    }\n\n    var bbox = label.getBBox();\n    var backgroundStyle = labelCfg.style && labelCfg.style.background;\n\n    if (!backgroundStyle) {\n      return {};\n    }\n\n    var padding = formatPadding(backgroundStyle.padding);\n    var backgroundWidth = bbox.width + padding[1] + padding[3];\n    var backgroundHeight = bbox.height + padding[0] + padding[2];\n    var offset = labelCfg.offset;\n\n    if (isNil(offset)) {\n      // 考虑 offset = 0 的场景，不用用 labelCfg.offset || Global.nodeLabel.offset\n      offset = this.offset; // 不居中时的偏移量\n    }\n\n    var style;\n    style = {\n      x: bbox.minX - padding[3],\n      y: bbox.minY - padding[0]\n    };\n    style = __assign(__assign(__assign({}, style), backgroundStyle), {\n      width: backgroundWidth,\n      height: backgroundHeight\n    });\n    return style;\n  },\n  drawShape: function drawShape(cfg, group) {\n    var shapeType = this.shapeType; // || this.type，都已经加了 shapeType\n\n    var style = this.getShapeStyle(cfg);\n    var shape = group.addShape(shapeType, {\n      attrs: style,\n      draggable: true,\n      name: 'node-shape'\n    });\n    return shape;\n  },\n\n  /**\n   * 更新linkPoints\n   * @param {Object} cfg 节点数据配置项\n   * @param {Group} group Item所在的group\n   */\n  updateLinkPoints: function updateLinkPoints(cfg, group) {\n    var defaultLinkPoints = this.getOptions(cfg).linkPoints;\n    var markLeft = group.find(function (element) {\n      return element.get('className') === 'link-point-left';\n    });\n    var markRight = group.find(function (element) {\n      return element.get('className') === 'link-point-right';\n    });\n    var markTop = group.find(function (element) {\n      return element.get('className') === 'link-point-top';\n    });\n    var markBottom = group.find(function (element) {\n      return element.get('className') === 'link-point-bottom';\n    });\n    var currentLinkPoints;\n\n    if (markLeft) {\n      currentLinkPoints = markLeft.attr();\n    }\n\n    if (markRight && !currentLinkPoints) {\n      currentLinkPoints = markRight.attr();\n    }\n\n    if (markTop && !currentLinkPoints) {\n      currentLinkPoints = markTop.attr();\n    }\n\n    if (markBottom && !currentLinkPoints) {\n      currentLinkPoints = markBottom.attr();\n    }\n\n    if (!currentLinkPoints) currentLinkPoints = defaultLinkPoints;\n    var linkPoints = mix({}, currentLinkPoints, cfg.linkPoints);\n    var markFill = linkPoints.fill,\n        markStroke = linkPoints.stroke,\n        borderWidth = linkPoints.lineWidth;\n    var markSize = linkPoints.size / 2;\n    if (!markSize) markSize = linkPoints.r;\n\n    var _a = cfg.linkPoints ? cfg.linkPoints : {\n      left: undefined,\n      right: undefined,\n      top: undefined,\n      bottom: undefined\n    },\n        left = _a.left,\n        right = _a.right,\n        top = _a.top,\n        bottom = _a.bottom;\n\n    var size = this.getSize(cfg);\n    var width = size[0];\n    var height = size[1];\n    var styles = {\n      r: markSize,\n      fill: markFill,\n      stroke: markStroke,\n      lineWidth: borderWidth\n    };\n\n    if (markLeft) {\n      if (!left && left !== undefined) {\n        markLeft.remove();\n      } else {\n        markLeft.attr(__assign(__assign({}, styles), {\n          x: -width / 2,\n          y: 0\n        }));\n      }\n    } else if (left) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: -width / 2,\n          y: 0\n        }),\n        className: 'link-point-left',\n        name: 'link-point-left',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markRight) {\n      if (!right && right !== undefined) {\n        markRight.remove();\n      }\n\n      markRight.attr(__assign(__assign({}, styles), {\n        x: width / 2,\n        y: 0\n      }));\n    } else if (right) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: width / 2,\n          y: 0\n        }),\n        className: 'link-point-right',\n        name: 'link-point-right',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markTop) {\n      if (!top && top !== undefined) {\n        markTop.remove();\n      }\n\n      markTop.attr(__assign(__assign({}, styles), {\n        x: 0,\n        y: -height / 2\n      }));\n    } else if (top) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: 0,\n          y: -height / 2\n        }),\n        className: 'link-point-top',\n        name: 'link-point-top',\n        isAnchorPoint: true\n      });\n    }\n\n    if (markBottom) {\n      if (!bottom && bottom !== undefined) {\n        markBottom.remove();\n      } else {\n        markBottom.attr(__assign(__assign({}, styles), {\n          x: 0,\n          y: height / 2\n        }));\n      }\n    } else if (bottom) {\n      group.addShape('circle', {\n        attrs: __assign(__assign({}, styles), {\n          x: 0,\n          y: height / 2\n        }),\n        className: 'link-point-bottom',\n        name: 'link-point-bottom',\n        isAnchorPoint: true\n      });\n    }\n  },\n  updateShape: function updateShape(cfg, item, keyShapeStyle, hasIcon) {\n    var keyShape = item.get('keyShape');\n    keyShape.attr(__assign({}, keyShapeStyle));\n    this.updateLabel(cfg, item); // special for some types of nodes\n\n    if (hasIcon) {\n      this.updateIcon(cfg, item);\n    }\n  },\n  updateIcon: function updateIcon(cfg, item) {\n    var _this = this;\n\n    var group = item.getContainer();\n    var icon = this.getOptions(cfg).icon;\n    var show = (cfg.icon ? cfg.icon : {\n      show: undefined\n    }).show;\n    var iconShape = group.find(function (element) {\n      return element.get('className') === _this.type + \"-icon\";\n    });\n\n    if (iconShape) {\n      // 若原先存在 icon\n      if (show || show === undefined) {\n        // 若传入 show: true, 或没有设置，则更新原有的 icon 样式\n        var iconConfig = mix({}, iconShape.attr(), icon);\n        var w = iconConfig.width,\n            h = iconConfig.height;\n        iconShape.attr(__assign(__assign({}, iconConfig), {\n          x: -w / 2,\n          y: -h / 2\n        }));\n      } else {\n        // 若传入了 show: false 则删除原先的 icon\n        iconShape.remove();\n      }\n    } else if (show) {\n      // 如果原先不存在 icon，但传入了 show: true，则新增 icon\n      var w = icon.width,\n          h = icon.height;\n      group.addShape('image', {\n        attrs: __assign(__assign({}, icon), {\n          x: -w / 2,\n          y: -h / 2\n        }),\n        className: this.type + \"-icon\",\n        name: this.type + \"-icon\"\n      }); // to ensure the label is on the top of all the shapes\n\n      var labelShape = group.find(function (element) {\n        return element.get('className') === \"node-label\";\n      });\n\n      if (labelShape) {\n        labelShape.toFront();\n      }\n    }\n  }\n};\n\nvar singleNodeDef = __assign(__assign({}, shapeBase), singleNode);\n\nShape.registerNode('single-node', singleNodeDef);"]},"metadata":{},"sourceType":"module"}