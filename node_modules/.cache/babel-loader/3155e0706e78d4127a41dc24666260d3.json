{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { clone } from '@antv/util/lib';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0,\n      scaleRBy: 'unset',\n      scaleDBy: 'unset',\n      showDPercent: true\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  }; // Create the delegate when the trigger is drag\n\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var _this = this;\n\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate'); // drag to move the lens\n\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      }); // 绑定调整范围（r）和缩放系数(d)的监听\n      // 由于 drag 用于改变 lens 位置, 因此在此模式下, drag 不能用于调整 r 和 d\n      // scaling d\n\n      if (this.get('scaleDBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          _this.scaleDByWheel(evt);\n        });\n      } // scaling r\n\n\n      if (this.get('scaleRBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRByWheel(evt);\n        });\n      }\n    }\n  };\n  /**\n   * Scale the range by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleRByWheel = function (e) {\n    var self = this;\n    if (!e || !e.originalEvent) return;\n    if (e.preventDefault) e.preventDefault();\n    var graph = self.get('graph');\n    var ratio;\n    var lensDelegate = self.get('delegate');\n    var lensCenter = lensDelegate ? {\n      x: lensDelegate.attr('x'),\n      y: lensDelegate.attr('y')\n    } : undefined;\n    var mousePos = lensCenter || graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.set('delegateCenterDiff', undefined);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * Scale the range by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleRByDrag = function (e) {\n    var self = this;\n    if (!e) return;\n    var dragPrePos = self.get('dragPrePos');\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.x - dragPrePos.x < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Scale the magnifying factor by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleDByWheel = function (evt) {\n    var self = this;\n    if (!evt && !evt.originalEvent) return;\n    if (evt.preventDefault) evt.preventDefault();\n    var delta = 0;\n\n    if (evt.originalEvent.wheelDelta < 0) {\n      delta = -0.1;\n    } else {\n      delta = 0.1;\n    }\n\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      var lensDelegate = self.get('delegate');\n      var lensCenter = lensDelegate ? {\n        x: lensDelegate.attr('x'),\n        y: lensDelegate.attr('y')\n      } : undefined;\n      self.set('delegateCenterDiff', undefined);\n      self.magnify(evt, lensCenter);\n    }\n  };\n  /**\n   * Scale the magnifying factor by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleDByDrag = function (e) {\n    var self = this;\n    var dragPrePos = self.get('dragPrePos');\n    var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      self.magnify(e);\n    }\n\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Response function for mousemove, click, or drag to magnify\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * Restore the cache nodes while magnifying\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * Adjust part of the parameters, including trigger, d, r, maxR, minR, maxD, minD, scaleRBy, and scaleDBy\n   * @param {FisheyeConfig} cfg\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR,\n        scaleDBy = cfg.scaleDBy,\n        scaleRBy = cfg.scaleRBy;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n\n    if (scaleDBy === 'drag' || scaleDBy === 'wheel' || scaleDBy === 'unset') {\n      self.set('scaleDBy', scaleDBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n\n    if (scaleRBy === 'drag' || scaleRBy === 'wheel' || scaleRBy === 'unset') {\n      self.set('scaleRBy', scaleRBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n  };\n  /**\n   * Update the delegate shape of the lens\n   * @param {Point} mCenter the center of the shape\n   * @param {number} r the radius of the shape\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var _this = this;\n\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的, delegateShape是g实例, x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('trigger') !== 'drag') {\n        // 调整范围 r 的监听\n        if (this.get('scaleRBy') === 'wheel') {\n          // 使用滚轮调整 r\n          lensDelegate.on('mousewheel', function (evt) {\n            self.scaleRByWheel(evt);\n          });\n        } else if (this.get('scaleRBy') === 'drag') {\n          // 使用拖拽调整 r\n          lensDelegate.on('dragstart', function (e) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: e.x,\n              y: e.y\n            });\n            self.set('dragPrePos', {\n              x: e.x,\n              y: e.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            self.scaleRByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (e) {\n            self.set('dragging', false);\n          });\n        } // 调整缩放系数 d 的监听\n\n\n        if (this.get('scaleDBy') === 'wheel') {\n          // 使用滚轮调整 d\n          lensDelegate.on('mousewheel', function (evt) {\n            _this.scaleDByWheel(evt);\n          });\n        } else if (this.get('scaleDBy') === 'drag') {\n          // 使用拖拽调整 d\n          lensDelegate.on('dragstart', function (evt) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: evt.x,\n              y: evt.y\n            });\n            self.set('dragPrePos', {\n              x: evt.x,\n              y: evt.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            _this.scaleDByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (evt) {\n            self.set('dragging', false);\n          });\n        }\n      }\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    } // 绘制缩放系数百分比文本\n\n\n    if (self.get('showDPercent')) {\n      var percent = Math.round((self.get('d') - self.get('minD')) / (self.get('maxD') - self.get('minD')) * 100);\n      var dPercentText = self.get('dPercentText');\n      var textY = mCenter.y + r / 1.5 + 16;\n\n      if (!dPercentText || dPercentText.destroyed) {\n        var parent_2 = graph.get('group');\n        dPercentText = parent_2.addShape('text', {\n          attrs: {\n            text: percent + \"%\",\n            x: mCenter.x,\n            y: textY,\n            fill: '#aaa',\n            stroke: '#fff',\n            lineWidth: 1,\n            fontSize: 12\n          }\n        });\n        self.set('dPercentText', dPercentText);\n      } else {\n        dPercentText.attr({\n          text: percent + \"%\",\n          x: mCenter.x,\n          y: textY\n        });\n      }\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n  /**\n   * Clear the fisheye lens\n   */\n\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n\n    var dPercentText = this.get('dPercentText');\n\n    if (dPercentText && !dPercentText.destroyed) {\n      dPercentText.remove();\n      dPercentText.destroy();\n    }\n  };\n  /**\n   * Destroy the component\n   */\n\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/plugins/fisheye/index.js"],"names":["__assign","__extends","clone","Base","DELTA","lensDelegateStyle","stroke","strokeOpacity","lineWidth","fillOpacity","fill","Fisheye","_super","apply","arguments","prototype","getDefaultCfgs","trigger","d","r","delegateStyle","showLabel","maxD","minD","scaleRBy","scaleDBy","showDPercent","getEvents","events","get","click","mousemove","init","self","set","createDelegate","e","_this","lensDelegate","destroyed","magnify","on","evt","x","attr","y","scaleDByWheel","scaleRByWheel","originalEvent","preventDefault","graph","ratio","lensCenter","undefined","mousePos","getPointByClient","clientX","clientY","wheelDelta","maxR","minR","scaleRByDrag","dragPrePos","delta","newD","scaleDByDrag","restoreCache","cachedMagnifiedModels","cachedOriginPositions","r2","molecularParam","nodes","getNodes","nodeLength","length","mCenter","delegateCenterDiff","updateDelegate","i","model","getModel","isNaN","dist2","dist","Math","sqrt","magnifiedDist","cos","sin","id","texts","push","node","nodeGroup","getContainer","shapes","getChildren","shapeLength","j","shape","visible","refreshPositions","cacheLength","ori","textLength","text","updateParams","cfg","nd","nr","remove","destroy","dPercentText","parent_1","attrs","addShape","name","draggable","percent","round","textY","parent_2","fontSize","clear"],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport { clone } from '@antv/util/lib';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0,\n      scaleRBy: 'unset',\n      scaleDBy: 'unset',\n      showDPercent: true\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  }; // Create the delegate when the trigger is drag\n\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var _this = this;\n\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate'); // drag to move the lens\n\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      }); // 绑定调整范围（r）和缩放系数(d)的监听\n      // 由于 drag 用于改变 lens 位置, 因此在此模式下, drag 不能用于调整 r 和 d\n      // scaling d\n\n      if (this.get('scaleDBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          _this.scaleDByWheel(evt);\n        });\n      } // scaling r\n\n\n      if (this.get('scaleRBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRByWheel(evt);\n        });\n      }\n    }\n  };\n  /**\n   * Scale the range by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleRByWheel = function (e) {\n    var self = this;\n    if (!e || !e.originalEvent) return;\n    if (e.preventDefault) e.preventDefault();\n    var graph = self.get('graph');\n    var ratio;\n    var lensDelegate = self.get('delegate');\n    var lensCenter = lensDelegate ? {\n      x: lensDelegate.attr('x'),\n      y: lensDelegate.attr('y')\n    } : undefined;\n    var mousePos = lensCenter || graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.set('delegateCenterDiff', undefined);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * Scale the range by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleRByDrag = function (e) {\n    var self = this;\n    if (!e) return;\n    var dragPrePos = self.get('dragPrePos');\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.x - dragPrePos.x < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Scale the magnifying factor by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleDByWheel = function (evt) {\n    var self = this;\n    if (!evt && !evt.originalEvent) return;\n    if (evt.preventDefault) evt.preventDefault();\n    var delta = 0;\n\n    if (evt.originalEvent.wheelDelta < 0) {\n      delta = -0.1;\n    } else {\n      delta = 0.1;\n    }\n\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      var lensDelegate = self.get('delegate');\n      var lensCenter = lensDelegate ? {\n        x: lensDelegate.attr('x'),\n        y: lensDelegate.attr('y')\n      } : undefined;\n      self.set('delegateCenterDiff', undefined);\n      self.magnify(evt, lensCenter);\n    }\n  };\n  /**\n   * Scale the magnifying factor by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleDByDrag = function (e) {\n    var self = this;\n    var dragPrePos = self.get('dragPrePos');\n    var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      self.magnify(e);\n    }\n\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Response function for mousemove, click, or drag to magnify\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * Restore the cache nodes while magnifying\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * Adjust part of the parameters, including trigger, d, r, maxR, minR, maxD, minD, scaleRBy, and scaleDBy\n   * @param {FisheyeConfig} cfg\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR,\n        scaleDBy = cfg.scaleDBy,\n        scaleRBy = cfg.scaleRBy;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n\n    if (scaleDBy === 'drag' || scaleDBy === 'wheel' || scaleDBy === 'unset') {\n      self.set('scaleDBy', scaleDBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n\n    if (scaleRBy === 'drag' || scaleRBy === 'wheel' || scaleRBy === 'unset') {\n      self.set('scaleRBy', scaleRBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n  };\n  /**\n   * Update the delegate shape of the lens\n   * @param {Point} mCenter the center of the shape\n   * @param {number} r the radius of the shape\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var _this = this;\n\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的, delegateShape是g实例, x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('trigger') !== 'drag') {\n        // 调整范围 r 的监听\n        if (this.get('scaleRBy') === 'wheel') {\n          // 使用滚轮调整 r\n          lensDelegate.on('mousewheel', function (evt) {\n            self.scaleRByWheel(evt);\n          });\n        } else if (this.get('scaleRBy') === 'drag') {\n          // 使用拖拽调整 r\n          lensDelegate.on('dragstart', function (e) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: e.x,\n              y: e.y\n            });\n            self.set('dragPrePos', {\n              x: e.x,\n              y: e.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            self.scaleRByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (e) {\n            self.set('dragging', false);\n          });\n        } // 调整缩放系数 d 的监听\n\n\n        if (this.get('scaleDBy') === 'wheel') {\n          // 使用滚轮调整 d\n          lensDelegate.on('mousewheel', function (evt) {\n            _this.scaleDByWheel(evt);\n          });\n        } else if (this.get('scaleDBy') === 'drag') {\n          // 使用拖拽调整 d\n          lensDelegate.on('dragstart', function (evt) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: evt.x,\n              y: evt.y\n            });\n            self.set('dragPrePos', {\n              x: evt.x,\n              y: evt.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            _this.scaleDByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (evt) {\n            self.set('dragging', false);\n          });\n        }\n      }\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    } // 绘制缩放系数百分比文本\n\n\n    if (self.get('showDPercent')) {\n      var percent = Math.round((self.get('d') - self.get('minD')) / (self.get('maxD') - self.get('minD')) * 100);\n      var dPercentText = self.get('dPercentText');\n      var textY = mCenter.y + r / 1.5 + 16;\n\n      if (!dPercentText || dPercentText.destroyed) {\n        var parent_2 = graph.get('group');\n        dPercentText = parent_2.addShape('text', {\n          attrs: {\n            text: percent + \"%\",\n            x: mCenter.x,\n            y: textY,\n            fill: '#aaa',\n            stroke: '#fff',\n            lineWidth: 1,\n            fontSize: 12\n          }\n        });\n        self.set('dPercentText', dPercentText);\n      } else {\n        dPercentText.attr({\n          text: percent + \"%\",\n          x: mCenter.x,\n          y: textY\n        });\n      }\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n  /**\n   * Clear the fisheye lens\n   */\n\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n\n    var dPercentText = this.get('dPercentText');\n\n    if (dPercentText && !dPercentText.destroyed) {\n      dPercentText.remove();\n      dPercentText.destroy();\n    }\n  };\n  /**\n   * Destroy the component\n   */\n\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;"]},"metadata":{},"sourceType":"module"}