{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport Node from './node';\nimport Global from '../global';\nimport { getBBox } from '../util/graphic';\nimport isNumber from '@antv/util/lib/is-number';\nvar CACHE_BBOX = 'bboxCache';\nvar CACHE_CANVAS_BBOX = 'bboxCanvasCache';\nvar CACHE_SIZE = 'sizeCache';\nvar CACHE_ANCHOR_POINTS = 'anchorPointsCache';\n\nvar Combo =\n/** @class */\nfunction (_super) {\n  __extends(Combo, _super);\n\n  function Combo() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Combo.prototype.getDefaultCfg = function () {\n    return {\n      type: 'combo',\n      nodes: [],\n      edges: [],\n      combos: []\n    };\n  };\n\n  Combo.prototype.getShapeCfg = function (model) {\n    var styles = this.get('styles');\n    var bbox = this.get('bbox');\n\n    if (styles && bbox) {\n      // merge graph的item样式与数据模型中的样式\n      var newModel = model;\n      var size = {\n        r: Math.hypot(bbox.height, bbox.width) / 2 || Global.defaultCombo.size[0] / 2,\n        width: bbox.width || Global.defaultCombo.size[0],\n        height: bbox.height || Global.defaultCombo.size[1]\n      };\n      newModel.style = __assign(__assign(__assign({}, styles), model.style), size);\n      var padding = model.padding || Global.defaultCombo.padding;\n\n      if (isNumber(padding)) {\n        size.r += padding;\n        size.width += padding * 2;\n        size.height += padding * 2;\n      } else {\n        size.r += padding[0];\n        size.width += padding[1] + padding[3] || padding[1] * 2;\n        size.height += padding[0] + padding[2] || padding[0] * 2;\n      }\n\n      this.set(CACHE_SIZE, size);\n      return newModel;\n    }\n\n    return model;\n  };\n  /**\n   * 根据 keyshape 计算包围盒\n   */\n\n\n  Combo.prototype.calculateCanvasBBox = function () {\n    var keyShape = this.get('keyShape');\n    var group = this.get('group'); // 因为 group 可能会移动，所以必须通过父元素计算才能计算出正确的包围盒\n\n    var bbox = getBBox(keyShape, group);\n    bbox.x = bbox.minX;\n    bbox.y = bbox.minY;\n    bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n    bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    var cacheSize = this.get(CACHE_SIZE);\n\n    if (cacheSize) {\n      var type = keyShape.get('type');\n\n      if (type === 'circle') {\n        bbox.width = cacheSize.r * 2;\n        bbox.height = cacheSize.r * 2;\n      } else {\n        bbox.width = cacheSize.width;\n        bbox.height = cacheSize.height;\n      }\n\n      bbox.minX = bbox.centerX - bbox.width / 2;\n      bbox.minY = bbox.centerY - bbox.height / 2;\n      bbox.maxX = bbox.centerX + bbox.width / 2;\n      bbox.maxY = bbox.centerY + bbox.height / 2;\n    } else {\n      bbox.width = bbox.maxX - bbox.minX;\n      bbox.height = bbox.maxY - bbox.minY;\n      bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n      bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    }\n\n    return bbox;\n  };\n  /**\n   * 获取 Combo 中所有的子元素，包括 Combo、Node 及 Edge\n   */\n\n\n  Combo.prototype.getChildren = function () {\n    var self = this;\n    return {\n      nodes: self.getNodes(),\n      combos: self.getCombos()\n    };\n  };\n  /**\n   * 获取 Combo 中所有子节点\n   */\n\n\n  Combo.prototype.getNodes = function () {\n    var self = this;\n    return self.get('nodes');\n  };\n  /**\n   * 获取 Combo 中所有子 combo\n   */\n\n\n  Combo.prototype.getCombos = function () {\n    var self = this;\n    return self.get('combos');\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.addNode(item);\n        break;\n\n      case 'combo':\n        self.addCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 向 Combo 中增加 combo\n   * @param combo Combo 实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addCombo = function (combo) {\n    var self = this;\n    self.get('combos').push(combo);\n    return true;\n  };\n  /**\n   * 向 Combo 中添加节点\n   * @param node 节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addNode = function (node) {\n    var self = this;\n    self.get('nodes').push(node);\n    return true;\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.removeNode(item);\n        break;\n\n      case 'combo':\n        self.removeCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 从 Combo 中移除指定的 combo\n   * @param combo Combo 实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeCombo = function (combo) {\n    if (!combo) return;\n    var combos = this.getCombos();\n    var index = combos.indexOf(combo);\n\n    if (index > -1) {\n      combos.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  /**\n   * 向 Combo 中移除指定的节点\n   * @param node 节点实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeNode = function (node) {\n    if (!node) return;\n    var nodes = this.getNodes();\n    var index = nodes.indexOf(node);\n\n    if (index > -1) {\n      nodes.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n\n  Combo.prototype.isOnlyMove = function (cfg) {\n    return false;\n  };\n  /**\n   * 获取 item 的包围盒，这个包围盒是相对于 item 自己，不会将 matrix 计算在内\n   * @return {Object} 包含 x,y,width,height, centerX, centerY\n   */\n\n\n  Combo.prototype.getBBox = function () {\n    this.set(CACHE_CANVAS_BBOX, null);\n    var bbox = this.calculateCanvasBBox();\n    return bbox;\n  };\n\n  Combo.prototype.clearCache = function () {\n    this.set(CACHE_BBOX, null); // 清理缓存的 bbox\n\n    this.set(CACHE_CANVAS_BBOX, null);\n    this.set(CACHE_ANCHOR_POINTS, null);\n  };\n\n  Combo.prototype.destroy = function () {\n    if (!this.destroyed) {\n      var animate = this.get('animate');\n      var group = this.get('group');\n\n      if (animate) {\n        group.stopAnimate();\n      }\n\n      this.clearCache();\n      this.set(CACHE_SIZE, null);\n      this.set('bbox', null);\n      group.remove();\n      this._cfg = null;\n      this.destroyed = true;\n    }\n  };\n\n  return Combo;\n}(Node);\n\nexport default Combo;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/item/combo.js"],"names":["__assign","__extends","Node","Global","getBBox","isNumber","CACHE_BBOX","CACHE_CANVAS_BBOX","CACHE_SIZE","CACHE_ANCHOR_POINTS","Combo","_super","apply","arguments","prototype","getDefaultCfg","type","nodes","edges","combos","getShapeCfg","model","styles","get","bbox","newModel","size","r","Math","hypot","height","width","defaultCombo","style","padding","set","calculateCanvasBBox","keyShape","group","x","minX","y","minY","centerX","maxX","centerY","maxY","cacheSize","getChildren","self","getNodes","getCombos","addChild","item","itemType","getType","addNode","addCombo","console","warn","combo","push","node","removeChild","removeNode","removeCombo","index","indexOf","splice","isOnlyMove","cfg","clearCache","destroy","destroyed","animate","stopAnimate","remove","_cfg"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,SAASC,OAAT,QAAwB,iBAAxB;AACA,OAAOC,QAAP,MAAqB,0BAArB;AACA,IAAIC,UAAU,GAAG,WAAjB;AACA,IAAIC,iBAAiB,GAAG,iBAAxB;AACA,IAAIC,UAAU,GAAG,WAAjB;AACA,IAAIC,mBAAmB,GAAG,mBAA1B;;AAEA,IAAIC,KAAK;AACT;AACA,UAAUC,MAAV,EAAkB;AAChBV,EAAAA,SAAS,CAACS,KAAD,EAAQC,MAAR,CAAT;;AAEA,WAASD,KAAT,GAAiB;AACf,WAAOC,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACD;;AAEDH,EAAAA,KAAK,CAACI,SAAN,CAAgBC,aAAhB,GAAgC,YAAY;AAC1C,WAAO;AACLC,MAAAA,IAAI,EAAE,OADD;AAELC,MAAAA,KAAK,EAAE,EAFF;AAGLC,MAAAA,KAAK,EAAE,EAHF;AAILC,MAAAA,MAAM,EAAE;AAJH,KAAP;AAMD,GAPD;;AASAT,EAAAA,KAAK,CAACI,SAAN,CAAgBM,WAAhB,GAA8B,UAAUC,KAAV,EAAiB;AAC7C,QAAIC,MAAM,GAAG,KAAKC,GAAL,CAAS,QAAT,CAAb;AACA,QAAIC,IAAI,GAAG,KAAKD,GAAL,CAAS,MAAT,CAAX;;AAEA,QAAID,MAAM,IAAIE,IAAd,EAAoB;AAClB;AACA,UAAIC,QAAQ,GAAGJ,KAAf;AACA,UAAIK,IAAI,GAAG;AACTC,QAAAA,CAAC,EAAEC,IAAI,CAACC,KAAL,CAAWL,IAAI,CAACM,MAAhB,EAAwBN,IAAI,CAACO,KAA7B,IAAsC,CAAtC,IAA2C5B,MAAM,CAAC6B,YAAP,CAAoBN,IAApB,CAAyB,CAAzB,IAA8B,CADnE;AAETK,QAAAA,KAAK,EAAEP,IAAI,CAACO,KAAL,IAAc5B,MAAM,CAAC6B,YAAP,CAAoBN,IAApB,CAAyB,CAAzB,CAFZ;AAGTI,QAAAA,MAAM,EAAEN,IAAI,CAACM,MAAL,IAAe3B,MAAM,CAAC6B,YAAP,CAAoBN,IAApB,CAAyB,CAAzB;AAHd,OAAX;AAKAD,MAAAA,QAAQ,CAACQ,KAAT,GAAiBjC,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKsB,MAAL,CAAT,EAAuBD,KAAK,CAACY,KAA7B,CAAT,EAA8CP,IAA9C,CAAzB;AACA,UAAIQ,OAAO,GAAGb,KAAK,CAACa,OAAN,IAAiB/B,MAAM,CAAC6B,YAAP,CAAoBE,OAAnD;;AAEA,UAAI7B,QAAQ,CAAC6B,OAAD,CAAZ,EAAuB;AACrBR,QAAAA,IAAI,CAACC,CAAL,IAAUO,OAAV;AACAR,QAAAA,IAAI,CAACK,KAAL,IAAcG,OAAO,GAAG,CAAxB;AACAR,QAAAA,IAAI,CAACI,MAAL,IAAeI,OAAO,GAAG,CAAzB;AACD,OAJD,MAIO;AACLR,QAAAA,IAAI,CAACC,CAAL,IAAUO,OAAO,CAAC,CAAD,CAAjB;AACAR,QAAAA,IAAI,CAACK,KAAL,IAAcG,OAAO,CAAC,CAAD,CAAP,GAAaA,OAAO,CAAC,CAAD,CAApB,IAA2BA,OAAO,CAAC,CAAD,CAAP,GAAa,CAAtD;AACAR,QAAAA,IAAI,CAACI,MAAL,IAAeI,OAAO,CAAC,CAAD,CAAP,GAAaA,OAAO,CAAC,CAAD,CAApB,IAA2BA,OAAO,CAAC,CAAD,CAAP,GAAa,CAAvD;AACD;;AAED,WAAKC,GAAL,CAAS3B,UAAT,EAAqBkB,IAArB;AACA,aAAOD,QAAP;AACD;;AAED,WAAOJ,KAAP;AACD,GA9BD;AA+BA;AACF;AACA;;;AAGEX,EAAAA,KAAK,CAACI,SAAN,CAAgBsB,mBAAhB,GAAsC,YAAY;AAChD,QAAIC,QAAQ,GAAG,KAAKd,GAAL,CAAS,UAAT,CAAf;AACA,QAAIe,KAAK,GAAG,KAAKf,GAAL,CAAS,OAAT,CAAZ,CAFgD,CAEjB;;AAE/B,QAAIC,IAAI,GAAGpB,OAAO,CAACiC,QAAD,EAAWC,KAAX,CAAlB;AACAd,IAAAA,IAAI,CAACe,CAAL,GAASf,IAAI,CAACgB,IAAd;AACAhB,IAAAA,IAAI,CAACiB,CAAL,GAASjB,IAAI,CAACkB,IAAd;AACAlB,IAAAA,IAAI,CAACmB,OAAL,GAAe,CAACnB,IAAI,CAACgB,IAAL,GAAYhB,IAAI,CAACoB,IAAlB,IAA0B,CAAzC;AACApB,IAAAA,IAAI,CAACqB,OAAL,GAAe,CAACrB,IAAI,CAACkB,IAAL,GAAYlB,IAAI,CAACsB,IAAlB,IAA0B,CAAzC;AACA,QAAIC,SAAS,GAAG,KAAKxB,GAAL,CAASf,UAAT,CAAhB;;AAEA,QAAIuC,SAAJ,EAAe;AACb,UAAI/B,IAAI,GAAGqB,QAAQ,CAACd,GAAT,CAAa,MAAb,CAAX;;AAEA,UAAIP,IAAI,KAAK,QAAb,EAAuB;AACrBQ,QAAAA,IAAI,CAACO,KAAL,GAAagB,SAAS,CAACpB,CAAV,GAAc,CAA3B;AACAH,QAAAA,IAAI,CAACM,MAAL,GAAciB,SAAS,CAACpB,CAAV,GAAc,CAA5B;AACD,OAHD,MAGO;AACLH,QAAAA,IAAI,CAACO,KAAL,GAAagB,SAAS,CAAChB,KAAvB;AACAP,QAAAA,IAAI,CAACM,MAAL,GAAciB,SAAS,CAACjB,MAAxB;AACD;;AAEDN,MAAAA,IAAI,CAACgB,IAAL,GAAYhB,IAAI,CAACmB,OAAL,GAAenB,IAAI,CAACO,KAAL,GAAa,CAAxC;AACAP,MAAAA,IAAI,CAACkB,IAAL,GAAYlB,IAAI,CAACqB,OAAL,GAAerB,IAAI,CAACM,MAAL,GAAc,CAAzC;AACAN,MAAAA,IAAI,CAACoB,IAAL,GAAYpB,IAAI,CAACmB,OAAL,GAAenB,IAAI,CAACO,KAAL,GAAa,CAAxC;AACAP,MAAAA,IAAI,CAACsB,IAAL,GAAYtB,IAAI,CAACqB,OAAL,GAAerB,IAAI,CAACM,MAAL,GAAc,CAAzC;AACD,KAfD,MAeO;AACLN,MAAAA,IAAI,CAACO,KAAL,GAAaP,IAAI,CAACoB,IAAL,GAAYpB,IAAI,CAACgB,IAA9B;AACAhB,MAAAA,IAAI,CAACM,MAAL,GAAcN,IAAI,CAACsB,IAAL,GAAYtB,IAAI,CAACkB,IAA/B;AACAlB,MAAAA,IAAI,CAACmB,OAAL,GAAe,CAACnB,IAAI,CAACgB,IAAL,GAAYhB,IAAI,CAACoB,IAAlB,IAA0B,CAAzC;AACApB,MAAAA,IAAI,CAACqB,OAAL,GAAe,CAACrB,IAAI,CAACkB,IAAL,GAAYlB,IAAI,CAACsB,IAAlB,IAA0B,CAAzC;AACD;;AAED,WAAOtB,IAAP;AACD,GAlCD;AAmCA;AACF;AACA;;;AAGEd,EAAAA,KAAK,CAACI,SAAN,CAAgBkC,WAAhB,GAA8B,YAAY;AACxC,QAAIC,IAAI,GAAG,IAAX;AACA,WAAO;AACLhC,MAAAA,KAAK,EAAEgC,IAAI,CAACC,QAAL,EADF;AAEL/B,MAAAA,MAAM,EAAE8B,IAAI,CAACE,SAAL;AAFH,KAAP;AAID,GAND;AAOA;AACF;AACA;;;AAGEzC,EAAAA,KAAK,CAACI,SAAN,CAAgBoC,QAAhB,GAA2B,YAAY;AACrC,QAAID,IAAI,GAAG,IAAX;AACA,WAAOA,IAAI,CAAC1B,GAAL,CAAS,OAAT,CAAP;AACD,GAHD;AAIA;AACF;AACA;;;AAGEb,EAAAA,KAAK,CAACI,SAAN,CAAgBqC,SAAhB,GAA4B,YAAY;AACtC,QAAIF,IAAI,GAAG,IAAX;AACA,WAAOA,IAAI,CAAC1B,GAAL,CAAS,QAAT,CAAP;AACD,GAHD;AAIA;AACF;AACA;AACA;AACA;;;AAGEb,EAAAA,KAAK,CAACI,SAAN,CAAgBsC,QAAhB,GAA2B,UAAUC,IAAV,EAAgB;AACzC,QAAIJ,IAAI,GAAG,IAAX;AACA,QAAIK,QAAQ,GAAGD,IAAI,CAACE,OAAL,EAAf;;AAEA,YAAQD,QAAR;AACE,WAAK,MAAL;AACEL,QAAAA,IAAI,CAACO,OAAL,CAAaH,IAAb;AACA;;AAEF,WAAK,OAAL;AACEJ,QAAAA,IAAI,CAACQ,QAAL,CAAcJ,IAAd;AACA;;AAEF;AACEK,QAAAA,OAAO,CAACC,IAAR,CAAa,+DAAb;AACA,eAAO,KAAP;AAXJ;;AAcA,WAAO,IAAP;AACD,GAnBD;AAoBA;AACF;AACA;AACA;AACA;;;AAGEjD,EAAAA,KAAK,CAACI,SAAN,CAAgB2C,QAAhB,GAA2B,UAAUG,KAAV,EAAiB;AAC1C,QAAIX,IAAI,GAAG,IAAX;AACAA,IAAAA,IAAI,CAAC1B,GAAL,CAAS,QAAT,EAAmBsC,IAAnB,CAAwBD,KAAxB;AACA,WAAO,IAAP;AACD,GAJD;AAKA;AACF;AACA;AACA;AACA;;;AAGElD,EAAAA,KAAK,CAACI,SAAN,CAAgB0C,OAAhB,GAA0B,UAAUM,IAAV,EAAgB;AACxC,QAAIb,IAAI,GAAG,IAAX;AACAA,IAAAA,IAAI,CAAC1B,GAAL,CAAS,OAAT,EAAkBsC,IAAlB,CAAuBC,IAAvB;AACA,WAAO,IAAP;AACD,GAJD;AAKA;AACF;AACA;AACA;AACA;;;AAGEpD,EAAAA,KAAK,CAACI,SAAN,CAAgBiD,WAAhB,GAA8B,UAAUV,IAAV,EAAgB;AAC5C,QAAIJ,IAAI,GAAG,IAAX;AACA,QAAIK,QAAQ,GAAGD,IAAI,CAACE,OAAL,EAAf;;AAEA,YAAQD,QAAR;AACE,WAAK,MAAL;AACEL,QAAAA,IAAI,CAACe,UAAL,CAAgBX,IAAhB;AACA;;AAEF,WAAK,OAAL;AACEJ,QAAAA,IAAI,CAACgB,WAAL,CAAiBZ,IAAjB;AACA;;AAEF;AACEK,QAAAA,OAAO,CAACC,IAAR,CAAa,+DAAb;AACA,eAAO,KAAP;AAXJ;;AAcA,WAAO,IAAP;AACD,GAnBD;AAoBA;AACF;AACA;AACA;AACA;;;AAGEjD,EAAAA,KAAK,CAACI,SAAN,CAAgBmD,WAAhB,GAA8B,UAAUL,KAAV,EAAiB;AAC7C,QAAI,CAACA,KAAL,EAAY;AACZ,QAAIzC,MAAM,GAAG,KAAKgC,SAAL,EAAb;AACA,QAAIe,KAAK,GAAG/C,MAAM,CAACgD,OAAP,CAAeP,KAAf,CAAZ;;AAEA,QAAIM,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd/C,MAAAA,MAAM,CAACiD,MAAP,CAAcF,KAAd,EAAqB,CAArB;AACA,aAAO,IAAP;AACD;;AAED,WAAO,KAAP;AACD,GAXD;AAYA;AACF;AACA;AACA;AACA;;;AAGExD,EAAAA,KAAK,CAACI,SAAN,CAAgBkD,UAAhB,GAA6B,UAAUF,IAAV,EAAgB;AAC3C,QAAI,CAACA,IAAL,EAAW;AACX,QAAI7C,KAAK,GAAG,KAAKiC,QAAL,EAAZ;AACA,QAAIgB,KAAK,GAAGjD,KAAK,CAACkD,OAAN,CAAcL,IAAd,CAAZ;;AAEA,QAAII,KAAK,GAAG,CAAC,CAAb,EAAgB;AACdjD,MAAAA,KAAK,CAACmD,MAAN,CAAaF,KAAb,EAAoB,CAApB;AACA,aAAO,IAAP;AACD;;AAED,WAAO,KAAP;AACD,GAXD;;AAaAxD,EAAAA,KAAK,CAACI,SAAN,CAAgBuD,UAAhB,GAA6B,UAAUC,GAAV,EAAe;AAC1C,WAAO,KAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;;;AAGE5D,EAAAA,KAAK,CAACI,SAAN,CAAgBV,OAAhB,GAA0B,YAAY;AACpC,SAAK+B,GAAL,CAAS5B,iBAAT,EAA4B,IAA5B;AACA,QAAIiB,IAAI,GAAG,KAAKY,mBAAL,EAAX;AACA,WAAOZ,IAAP;AACD,GAJD;;AAMAd,EAAAA,KAAK,CAACI,SAAN,CAAgByD,UAAhB,GAA6B,YAAY;AACvC,SAAKpC,GAAL,CAAS7B,UAAT,EAAqB,IAArB,EADuC,CACX;;AAE5B,SAAK6B,GAAL,CAAS5B,iBAAT,EAA4B,IAA5B;AACA,SAAK4B,GAAL,CAAS1B,mBAAT,EAA8B,IAA9B;AACD,GALD;;AAOAC,EAAAA,KAAK,CAACI,SAAN,CAAgB0D,OAAhB,GAA0B,YAAY;AACpC,QAAI,CAAC,KAAKC,SAAV,EAAqB;AACnB,UAAIC,OAAO,GAAG,KAAKnD,GAAL,CAAS,SAAT,CAAd;AACA,UAAIe,KAAK,GAAG,KAAKf,GAAL,CAAS,OAAT,CAAZ;;AAEA,UAAImD,OAAJ,EAAa;AACXpC,QAAAA,KAAK,CAACqC,WAAN;AACD;;AAED,WAAKJ,UAAL;AACA,WAAKpC,GAAL,CAAS3B,UAAT,EAAqB,IAArB;AACA,WAAK2B,GAAL,CAAS,MAAT,EAAiB,IAAjB;AACAG,MAAAA,KAAK,CAACsC,MAAN;AACA,WAAKC,IAAL,GAAY,IAAZ;AACA,WAAKJ,SAAL,GAAiB,IAAjB;AACD;AACF,GAhBD;;AAkBA,SAAO/D,KAAP;AACD,CAnRD,CAmRER,IAnRF,CAFA;;AAuRA,eAAeQ,KAAf","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport Node from './node';\nimport Global from '../global';\nimport { getBBox } from '../util/graphic';\nimport isNumber from '@antv/util/lib/is-number';\nvar CACHE_BBOX = 'bboxCache';\nvar CACHE_CANVAS_BBOX = 'bboxCanvasCache';\nvar CACHE_SIZE = 'sizeCache';\nvar CACHE_ANCHOR_POINTS = 'anchorPointsCache';\n\nvar Combo =\n/** @class */\nfunction (_super) {\n  __extends(Combo, _super);\n\n  function Combo() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Combo.prototype.getDefaultCfg = function () {\n    return {\n      type: 'combo',\n      nodes: [],\n      edges: [],\n      combos: []\n    };\n  };\n\n  Combo.prototype.getShapeCfg = function (model) {\n    var styles = this.get('styles');\n    var bbox = this.get('bbox');\n\n    if (styles && bbox) {\n      // merge graph的item样式与数据模型中的样式\n      var newModel = model;\n      var size = {\n        r: Math.hypot(bbox.height, bbox.width) / 2 || Global.defaultCombo.size[0] / 2,\n        width: bbox.width || Global.defaultCombo.size[0],\n        height: bbox.height || Global.defaultCombo.size[1]\n      };\n      newModel.style = __assign(__assign(__assign({}, styles), model.style), size);\n      var padding = model.padding || Global.defaultCombo.padding;\n\n      if (isNumber(padding)) {\n        size.r += padding;\n        size.width += padding * 2;\n        size.height += padding * 2;\n      } else {\n        size.r += padding[0];\n        size.width += padding[1] + padding[3] || padding[1] * 2;\n        size.height += padding[0] + padding[2] || padding[0] * 2;\n      }\n\n      this.set(CACHE_SIZE, size);\n      return newModel;\n    }\n\n    return model;\n  };\n  /**\n   * 根据 keyshape 计算包围盒\n   */\n\n\n  Combo.prototype.calculateCanvasBBox = function () {\n    var keyShape = this.get('keyShape');\n    var group = this.get('group'); // 因为 group 可能会移动，所以必须通过父元素计算才能计算出正确的包围盒\n\n    var bbox = getBBox(keyShape, group);\n    bbox.x = bbox.minX;\n    bbox.y = bbox.minY;\n    bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n    bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    var cacheSize = this.get(CACHE_SIZE);\n\n    if (cacheSize) {\n      var type = keyShape.get('type');\n\n      if (type === 'circle') {\n        bbox.width = cacheSize.r * 2;\n        bbox.height = cacheSize.r * 2;\n      } else {\n        bbox.width = cacheSize.width;\n        bbox.height = cacheSize.height;\n      }\n\n      bbox.minX = bbox.centerX - bbox.width / 2;\n      bbox.minY = bbox.centerY - bbox.height / 2;\n      bbox.maxX = bbox.centerX + bbox.width / 2;\n      bbox.maxY = bbox.centerY + bbox.height / 2;\n    } else {\n      bbox.width = bbox.maxX - bbox.minX;\n      bbox.height = bbox.maxY - bbox.minY;\n      bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n      bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    }\n\n    return bbox;\n  };\n  /**\n   * 获取 Combo 中所有的子元素，包括 Combo、Node 及 Edge\n   */\n\n\n  Combo.prototype.getChildren = function () {\n    var self = this;\n    return {\n      nodes: self.getNodes(),\n      combos: self.getCombos()\n    };\n  };\n  /**\n   * 获取 Combo 中所有子节点\n   */\n\n\n  Combo.prototype.getNodes = function () {\n    var self = this;\n    return self.get('nodes');\n  };\n  /**\n   * 获取 Combo 中所有子 combo\n   */\n\n\n  Combo.prototype.getCombos = function () {\n    var self = this;\n    return self.get('combos');\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.addNode(item);\n        break;\n\n      case 'combo':\n        self.addCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 向 Combo 中增加 combo\n   * @param combo Combo 实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addCombo = function (combo) {\n    var self = this;\n    self.get('combos').push(combo);\n    return true;\n  };\n  /**\n   * 向 Combo 中添加节点\n   * @param node 节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addNode = function (node) {\n    var self = this;\n    self.get('nodes').push(node);\n    return true;\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.removeNode(item);\n        break;\n\n      case 'combo':\n        self.removeCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 从 Combo 中移除指定的 combo\n   * @param combo Combo 实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeCombo = function (combo) {\n    if (!combo) return;\n    var combos = this.getCombos();\n    var index = combos.indexOf(combo);\n\n    if (index > -1) {\n      combos.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  /**\n   * 向 Combo 中移除指定的节点\n   * @param node 节点实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeNode = function (node) {\n    if (!node) return;\n    var nodes = this.getNodes();\n    var index = nodes.indexOf(node);\n\n    if (index > -1) {\n      nodes.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n\n  Combo.prototype.isOnlyMove = function (cfg) {\n    return false;\n  };\n  /**\n   * 获取 item 的包围盒，这个包围盒是相对于 item 自己，不会将 matrix 计算在内\n   * @return {Object} 包含 x,y,width,height, centerX, centerY\n   */\n\n\n  Combo.prototype.getBBox = function () {\n    this.set(CACHE_CANVAS_BBOX, null);\n    var bbox = this.calculateCanvasBBox();\n    return bbox;\n  };\n\n  Combo.prototype.clearCache = function () {\n    this.set(CACHE_BBOX, null); // 清理缓存的 bbox\n\n    this.set(CACHE_CANVAS_BBOX, null);\n    this.set(CACHE_ANCHOR_POINTS, null);\n  };\n\n  Combo.prototype.destroy = function () {\n    if (!this.destroyed) {\n      var animate = this.get('animate');\n      var group = this.get('group');\n\n      if (animate) {\n        group.stopAnimate();\n      }\n\n      this.clearCache();\n      this.set(CACHE_SIZE, null);\n      this.set('bbox', null);\n      group.remove();\n      this._cfg = null;\n      this.destroyed = true;\n    }\n  };\n\n  return Combo;\n}(Node);\n\nexport default Combo;"]},"metadata":{},"sourceType":"module"}