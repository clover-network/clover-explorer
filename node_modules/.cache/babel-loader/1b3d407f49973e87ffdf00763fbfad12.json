{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { get, size, assign, each } from '@antv/util';\nimport Trend from './trend';\nimport Handler from './handler';\nimport ControllerBtn from './controllerBtn';\nimport { VALUE_CHANGE, TIMELINE_START, TIMEBAR_CONFIG_CHANGE, PLAY_PAUSE_BTN, NEXT_STEP_BTN, PRE_STEP_BTN, TIMELINE_END } from './constant';\n/**\n * 一些默认的样式配置\n */\n\nexport var BACKGROUND_STYLE = {\n  fill: '#416180',\n  opacity: 0.05\n};\nvar SIMPLE_BACKGROUND_STYLE = {\n  fill: '#416180',\n  opacity: 0.15,\n  radius: 5\n};\nexport var FOREGROUND_STYLE = {\n  fill: '#5B8FF9',\n  opacity: 0.3,\n  cursor: 'move'\n};\nexport var DEFAULT_HANDLER_WIDTH = 2;\nexport var HANDLER_STYLE = {\n  width: DEFAULT_HANDLER_WIDTH,\n  height: 24\n};\nexport var TEXT_STYLE = {\n  textBaseline: 'middle',\n  fill: '#000',\n  opacity: 0.45\n};\n\nvar TrendTimeBar =\n/** @class */\nfunction () {\n  function TrendTimeBar(cfg) {\n    var _this = this;\n\n    this.prevX = 0;\n\n    this.onMouseDown = function (handler) {\n      return function (e) {\n        // 1. 记录点击的滑块\n        _this.currentHandler = handler;\n        var event = e.originalEvent; // 2. 存储当前点击位置\n\n        event.stopPropagation();\n        event.preventDefault(); // 兼容移动端获取数据\n\n        _this.prevX = get(event, 'touches.0.pageX', event.pageX); // 3. 开始滑动的时候，绑定 move 和 up 事件\n\n        var containerDOM = _this.canvas.get('container');\n\n        containerDOM.addEventListener('mousemove', _this.onMouseMove);\n        containerDOM.addEventListener('mouseup', _this.onMouseUp);\n        containerDOM.addEventListener('mouseleave', _this.onMouseUp); // 移动端事件\n\n        containerDOM.addEventListener('touchmove', _this.onMouseMove);\n        containerDOM.addEventListener('touchend', _this.onMouseUp);\n        containerDOM.addEventListener('touchcancel', _this.onMouseUp);\n      };\n    };\n\n    this.onMouseMove = function (e) {\n      // 滑动过程中，计算偏移，更新滑块，然后 emit 数据出去\n      e.stopPropagation();\n      e.preventDefault();\n      var x = get(e, 'touches.0.pageX', e.pageX); // 横向的 slider 只处理 x\n\n      var offsetX = x - _this.prevX;\n\n      var offsetXRange = _this.adjustOffsetRange(offsetX / _this.width); // 更新 start end range 范围\n\n\n      _this.updateStartEnd(offsetXRange); // 更新 ui\n\n\n      _this.updateUI();\n\n      _this.prevX = x;\n    };\n\n    this.onMouseUp = function () {\n      // 结束之后，取消绑定的事件\n      if (_this.currentHandler) {\n        _this.currentHandler = undefined;\n      }\n\n      var containerDOM = _this.canvas.get('container');\n\n      if (containerDOM) {\n        containerDOM.removeEventListener('mousemove', _this.onMouseMove);\n        containerDOM.removeEventListener('mouseup', _this.onMouseUp); // 防止滑动到 canvas 外部之后，状态丢失\n\n        containerDOM.removeEventListener('mouseleave', _this.onMouseUp); // 移动端事件\n\n        containerDOM.removeEventListener('touchmove', _this.onMouseMove);\n        containerDOM.removeEventListener('touchend', _this.onMouseUp);\n        containerDOM.removeEventListener('touchcancel', _this.onMouseUp);\n      }\n    };\n\n    var _a = cfg.x,\n        x = _a === void 0 ? 0 : _a,\n        _b = cfg.y,\n        y = _b === void 0 ? 0 : _b,\n        _c = cfg.width,\n        width = _c === void 0 ? 100 : _c,\n        height = cfg.height,\n        _d = cfg.padding,\n        padding = _d === void 0 ? 10 : _d,\n        trendCfg = cfg.trendCfg,\n        _e = cfg.controllerCfg,\n        controllerCfg = _e === void 0 ? {\n      speed: 1\n    } : _e,\n        _f = cfg.backgroundStyle,\n        backgroundStyle = _f === void 0 ? {} : _f,\n        _g = cfg.foregroundStyle,\n        foregroundStyle = _g === void 0 ? {} : _g,\n        _h = cfg.handlerStyle,\n        handlerStyle = _h === void 0 ? {} : _h,\n        _j = cfg.textStyle,\n        textStyle = _j === void 0 ? {} : _j,\n        // 缩略轴的初始位置\n    _k = cfg.start,\n        // 缩略轴的初始位置\n    start = _k === void 0 ? 0 : _k,\n        _l = cfg.end,\n        end = _l === void 0 ? 1 : _l,\n        _m = cfg.minText,\n        minText = _m === void 0 ? '' : _m,\n        _o = cfg.maxText,\n        maxText = _o === void 0 ? '' : _o,\n        group = cfg.group,\n        graph = cfg.graph,\n        canvas = cfg.canvas,\n        ticks = cfg.ticks,\n        type = cfg.type;\n    this.graph = graph;\n    this.canvas = canvas;\n    this.group = group;\n    this.timeBarType = type; // position size\n\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.padding = padding;\n    this.ticks = ticks;\n    this.trendCfg = trendCfg;\n    this.controllerCfg = controllerCfg;\n    this.currentSpeed = controllerCfg.speed; // style\n\n    if (type === 'trend') {\n      this.backgroundStyle = __assign(__assign({}, BACKGROUND_STYLE), backgroundStyle);\n    } else if (type === 'simple') {\n      this.backgroundStyle = __assign(__assign({}, SIMPLE_BACKGROUND_STYLE), backgroundStyle);\n    }\n\n    this.foregroundStyle = __assign(__assign({}, FOREGROUND_STYLE), foregroundStyle);\n    this.handlerStyle = __assign(__assign({}, HANDLER_STYLE), handlerStyle);\n    this.textStyle = __assign(__assign({}, TEXT_STYLE), textStyle);\n    this.currentMode = 'range'; // 初始信息\n\n    this.start = start;\n    this.end = end;\n    this.minText = minText;\n    this.maxText = maxText;\n    this.renderSlider();\n  }\n  /**\n   * 更新配置\n   * @param cfg\n   */\n\n\n  TrendTimeBar.prototype.update = function (cfg) {\n    var x = cfg.x,\n        y = cfg.y,\n        width = cfg.width,\n        height = cfg.height,\n        minText = cfg.minText,\n        maxText = cfg.maxText,\n        start = cfg.start,\n        end = cfg.end; // start、end 只能是 0~1 范围\n\n    this.start = Math.min(1, Math.max(start, 0));\n    this.end = Math.min(1, Math.max(end, 0)); // 如果传了则更新，没有传则不更新\n    // @ts-ignore\n\n    assign(this, {\n      x: x,\n      y: y,\n      width: width,\n      height: height,\n      minText: minText,\n      maxText: maxText\n    }); // 更新 ui，不自动绘制\n\n    this.updateUI();\n  };\n\n  TrendTimeBar.prototype.setText = function (minText, maxText) {\n    this.minTextShape.attr('text', minText);\n    this.maxTextShape.attr('text', maxText);\n  };\n  /**\n   * 初始化组件结构\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.renderSlider = function () {\n    var _this = this;\n\n    var _a = this,\n        width = _a.width,\n        height = _a.height,\n        timeBarType = _a.timeBarType; // 趋势图数据\n\n\n    if (timeBarType === 'trend' && size(get(this.trendCfg, 'data'))) {\n      var trendComponent = new Trend(__assign(__assign({\n        x: this.x,\n        y: this.y,\n        width: width,\n        height: height\n      }, this.trendCfg), {\n        group: this.group\n      }));\n      this.trendComponent = trendComponent;\n    }\n\n    var sliderGroup = this.group.addGroup({\n      name: 'slider-group'\n    }); // 1. 背景\n\n    sliderGroup.addShape('rect', {\n      attrs: __assign({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height\n      }, this.backgroundStyle)\n    });\n    var textGroup = this.group.addGroup(); // 2. 左右文字\n\n    if (timeBarType === 'trend') {\n      this.minTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          x: 0,\n          y: height / 2 + this.y,\n          textAlign: 'right',\n          text: this.minText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n      this.maxTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          y: height / 2 + this.y,\n          textAlign: 'left',\n          text: this.maxText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n    } else {\n      this.minTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          x: 0,\n          y: this.y - 10,\n          textAlign: 'center',\n          text: this.minText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n      this.maxTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          y: this.y - 10,\n          textAlign: 'center',\n          text: this.maxText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n    } // 3. 前景 选中背景框\n\n\n    this.foregroundShape = this.group.addGroup().addShape('rect', {\n      attrs: __assign({\n        x: 0,\n        y: this.y,\n        height: height\n      }, this.foregroundStyle)\n    }); // 滑块相关的大小信息\n\n    var handlerWidth = get(this.handlerStyle, 'width', 2);\n    var handlerHeight = get(this.handlerStyle, 'height', 24);\n    var minHandleGroup = this.group.addGroup({\n      name: 'minHandlerShape'\n    }); // 4. 左右滑块\n\n    this.minHandlerShape = new Handler(__assign({\n      name: 'minHandlerShape',\n      group: minHandleGroup,\n      type: timeBarType,\n      x: this.x,\n      y: this.y,\n      width: handlerWidth,\n      height: handlerHeight,\n      cursor: 'ew-resize'\n    }, this.handlerStyle));\n    var maxHandleGroup = this.group.addGroup({\n      name: 'maxHandlerShape'\n    });\n    this.maxHandlerShape = new Handler(__assign({\n      name: 'maxHandlerShape',\n      group: maxHandleGroup,\n      type: timeBarType,\n      x: this.x,\n      y: this.y,\n      width: handlerWidth,\n      height: handlerHeight,\n      cursor: 'ew-resize'\n    }, this.handlerStyle)); // 缩略图下面的时间刻度\n\n    var tickData = this.ticks;\n    var interval = width / (tickData.length - 1);\n    this.tickPosList = [];\n\n    if (this.textList && this.textList.length) {\n      this.textList.forEach(function (text) {\n        text.destroy();\n      });\n    }\n\n    var lastX = -Infinity;\n    this.textList = tickData.map(function (tick, index) {\n      _this.tickPosList.push(_this.x + index * interval); // 文本刻度\n\n\n      var text = _this.group.addShape('text', {\n        attrs: {\n          x: _this.x + index * interval,\n          y: _this.y + height + 5,\n          text: tick,\n          textAlign: 'center',\n          textBaseline: 'top',\n          fill: '#607889',\n          opacity: 0.35\n        }\n      }); // 文本刻度上面的竖线\n\n\n      var line = _this.group.addShape('line', {\n        attrs: {\n          x1: _this.x + index * interval,\n          y1: _this.y + height + 2,\n          x2: _this.x + index * interval,\n          y2: _this.y + height + 6,\n          lineWidth: 1,\n          stroke: '#ccc'\n        }\n      });\n\n      var bbox = text.getBBox(); // 抽样，标签与标签间距不小于 10\n\n      if (bbox.minX > lastX) {\n        text.show();\n        line.show();\n        lastX = bbox.minX + bbox.width + 10;\n      } else {\n        text.hide();\n        line.hide();\n      }\n\n      return text;\n    }); // 渲染播放、快进和后退的控制按钮\n\n    this.controllerBtnGroup = new ControllerBtn({\n      group: this.group,\n      x: this.x,\n      y: this.y + height + 25,\n      width: width,\n      height: 40\n    }); // 根据 start end 更新 ui 的位置信息\n\n    this.updateUI(); // 移动到对应的位置\n\n    sliderGroup.move(this.x, this.y); // 绑定事件鼠标事件\n\n    this.bindEvents();\n  };\n  /**\n   * 绑定事件：\n   *  - 点击\n   *  - 滑动\n   *  - 拖拽\n   *  - 滚动\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.bindEvents = function () {\n    var _this = this; // 1. 左滑块的滑动\n\n\n    var minHandleShapeGroup = this.group.find(function (group) {\n      return group.get('name') === 'minHandlerShape';\n    });\n\n    if (minHandleShapeGroup) {\n      minHandleShapeGroup.on('minHandlerShape-handler:mousedown', this.onMouseDown(this.minHandlerShape));\n      minHandleShapeGroup.on('minHandlerShape-handler:touchstart', this.onMouseDown(this.minHandlerShape));\n    }\n\n    var maxHandleShapeGroup = this.group.find(function (group) {\n      return group.get('name') === 'maxHandlerShape';\n    }); // 2. 右滑块的滑动\n\n    if (maxHandleShapeGroup) {\n      maxHandleShapeGroup.on('maxHandlerShape-handler:mousedown', this.onMouseDown(this.maxHandlerShape));\n      maxHandleShapeGroup.on('maxHandlerShape-handler:touchstart', this.onMouseDown(this.maxHandlerShape));\n    } // 3. 前景选中区域\n\n\n    this.foregroundShape.on('mousedown', this.onMouseDown(this.foregroundShape));\n    this.foregroundShape.on('touchstart', this.onMouseDown(this.foregroundShape)); // 播放区按钮控制\n\n    /** 播放/暂停事件 */\n\n    this.group.on(PLAY_PAUSE_BTN + \":click\", function () {\n      _this.isPlay = !_this.isPlay;\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.changePlayStatus();\n    }); // 处理前进一步的事件\n\n    this.group.on(NEXT_STEP_BTN + \":click\", function () {\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.updateStartEnd(0.01);\n\n      _this.updateUI();\n    }); // 处理后退一步的事件\n\n    this.group.on(PRE_STEP_BTN + \":click\", function () {\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.updateStartEnd(-0.01);\n\n      _this.updateUI();\n    });\n    this.group.on(TIMEBAR_CONFIG_CHANGE, function (_a) {\n      var type = _a.type,\n          speed = _a.speed;\n      _this.currentSpeed = speed;\n      _this.currentMode = type;\n\n      if (type === 'single') {\n        _this.minHandlerShape.hide();\n\n        _this.foregroundShape.hide();\n\n        _this.minTextShape.hide();\n      } else if (type === 'range') {\n        _this.minHandlerShape.show();\n\n        _this.foregroundShape.show();\n\n        _this.minTextShape.show();\n      }\n    });\n  };\n  /** 输入当前圆点位置，输出离哪个 tick 的位置最近 */\n\n\n  TrendTimeBar.prototype.adjustTickIndex = function (timeSelectX) {\n    for (var i = 0; i < this.tickPosList.length - 1; i++) {\n      if (this.tickPosList[i] <= timeSelectX && timeSelectX <= this.tickPosList[i + 1]) {\n        return Math.abs(this.tickPosList[i] - timeSelectX) < Math.abs(timeSelectX - this.tickPosList[i + 1]) ? i : i + 1;\n      }\n    }\n  };\n  /**\n   * 调整 offsetRange，因为一些范围的限制\n   * @param offsetRange\n   */\n\n\n  TrendTimeBar.prototype.adjustOffsetRange = function (offsetRange) {\n    // 针对不同的滑动组件，处理的方式不同\n    switch (this.currentHandler) {\n      case this.minHandlerShape:\n        {\n          var min = 0 - this.start;\n          var max = 1 - this.start;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      case this.maxHandlerShape:\n        {\n          var min = 0 - this.end;\n          var max = 1 - this.end;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      case this.foregroundShape:\n        {\n          var min = 0 - this.start;\n          var max = 1 - this.end;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      default:\n        return 0;\n    }\n  };\n  /**\n   * 更新起始、结束的控制块位置、文本、范围值（原始值）\n   * @param offsetRange\n   */\n\n\n  TrendTimeBar.prototype.updateStartEnd = function (offsetRange) {\n    // 操作不同的组件，反馈不一样\n    switch (this.currentHandler) {\n      case this.minHandlerShape:\n        // 拖动最小滑块时使用当前最大值设置最大值的文本，以便恢复到默认值\n        this.maxText = this.maxTextShape.attr('text');\n        this.start += offsetRange;\n        this.minText = this.ticks[this.adjustTickIndex(this.start * this.width)];\n        break;\n\n      case this.maxHandlerShape:\n        // 拖动最大滑块时使用当前最小值设置最小值的文本，以便恢复到默认值\n        this.minText = this.minTextShape.attr('text');\n        this.end += offsetRange;\n        this.maxText = this.ticks[this.adjustTickIndex(this.end * this.width)];\n        break;\n\n      case this.foregroundShape:\n        this.start += offsetRange;\n        this.end += offsetRange;\n        this.minText = this.ticks[this.adjustTickIndex(this.start * this.width)];\n        this.maxText = this.ticks[this.adjustTickIndex(this.end * this.width)];\n        break;\n\n      default:\n        break;\n    }\n  };\n  /**\n   * 根据移动的比例来更新 ui，更新范围（0-1 范围的比例值）\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.updateUI = function () {\n    var _this = this;\n\n    if (this.start < 0) {\n      this.start = 0;\n    }\n\n    if (this.end > 1) {\n      this.end = 1;\n    }\n\n    var min = this.start * this.width;\n    var max = this.end * this.width; // 1. foreground\n\n    this.foregroundShape.attr('x', min);\n    this.foregroundShape.attr('width', max - min); // 滑块相关的大小信息\n\n    var handlerWidth = get(this.handlerStyle, 'width', DEFAULT_HANDLER_WIDTH); // 设置文本\n\n    this.setText(this.minText, this.maxText);\n\n    var _a = this.dodgeText([min, max]),\n        minAttrs = _a[0],\n        maxAttrs = _a[1]; // 2. 左侧滑块和文字位置\n\n\n    this.minHandlerShape.setX(min - handlerWidth / 2);\n    each(minAttrs, function (v, k) {\n      return _this.minTextShape.attr(k, v);\n    }); // 3. 右侧滑块和文字位置\n\n    this.maxHandlerShape.setX(max - handlerWidth / 2);\n    each(maxAttrs, function (v, k) {\n      return _this.maxTextShape.attr(k, v);\n    });\n\n    if (this.currentMode === 'range') {\n      // 因为存储的 start、end 可能不一定是按大小存储的，所以排序一下，对外是 end >= start\n      this.graph.emit(VALUE_CHANGE, {\n        value: [this.start, this.end].sort()\n      });\n    } else if (this.currentMode === 'single') {\n      this.graph.emit(VALUE_CHANGE, {\n        value: [this.end, this.end]\n      });\n    }\n  };\n  /**\n   * 调整 text 的位置，自动躲避\n   * 根据位置，调整返回新的位置\n   * @param range\n   */\n\n\n  TrendTimeBar.prototype.dodgeText = function (range) {\n    var _a, _b;\n\n    var PADDING = 2;\n    var handlerWidth = get(this.handlerStyle, 'width', DEFAULT_HANDLER_WIDTH);\n    var minTextShape = this.minTextShape;\n    var maxTextShape = this.maxTextShape;\n    var min = range[0],\n        max = range[1];\n    var sorted = false; // 如果交换了位置，则对应的 min max 也交互\n\n    if (min > max) {\n      _a = [max, min], min = _a[0], max = _a[1];\n      _b = [maxTextShape, minTextShape], minTextShape = _b[0], maxTextShape = _b[1];\n      sorted = true;\n    } // 避让规则，优先显示在两侧，只有显示不下的时候，才显示在中间\n\n\n    var minBBox = minTextShape.getBBox();\n    var maxBBox = maxTextShape.getBBox();\n    var minAttrs = null;\n    var maxAttrs = null;\n\n    if (this.timeBarType === 'trend') {\n      minAttrs = minBBox.width > min - PADDING ? {\n        x: min + handlerWidth / 2 + PADDING,\n        textAlign: 'left'\n      } : {\n        x: min - handlerWidth / 2 - PADDING,\n        textAlign: 'right'\n      };\n      maxAttrs = maxBBox.width > this.width - max - PADDING ? {\n        x: max - handlerWidth / 2 - PADDING,\n        textAlign: 'right'\n      } : {\n        x: max + handlerWidth / 2 + PADDING,\n        textAlign: 'left'\n      };\n    } else if (this.timeBarType === 'simple') {\n      minAttrs = minBBox.width > min - PADDING ? {\n        x: min + handlerWidth / 2 + PADDING,\n        textAlign: 'center'\n      } : {\n        x: min - handlerWidth / 2 - PADDING,\n        textAlign: 'center'\n      };\n      maxAttrs = maxBBox.width > this.width - max - PADDING ? {\n        x: max - handlerWidth / 2 - PADDING,\n        textAlign: 'center'\n      } : {\n        x: max + handlerWidth / 2 + PADDING,\n        textAlign: 'center'\n      };\n    }\n\n    return !sorted ? [minAttrs, maxAttrs] : [maxAttrs, minAttrs];\n  };\n\n  TrendTimeBar.prototype.startPlay = function () {\n    var _this = this;\n\n    return window.requestAnimationFrame(function () {\n      var _a = _this,\n          ticks = _a.ticks,\n          width = _a.width;\n      var speed = _this.currentSpeed;\n      var tickInterval = width / ticks.length;\n      var offsetX = tickInterval / ((10 - speed) * 1000 / 60);\n\n      var offsetXRange = _this.adjustOffsetRange(offsetX / _this.width);\n\n      _this.updateStartEnd(offsetXRange);\n\n      _this.updateUI();\n\n      if (_this.isPlay) {\n        _this.playHandler = _this.startPlay();\n      }\n    });\n  };\n\n  TrendTimeBar.prototype.changePlayStatus = function (isSync) {\n    if (isSync === void 0) {\n      isSync = true;\n    }\n\n    this.controllerBtnGroup.playButton.update({\n      isPlay: this.isPlay\n    });\n\n    if (this.isPlay) {\n      // 开始播放\n      this.playHandler = this.startPlay();\n      this.graph.emit(TIMELINE_START, null);\n    } else {\n      // 结束播放\n      if (this.playHandler) {\n        window.cancelAnimationFrame(this.playHandler);\n\n        if (isSync) {\n          this.graph.emit(TIMELINE_END, null);\n        }\n      }\n    }\n  };\n\n  TrendTimeBar.prototype.destory = function () {\n    this.graph.off(VALUE_CHANGE);\n    var group = this.group;\n    var minHandleShapeGroup = group.find(function (g) {\n      return g.get('name') === 'minHandlerShape';\n    });\n\n    if (minHandleShapeGroup) {\n      minHandleShapeGroup.off('minHandlerShape-handler:mousedown');\n      minHandleShapeGroup.off('minHandlerShape-handler:touchstart');\n      minHandleShapeGroup.destroy();\n    }\n\n    var maxHandleShapeGroup = group.find(function (g) {\n      return g.get('name') === 'maxHandlerShape';\n    }); // 2. 右滑块的滑动\n\n    if (maxHandleShapeGroup) {\n      maxHandleShapeGroup.off('maxHandlerShape-handler:mousedown');\n      maxHandleShapeGroup.off('maxHandlerShape-handler:touchstart');\n      maxHandleShapeGroup.destroy();\n    } // 3. 前景选中区域\n\n\n    this.foregroundShape.off('mousedown');\n    this.foregroundShape.off('touchstart');\n    this.foregroundShape.destroy();\n    group.off(PLAY_PAUSE_BTN + \":click\");\n    group.off(NEXT_STEP_BTN + \":click\");\n    group.off(PRE_STEP_BTN + \":click\");\n    group.off(TIMEBAR_CONFIG_CHANGE);\n    group.destroy();\n\n    if (this.trendComponent) {\n      this.trendComponent.destory();\n    }\n  };\n\n  return TrendTimeBar;\n}();\n\nexport default TrendTimeBar;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/plugins/timeBar/trendTimeBar.js"],"names":["__assign","get","size","assign","each","Trend","Handler","ControllerBtn","VALUE_CHANGE","TIMELINE_START","TIMEBAR_CONFIG_CHANGE","PLAY_PAUSE_BTN","NEXT_STEP_BTN","PRE_STEP_BTN","TIMELINE_END","BACKGROUND_STYLE","fill","opacity","SIMPLE_BACKGROUND_STYLE","radius","FOREGROUND_STYLE","cursor","DEFAULT_HANDLER_WIDTH","HANDLER_STYLE","width","height","TEXT_STYLE","textBaseline","TrendTimeBar","cfg","_this","prevX","onMouseDown","handler","e","currentHandler","event","originalEvent","stopPropagation","preventDefault","pageX","containerDOM","canvas","addEventListener","onMouseMove","onMouseUp","x","offsetX","offsetXRange","adjustOffsetRange","updateStartEnd","updateUI","undefined","removeEventListener","_a","_b","y","_c","_d","padding","trendCfg","_e","controllerCfg","speed","_f","backgroundStyle","_g","foregroundStyle","_h","handlerStyle","_j","textStyle","_k","start","_l","end","_m","minText","_o","maxText","group","graph","ticks","type","timeBarType","currentSpeed","currentMode","renderSlider","prototype","update","Math","min","max","setText","minTextShape","attr","maxTextShape","trendComponent","sliderGroup","addGroup","name","addShape","attrs","textGroup","textAlign","text","silent","capture","foregroundShape","handlerWidth","handlerHeight","minHandleGroup","minHandlerShape","maxHandleGroup","maxHandlerShape","tickData","interval","length","tickPosList","textList","forEach","destroy","lastX","Infinity","map","tick","index","push","line","x1","y1","x2","y2","lineWidth","stroke","bbox","getBBox","minX","show","hide","controllerBtnGroup","move","bindEvents","minHandleShapeGroup","find","on","maxHandleShapeGroup","isPlay","changePlayStatus","adjustTickIndex","timeSelectX","i","abs","offsetRange","dodgeText","minAttrs","maxAttrs","setX","v","k","emit","value","sort","range","PADDING","sorted","minBBox","maxBBox","startPlay","window","requestAnimationFrame","tickInterval","playHandler","isSync","playButton","cancelAnimationFrame","destory","off","g"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { get, size, assign, each } from '@antv/util';\nimport Trend from './trend';\nimport Handler from './handler';\nimport ControllerBtn from './controllerBtn';\nimport { VALUE_CHANGE, TIMELINE_START, TIMEBAR_CONFIG_CHANGE, PLAY_PAUSE_BTN, NEXT_STEP_BTN, PRE_STEP_BTN, TIMELINE_END } from './constant';\n/**\n * 一些默认的样式配置\n */\n\nexport var BACKGROUND_STYLE = {\n  fill: '#416180',\n  opacity: 0.05\n};\nvar SIMPLE_BACKGROUND_STYLE = {\n  fill: '#416180',\n  opacity: 0.15,\n  radius: 5\n};\nexport var FOREGROUND_STYLE = {\n  fill: '#5B8FF9',\n  opacity: 0.3,\n  cursor: 'move'\n};\nexport var DEFAULT_HANDLER_WIDTH = 2;\nexport var HANDLER_STYLE = {\n  width: DEFAULT_HANDLER_WIDTH,\n  height: 24\n};\nexport var TEXT_STYLE = {\n  textBaseline: 'middle',\n  fill: '#000',\n  opacity: 0.45\n};\n\nvar TrendTimeBar =\n/** @class */\nfunction () {\n  function TrendTimeBar(cfg) {\n    var _this = this;\n\n    this.prevX = 0;\n\n    this.onMouseDown = function (handler) {\n      return function (e) {\n        // 1. 记录点击的滑块\n        _this.currentHandler = handler;\n        var event = e.originalEvent; // 2. 存储当前点击位置\n\n        event.stopPropagation();\n        event.preventDefault(); // 兼容移动端获取数据\n\n        _this.prevX = get(event, 'touches.0.pageX', event.pageX); // 3. 开始滑动的时候，绑定 move 和 up 事件\n\n        var containerDOM = _this.canvas.get('container');\n\n        containerDOM.addEventListener('mousemove', _this.onMouseMove);\n        containerDOM.addEventListener('mouseup', _this.onMouseUp);\n        containerDOM.addEventListener('mouseleave', _this.onMouseUp); // 移动端事件\n\n        containerDOM.addEventListener('touchmove', _this.onMouseMove);\n        containerDOM.addEventListener('touchend', _this.onMouseUp);\n        containerDOM.addEventListener('touchcancel', _this.onMouseUp);\n      };\n    };\n\n    this.onMouseMove = function (e) {\n      // 滑动过程中，计算偏移，更新滑块，然后 emit 数据出去\n      e.stopPropagation();\n      e.preventDefault();\n      var x = get(e, 'touches.0.pageX', e.pageX); // 横向的 slider 只处理 x\n\n      var offsetX = x - _this.prevX;\n\n      var offsetXRange = _this.adjustOffsetRange(offsetX / _this.width); // 更新 start end range 范围\n\n\n      _this.updateStartEnd(offsetXRange); // 更新 ui\n\n\n      _this.updateUI();\n\n      _this.prevX = x;\n    };\n\n    this.onMouseUp = function () {\n      // 结束之后，取消绑定的事件\n      if (_this.currentHandler) {\n        _this.currentHandler = undefined;\n      }\n\n      var containerDOM = _this.canvas.get('container');\n\n      if (containerDOM) {\n        containerDOM.removeEventListener('mousemove', _this.onMouseMove);\n        containerDOM.removeEventListener('mouseup', _this.onMouseUp); // 防止滑动到 canvas 外部之后，状态丢失\n\n        containerDOM.removeEventListener('mouseleave', _this.onMouseUp); // 移动端事件\n\n        containerDOM.removeEventListener('touchmove', _this.onMouseMove);\n        containerDOM.removeEventListener('touchend', _this.onMouseUp);\n        containerDOM.removeEventListener('touchcancel', _this.onMouseUp);\n      }\n    };\n\n    var _a = cfg.x,\n        x = _a === void 0 ? 0 : _a,\n        _b = cfg.y,\n        y = _b === void 0 ? 0 : _b,\n        _c = cfg.width,\n        width = _c === void 0 ? 100 : _c,\n        height = cfg.height,\n        _d = cfg.padding,\n        padding = _d === void 0 ? 10 : _d,\n        trendCfg = cfg.trendCfg,\n        _e = cfg.controllerCfg,\n        controllerCfg = _e === void 0 ? {\n      speed: 1\n    } : _e,\n        _f = cfg.backgroundStyle,\n        backgroundStyle = _f === void 0 ? {} : _f,\n        _g = cfg.foregroundStyle,\n        foregroundStyle = _g === void 0 ? {} : _g,\n        _h = cfg.handlerStyle,\n        handlerStyle = _h === void 0 ? {} : _h,\n        _j = cfg.textStyle,\n        textStyle = _j === void 0 ? {} : _j,\n        // 缩略轴的初始位置\n    _k = cfg.start,\n        // 缩略轴的初始位置\n    start = _k === void 0 ? 0 : _k,\n        _l = cfg.end,\n        end = _l === void 0 ? 1 : _l,\n        _m = cfg.minText,\n        minText = _m === void 0 ? '' : _m,\n        _o = cfg.maxText,\n        maxText = _o === void 0 ? '' : _o,\n        group = cfg.group,\n        graph = cfg.graph,\n        canvas = cfg.canvas,\n        ticks = cfg.ticks,\n        type = cfg.type;\n    this.graph = graph;\n    this.canvas = canvas;\n    this.group = group;\n    this.timeBarType = type; // position size\n\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.padding = padding;\n    this.ticks = ticks;\n    this.trendCfg = trendCfg;\n    this.controllerCfg = controllerCfg;\n    this.currentSpeed = controllerCfg.speed; // style\n\n    if (type === 'trend') {\n      this.backgroundStyle = __assign(__assign({}, BACKGROUND_STYLE), backgroundStyle);\n    } else if (type === 'simple') {\n      this.backgroundStyle = __assign(__assign({}, SIMPLE_BACKGROUND_STYLE), backgroundStyle);\n    }\n\n    this.foregroundStyle = __assign(__assign({}, FOREGROUND_STYLE), foregroundStyle);\n    this.handlerStyle = __assign(__assign({}, HANDLER_STYLE), handlerStyle);\n    this.textStyle = __assign(__assign({}, TEXT_STYLE), textStyle);\n    this.currentMode = 'range'; // 初始信息\n\n    this.start = start;\n    this.end = end;\n    this.minText = minText;\n    this.maxText = maxText;\n    this.renderSlider();\n  }\n  /**\n   * 更新配置\n   * @param cfg\n   */\n\n\n  TrendTimeBar.prototype.update = function (cfg) {\n    var x = cfg.x,\n        y = cfg.y,\n        width = cfg.width,\n        height = cfg.height,\n        minText = cfg.minText,\n        maxText = cfg.maxText,\n        start = cfg.start,\n        end = cfg.end; // start、end 只能是 0~1 范围\n\n    this.start = Math.min(1, Math.max(start, 0));\n    this.end = Math.min(1, Math.max(end, 0)); // 如果传了则更新，没有传则不更新\n    // @ts-ignore\n\n    assign(this, {\n      x: x,\n      y: y,\n      width: width,\n      height: height,\n      minText: minText,\n      maxText: maxText\n    }); // 更新 ui，不自动绘制\n\n    this.updateUI();\n  };\n\n  TrendTimeBar.prototype.setText = function (minText, maxText) {\n    this.minTextShape.attr('text', minText);\n    this.maxTextShape.attr('text', maxText);\n  };\n  /**\n   * 初始化组件结构\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.renderSlider = function () {\n    var _this = this;\n\n    var _a = this,\n        width = _a.width,\n        height = _a.height,\n        timeBarType = _a.timeBarType; // 趋势图数据\n\n\n    if (timeBarType === 'trend' && size(get(this.trendCfg, 'data'))) {\n      var trendComponent = new Trend(__assign(__assign({\n        x: this.x,\n        y: this.y,\n        width: width,\n        height: height\n      }, this.trendCfg), {\n        group: this.group\n      }));\n      this.trendComponent = trendComponent;\n    }\n\n    var sliderGroup = this.group.addGroup({\n      name: 'slider-group'\n    }); // 1. 背景\n\n    sliderGroup.addShape('rect', {\n      attrs: __assign({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height\n      }, this.backgroundStyle)\n    });\n    var textGroup = this.group.addGroup(); // 2. 左右文字\n\n    if (timeBarType === 'trend') {\n      this.minTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          x: 0,\n          y: height / 2 + this.y,\n          textAlign: 'right',\n          text: this.minText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n      this.maxTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          y: height / 2 + this.y,\n          textAlign: 'left',\n          text: this.maxText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n    } else {\n      this.minTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          x: 0,\n          y: this.y - 10,\n          textAlign: 'center',\n          text: this.minText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n      this.maxTextShape = textGroup.addShape('text', {\n        attrs: __assign({\n          y: this.y - 10,\n          textAlign: 'center',\n          text: this.maxText,\n          silent: false\n        }, this.textStyle),\n        capture: false\n      });\n    } // 3. 前景 选中背景框\n\n\n    this.foregroundShape = this.group.addGroup().addShape('rect', {\n      attrs: __assign({\n        x: 0,\n        y: this.y,\n        height: height\n      }, this.foregroundStyle)\n    }); // 滑块相关的大小信息\n\n    var handlerWidth = get(this.handlerStyle, 'width', 2);\n    var handlerHeight = get(this.handlerStyle, 'height', 24);\n    var minHandleGroup = this.group.addGroup({\n      name: 'minHandlerShape'\n    }); // 4. 左右滑块\n\n    this.minHandlerShape = new Handler(__assign({\n      name: 'minHandlerShape',\n      group: minHandleGroup,\n      type: timeBarType,\n      x: this.x,\n      y: this.y,\n      width: handlerWidth,\n      height: handlerHeight,\n      cursor: 'ew-resize'\n    }, this.handlerStyle));\n    var maxHandleGroup = this.group.addGroup({\n      name: 'maxHandlerShape'\n    });\n    this.maxHandlerShape = new Handler(__assign({\n      name: 'maxHandlerShape',\n      group: maxHandleGroup,\n      type: timeBarType,\n      x: this.x,\n      y: this.y,\n      width: handlerWidth,\n      height: handlerHeight,\n      cursor: 'ew-resize'\n    }, this.handlerStyle)); // 缩略图下面的时间刻度\n\n    var tickData = this.ticks;\n    var interval = width / (tickData.length - 1);\n    this.tickPosList = [];\n\n    if (this.textList && this.textList.length) {\n      this.textList.forEach(function (text) {\n        text.destroy();\n      });\n    }\n\n    var lastX = -Infinity;\n    this.textList = tickData.map(function (tick, index) {\n      _this.tickPosList.push(_this.x + index * interval); // 文本刻度\n\n\n      var text = _this.group.addShape('text', {\n        attrs: {\n          x: _this.x + index * interval,\n          y: _this.y + height + 5,\n          text: tick,\n          textAlign: 'center',\n          textBaseline: 'top',\n          fill: '#607889',\n          opacity: 0.35\n        }\n      }); // 文本刻度上面的竖线\n\n\n      var line = _this.group.addShape('line', {\n        attrs: {\n          x1: _this.x + index * interval,\n          y1: _this.y + height + 2,\n          x2: _this.x + index * interval,\n          y2: _this.y + height + 6,\n          lineWidth: 1,\n          stroke: '#ccc'\n        }\n      });\n\n      var bbox = text.getBBox(); // 抽样，标签与标签间距不小于 10\n\n      if (bbox.minX > lastX) {\n        text.show();\n        line.show();\n        lastX = bbox.minX + bbox.width + 10;\n      } else {\n        text.hide();\n        line.hide();\n      }\n\n      return text;\n    }); // 渲染播放、快进和后退的控制按钮\n\n    this.controllerBtnGroup = new ControllerBtn({\n      group: this.group,\n      x: this.x,\n      y: this.y + height + 25,\n      width: width,\n      height: 40\n    }); // 根据 start end 更新 ui 的位置信息\n\n    this.updateUI(); // 移动到对应的位置\n\n    sliderGroup.move(this.x, this.y); // 绑定事件鼠标事件\n\n    this.bindEvents();\n  };\n  /**\n   * 绑定事件：\n   *  - 点击\n   *  - 滑动\n   *  - 拖拽\n   *  - 滚动\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.bindEvents = function () {\n    var _this = this; // 1. 左滑块的滑动\n\n\n    var minHandleShapeGroup = this.group.find(function (group) {\n      return group.get('name') === 'minHandlerShape';\n    });\n\n    if (minHandleShapeGroup) {\n      minHandleShapeGroup.on('minHandlerShape-handler:mousedown', this.onMouseDown(this.minHandlerShape));\n      minHandleShapeGroup.on('minHandlerShape-handler:touchstart', this.onMouseDown(this.minHandlerShape));\n    }\n\n    var maxHandleShapeGroup = this.group.find(function (group) {\n      return group.get('name') === 'maxHandlerShape';\n    }); // 2. 右滑块的滑动\n\n    if (maxHandleShapeGroup) {\n      maxHandleShapeGroup.on('maxHandlerShape-handler:mousedown', this.onMouseDown(this.maxHandlerShape));\n      maxHandleShapeGroup.on('maxHandlerShape-handler:touchstart', this.onMouseDown(this.maxHandlerShape));\n    } // 3. 前景选中区域\n\n\n    this.foregroundShape.on('mousedown', this.onMouseDown(this.foregroundShape));\n    this.foregroundShape.on('touchstart', this.onMouseDown(this.foregroundShape)); // 播放区按钮控制\n\n    /** 播放/暂停事件 */\n\n    this.group.on(PLAY_PAUSE_BTN + \":click\", function () {\n      _this.isPlay = !_this.isPlay;\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.changePlayStatus();\n    }); // 处理前进一步的事件\n\n    this.group.on(NEXT_STEP_BTN + \":click\", function () {\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.updateStartEnd(0.01);\n\n      _this.updateUI();\n    }); // 处理后退一步的事件\n\n    this.group.on(PRE_STEP_BTN + \":click\", function () {\n      _this.currentHandler = _this.maxHandlerShape;\n\n      _this.updateStartEnd(-0.01);\n\n      _this.updateUI();\n    });\n    this.group.on(TIMEBAR_CONFIG_CHANGE, function (_a) {\n      var type = _a.type,\n          speed = _a.speed;\n      _this.currentSpeed = speed;\n      _this.currentMode = type;\n\n      if (type === 'single') {\n        _this.minHandlerShape.hide();\n\n        _this.foregroundShape.hide();\n\n        _this.minTextShape.hide();\n      } else if (type === 'range') {\n        _this.minHandlerShape.show();\n\n        _this.foregroundShape.show();\n\n        _this.minTextShape.show();\n      }\n    });\n  };\n  /** 输入当前圆点位置，输出离哪个 tick 的位置最近 */\n\n\n  TrendTimeBar.prototype.adjustTickIndex = function (timeSelectX) {\n    for (var i = 0; i < this.tickPosList.length - 1; i++) {\n      if (this.tickPosList[i] <= timeSelectX && timeSelectX <= this.tickPosList[i + 1]) {\n        return Math.abs(this.tickPosList[i] - timeSelectX) < Math.abs(timeSelectX - this.tickPosList[i + 1]) ? i : i + 1;\n      }\n    }\n  };\n  /**\n   * 调整 offsetRange，因为一些范围的限制\n   * @param offsetRange\n   */\n\n\n  TrendTimeBar.prototype.adjustOffsetRange = function (offsetRange) {\n    // 针对不同的滑动组件，处理的方式不同\n    switch (this.currentHandler) {\n      case this.minHandlerShape:\n        {\n          var min = 0 - this.start;\n          var max = 1 - this.start;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      case this.maxHandlerShape:\n        {\n          var min = 0 - this.end;\n          var max = 1 - this.end;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      case this.foregroundShape:\n        {\n          var min = 0 - this.start;\n          var max = 1 - this.end;\n          return Math.min(max, Math.max(min, offsetRange));\n        }\n\n      default:\n        return 0;\n    }\n  };\n  /**\n   * 更新起始、结束的控制块位置、文本、范围值（原始值）\n   * @param offsetRange\n   */\n\n\n  TrendTimeBar.prototype.updateStartEnd = function (offsetRange) {\n    // 操作不同的组件，反馈不一样\n    switch (this.currentHandler) {\n      case this.minHandlerShape:\n        // 拖动最小滑块时使用当前最大值设置最大值的文本，以便恢复到默认值\n        this.maxText = this.maxTextShape.attr('text');\n        this.start += offsetRange;\n        this.minText = this.ticks[this.adjustTickIndex(this.start * this.width)];\n        break;\n\n      case this.maxHandlerShape:\n        // 拖动最大滑块时使用当前最小值设置最小值的文本，以便恢复到默认值\n        this.minText = this.minTextShape.attr('text');\n        this.end += offsetRange;\n        this.maxText = this.ticks[this.adjustTickIndex(this.end * this.width)];\n        break;\n\n      case this.foregroundShape:\n        this.start += offsetRange;\n        this.end += offsetRange;\n        this.minText = this.ticks[this.adjustTickIndex(this.start * this.width)];\n        this.maxText = this.ticks[this.adjustTickIndex(this.end * this.width)];\n        break;\n\n      default:\n        break;\n    }\n  };\n  /**\n   * 根据移动的比例来更新 ui，更新范围（0-1 范围的比例值）\n   * @private\n   */\n\n\n  TrendTimeBar.prototype.updateUI = function () {\n    var _this = this;\n\n    if (this.start < 0) {\n      this.start = 0;\n    }\n\n    if (this.end > 1) {\n      this.end = 1;\n    }\n\n    var min = this.start * this.width;\n    var max = this.end * this.width; // 1. foreground\n\n    this.foregroundShape.attr('x', min);\n    this.foregroundShape.attr('width', max - min); // 滑块相关的大小信息\n\n    var handlerWidth = get(this.handlerStyle, 'width', DEFAULT_HANDLER_WIDTH); // 设置文本\n\n    this.setText(this.minText, this.maxText);\n\n    var _a = this.dodgeText([min, max]),\n        minAttrs = _a[0],\n        maxAttrs = _a[1]; // 2. 左侧滑块和文字位置\n\n\n    this.minHandlerShape.setX(min - handlerWidth / 2);\n    each(minAttrs, function (v, k) {\n      return _this.minTextShape.attr(k, v);\n    }); // 3. 右侧滑块和文字位置\n\n    this.maxHandlerShape.setX(max - handlerWidth / 2);\n    each(maxAttrs, function (v, k) {\n      return _this.maxTextShape.attr(k, v);\n    });\n\n    if (this.currentMode === 'range') {\n      // 因为存储的 start、end 可能不一定是按大小存储的，所以排序一下，对外是 end >= start\n      this.graph.emit(VALUE_CHANGE, {\n        value: [this.start, this.end].sort()\n      });\n    } else if (this.currentMode === 'single') {\n      this.graph.emit(VALUE_CHANGE, {\n        value: [this.end, this.end]\n      });\n    }\n  };\n  /**\n   * 调整 text 的位置，自动躲避\n   * 根据位置，调整返回新的位置\n   * @param range\n   */\n\n\n  TrendTimeBar.prototype.dodgeText = function (range) {\n    var _a, _b;\n\n    var PADDING = 2;\n    var handlerWidth = get(this.handlerStyle, 'width', DEFAULT_HANDLER_WIDTH);\n    var minTextShape = this.minTextShape;\n    var maxTextShape = this.maxTextShape;\n    var min = range[0],\n        max = range[1];\n    var sorted = false; // 如果交换了位置，则对应的 min max 也交互\n\n    if (min > max) {\n      _a = [max, min], min = _a[0], max = _a[1];\n      _b = [maxTextShape, minTextShape], minTextShape = _b[0], maxTextShape = _b[1];\n      sorted = true;\n    } // 避让规则，优先显示在两侧，只有显示不下的时候，才显示在中间\n\n\n    var minBBox = minTextShape.getBBox();\n    var maxBBox = maxTextShape.getBBox();\n    var minAttrs = null;\n    var maxAttrs = null;\n\n    if (this.timeBarType === 'trend') {\n      minAttrs = minBBox.width > min - PADDING ? {\n        x: min + handlerWidth / 2 + PADDING,\n        textAlign: 'left'\n      } : {\n        x: min - handlerWidth / 2 - PADDING,\n        textAlign: 'right'\n      };\n      maxAttrs = maxBBox.width > this.width - max - PADDING ? {\n        x: max - handlerWidth / 2 - PADDING,\n        textAlign: 'right'\n      } : {\n        x: max + handlerWidth / 2 + PADDING,\n        textAlign: 'left'\n      };\n    } else if (this.timeBarType === 'simple') {\n      minAttrs = minBBox.width > min - PADDING ? {\n        x: min + handlerWidth / 2 + PADDING,\n        textAlign: 'center'\n      } : {\n        x: min - handlerWidth / 2 - PADDING,\n        textAlign: 'center'\n      };\n      maxAttrs = maxBBox.width > this.width - max - PADDING ? {\n        x: max - handlerWidth / 2 - PADDING,\n        textAlign: 'center'\n      } : {\n        x: max + handlerWidth / 2 + PADDING,\n        textAlign: 'center'\n      };\n    }\n\n    return !sorted ? [minAttrs, maxAttrs] : [maxAttrs, minAttrs];\n  };\n\n  TrendTimeBar.prototype.startPlay = function () {\n    var _this = this;\n\n    return window.requestAnimationFrame(function () {\n      var _a = _this,\n          ticks = _a.ticks,\n          width = _a.width;\n      var speed = _this.currentSpeed;\n      var tickInterval = width / ticks.length;\n      var offsetX = tickInterval / ((10 - speed) * 1000 / 60);\n\n      var offsetXRange = _this.adjustOffsetRange(offsetX / _this.width);\n\n      _this.updateStartEnd(offsetXRange);\n\n      _this.updateUI();\n\n      if (_this.isPlay) {\n        _this.playHandler = _this.startPlay();\n      }\n    });\n  };\n\n  TrendTimeBar.prototype.changePlayStatus = function (isSync) {\n    if (isSync === void 0) {\n      isSync = true;\n    }\n\n    this.controllerBtnGroup.playButton.update({\n      isPlay: this.isPlay\n    });\n\n    if (this.isPlay) {\n      // 开始播放\n      this.playHandler = this.startPlay();\n      this.graph.emit(TIMELINE_START, null);\n    } else {\n      // 结束播放\n      if (this.playHandler) {\n        window.cancelAnimationFrame(this.playHandler);\n\n        if (isSync) {\n          this.graph.emit(TIMELINE_END, null);\n        }\n      }\n    }\n  };\n\n  TrendTimeBar.prototype.destory = function () {\n    this.graph.off(VALUE_CHANGE);\n    var group = this.group;\n    var minHandleShapeGroup = group.find(function (g) {\n      return g.get('name') === 'minHandlerShape';\n    });\n\n    if (minHandleShapeGroup) {\n      minHandleShapeGroup.off('minHandlerShape-handler:mousedown');\n      minHandleShapeGroup.off('minHandlerShape-handler:touchstart');\n      minHandleShapeGroup.destroy();\n    }\n\n    var maxHandleShapeGroup = group.find(function (g) {\n      return g.get('name') === 'maxHandlerShape';\n    }); // 2. 右滑块的滑动\n\n    if (maxHandleShapeGroup) {\n      maxHandleShapeGroup.off('maxHandlerShape-handler:mousedown');\n      maxHandleShapeGroup.off('maxHandlerShape-handler:touchstart');\n      maxHandleShapeGroup.destroy();\n    } // 3. 前景选中区域\n\n\n    this.foregroundShape.off('mousedown');\n    this.foregroundShape.off('touchstart');\n    this.foregroundShape.destroy();\n    group.off(PLAY_PAUSE_BTN + \":click\");\n    group.off(NEXT_STEP_BTN + \":click\");\n    group.off(PRE_STEP_BTN + \":click\");\n    group.off(TIMEBAR_CONFIG_CHANGE);\n    group.destroy();\n\n    if (this.trendComponent) {\n      this.trendComponent.destory();\n    }\n  };\n\n  return TrendTimeBar;\n}();\n\nexport default TrendTimeBar;"]},"metadata":{},"sourceType":"module"}