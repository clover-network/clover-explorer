{"ast":null,"code":"import { __assign } from \"tslib\";\nimport isNumber from '@antv/util/lib/is-number';\nimport isString from '@antv/util/lib/is-string';\nimport { formatPadding } from '../../util/base';\nimport { applyMatrix, invertMatrix } from '../../util/math';\nimport modifyCSS from '@antv/dom-util/lib/modify-css';\n\nvar ViewController =\n/** @class */\nfunction () {\n  function ViewController(graph) {\n    this.destroyed = false;\n    this.graph = graph;\n    this.destroyed = false;\n  } // get view center coordinate\n\n\n  ViewController.prototype.getViewCenter = function () {\n    var padding = this.getFormatPadding();\n    var graph = this.graph;\n    var width = this.graph.get('width');\n    var height = graph.get('height');\n    return {\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\n    };\n  };\n\n  ViewController.prototype.fitCenter = function () {\n    var graph = this.graph;\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n  }; // fit view graph\n\n\n  ViewController.prototype.fitView = function () {\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var w = (width - padding[1] - padding[3]) / bbox.width;\n    var h = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio = w;\n\n    if (w > h) {\n      ratio = h;\n    }\n\n    graph.zoom(ratio, viewCenter);\n  };\n\n  ViewController.prototype.getFormatPadding = function () {\n    var padding = this.graph.get('fitViewPadding');\n    return formatPadding(padding);\n  };\n\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\n    var _this = this;\n\n    var viewCenter = this.getViewCenter();\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\n    var viewportMatrix = this.graph.get('group').getMatrix();\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (animate) {\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\n      var lastX_1 = 0;\n      var lastY_1 = 0;\n      var newX_1 = 0;\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\n\n      this.graph.get('canvas').animate(function (ratio) {\n        newX_1 = dx_1 * ratio;\n        newY_1 = dy_1 * ratio;\n\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\n\n        lastX_1 = newX_1;\n        lastY_1 = newY_1;\n      }, __assign({}, animateCfg));\n    } else {\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\n    }\n  };\n  /**\n   * 将 Canvas 坐标转成视口坐标\n   * @param canvasX canvas x 坐标\n   * @param canvasY canvas y 坐标\n   */\n\n\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    var point = invertMatrix({\n      x: canvasX,\n      y: canvasY\n    }, viewportMatrix);\n    return point;\n  };\n  /**\n   * 将页面坐标转成视口坐标\n   * @param clientX 页面 x 坐标\n   * @param clientY 页面 y 坐标\n   */\n\n\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\n  };\n  /**\n   * 将视口坐标转成页面坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getClientByPoint = function (x, y) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = this.getCanvasByPoint(x, y);\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y); // return { x: point.clientX, y: point.clientY };\n\n    return {\n      x: point.x,\n      y: point.y\n    };\n  };\n  /**\n   * 将视口坐标转成 Canvas 坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return applyMatrix({\n      x: x,\n      y: y\n    }, viewportMatrix);\n  };\n  /**\n   * 将元素移动到画布中心\n   * @param item Item 实例或 id\n   * @param {boolean} animate 是否带有动画地移动\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\n   */\n\n\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\n    if (isString(item)) {\n      item = this.graph.findById(item);\n    }\n\n    var group = item.get('group');\n    var matrix = group.getMatrix();\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (item) {\n      // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\n      this.focusPoint({\n        x: matrix[6],\n        y: matrix[7]\n      }, animate, animateCfg);\n    }\n  };\n  /**\n   * 改变 canvas 画布的宽度和高度\n   * @param width canvas 宽度\n   * @param height canvas 高度\n   */\n\n\n  ViewController.prototype.changeSize = function (width, height) {\n    var graph = this.graph;\n\n    if (!isNumber(width) || !isNumber(height)) {\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\n    }\n\n    graph.set({\n      width: width,\n      height: height\n    });\n    var canvas = graph.get('canvas');\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\n\n    var plugins = graph.get('plugins');\n    plugins.forEach(function (plugin) {\n      if (plugin.get('gridContainer')) {\n        var minZoom = graph.get('minZoom');\n        modifyCSS(plugin.get('container'), {\n          width: width + \"px\",\n          height: height + \"px\"\n        });\n        modifyCSS(plugin.get('gridContainer'), {\n          width: width / minZoom + \"px\",\n          height: height / minZoom + \"px\",\n          left: 0,\n          top: 0\n        });\n      }\n    });\n  };\n\n  ViewController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = false;\n  };\n\n  return ViewController;\n}();\n\nexport default ViewController;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/graph/controller/view.js"],"names":["__assign","isNumber","isString","formatPadding","applyMatrix","invertMatrix","modifyCSS","ViewController","graph","destroyed","prototype","getViewCenter","padding","getFormatPadding","width","get","height","x","y","fitCenter","group","resetMatrix","bbox","getCanvasBBox","viewCenter","groupCenter","translate","fitView","w","h","ratio","zoom","focusPoint","point","animate","animateCfg","_this","modelCenter","getPointByCanvas","viewportMatrix","getMatrix","dx_1","dy_1","lastX_1","lastY_1","newX_1","newY_1","canvasX","canvasY","getPointByClient","clientX","clientY","canvas","canvasPoint","getClientByPoint","getCanvasByPoint","focus","item","findById","matrix","changeSize","Error","set","plugins","forEach","plugin","minZoom","left","top","destroy"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport isNumber from '@antv/util/lib/is-number';\nimport isString from '@antv/util/lib/is-string';\nimport { formatPadding } from '../../util/base';\nimport { applyMatrix, invertMatrix } from '../../util/math';\nimport modifyCSS from '@antv/dom-util/lib/modify-css';\n\nvar ViewController =\n/** @class */\nfunction () {\n  function ViewController(graph) {\n    this.destroyed = false;\n    this.graph = graph;\n    this.destroyed = false;\n  } // get view center coordinate\n\n\n  ViewController.prototype.getViewCenter = function () {\n    var padding = this.getFormatPadding();\n    var graph = this.graph;\n    var width = this.graph.get('width');\n    var height = graph.get('height');\n    return {\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\n    };\n  };\n\n  ViewController.prototype.fitCenter = function () {\n    var graph = this.graph;\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n  }; // fit view graph\n\n\n  ViewController.prototype.fitView = function () {\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var w = (width - padding[1] - padding[3]) / bbox.width;\n    var h = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio = w;\n\n    if (w > h) {\n      ratio = h;\n    }\n\n    graph.zoom(ratio, viewCenter);\n  };\n\n  ViewController.prototype.getFormatPadding = function () {\n    var padding = this.graph.get('fitViewPadding');\n    return formatPadding(padding);\n  };\n\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\n    var _this = this;\n\n    var viewCenter = this.getViewCenter();\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\n    var viewportMatrix = this.graph.get('group').getMatrix();\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (animate) {\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\n      var lastX_1 = 0;\n      var lastY_1 = 0;\n      var newX_1 = 0;\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\n\n      this.graph.get('canvas').animate(function (ratio) {\n        newX_1 = dx_1 * ratio;\n        newY_1 = dy_1 * ratio;\n\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\n\n        lastX_1 = newX_1;\n        lastY_1 = newY_1;\n      }, __assign({}, animateCfg));\n    } else {\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\n    }\n  };\n  /**\n   * 将 Canvas 坐标转成视口坐标\n   * @param canvasX canvas x 坐标\n   * @param canvasY canvas y 坐标\n   */\n\n\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    var point = invertMatrix({\n      x: canvasX,\n      y: canvasY\n    }, viewportMatrix);\n    return point;\n  };\n  /**\n   * 将页面坐标转成视口坐标\n   * @param clientX 页面 x 坐标\n   * @param clientY 页面 y 坐标\n   */\n\n\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\n  };\n  /**\n   * 将视口坐标转成页面坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getClientByPoint = function (x, y) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = this.getCanvasByPoint(x, y);\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y); // return { x: point.clientX, y: point.clientY };\n\n    return {\n      x: point.x,\n      y: point.y\n    };\n  };\n  /**\n   * 将视口坐标转成 Canvas 坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return applyMatrix({\n      x: x,\n      y: y\n    }, viewportMatrix);\n  };\n  /**\n   * 将元素移动到画布中心\n   * @param item Item 实例或 id\n   * @param {boolean} animate 是否带有动画地移动\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\n   */\n\n\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\n    if (isString(item)) {\n      item = this.graph.findById(item);\n    }\n\n    var group = item.get('group');\n    var matrix = group.getMatrix();\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (item) {\n      // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\n      this.focusPoint({\n        x: matrix[6],\n        y: matrix[7]\n      }, animate, animateCfg);\n    }\n  };\n  /**\n   * 改变 canvas 画布的宽度和高度\n   * @param width canvas 宽度\n   * @param height canvas 高度\n   */\n\n\n  ViewController.prototype.changeSize = function (width, height) {\n    var graph = this.graph;\n\n    if (!isNumber(width) || !isNumber(height)) {\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\n    }\n\n    graph.set({\n      width: width,\n      height: height\n    });\n    var canvas = graph.get('canvas');\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\n\n    var plugins = graph.get('plugins');\n    plugins.forEach(function (plugin) {\n      if (plugin.get('gridContainer')) {\n        var minZoom = graph.get('minZoom');\n        modifyCSS(plugin.get('container'), {\n          width: width + \"px\",\n          height: height + \"px\"\n        });\n        modifyCSS(plugin.get('gridContainer'), {\n          width: width / minZoom + \"px\",\n          height: height / minZoom + \"px\",\n          left: 0,\n          top: 0\n        });\n      }\n    });\n  };\n\n  ViewController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = false;\n  };\n\n  return ViewController;\n}();\n\nexport default ViewController;"]},"metadata":{},"sourceType":"module"}