{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\"use strict\";\n\nexports.__esModule = true;\n\nvar graphic_1 = require(\"../util/graphic\");\n\nvar innerStore_1 = require(\"../util/innerStore\");\n\nvar number_1 = require(\"../util/number\");\n\nvar Transformable_1 = require(\"zrender/lib/core/Transformable\");\n\nvar labelGuideHelper_1 = require(\"./labelGuideHelper\");\n\nvar model_1 = require(\"../util/model\");\n\nvar util_1 = require(\"zrender/lib/core/util\");\n\nvar labelLayoutHelper_1 = require(\"./labelLayoutHelper\");\n\nvar labelStyle_1 = require(\"./labelStyle\");\n\nfunction cloneArr(points) {\n  if (points) {\n    var newPoints = [];\n\n    for (var i = 0; i < points.length; i++) {\n      newPoints.push(points[i].slice());\n    }\n\n    return newPoints;\n  }\n}\n\nfunction prepareLayoutCallbackParams(labelItem, hostEl) {\n  var label = labelItem.label;\n  var labelLine = hostEl && hostEl.getTextGuideLine();\n  return {\n    dataIndex: labelItem.dataIndex,\n    dataType: labelItem.dataType,\n    seriesIndex: labelItem.seriesModel.seriesIndex,\n    text: labelItem.label.style.text,\n    rect: labelItem.hostRect,\n    labelRect: labelItem.rect,\n    align: label.style.align,\n    verticalAlign: label.style.verticalAlign,\n    labelLinePoints: cloneArr(labelLine && labelLine.shape.points)\n  };\n}\n\nvar LABEL_OPTION_TO_STYLE_KEYS = ['align', 'verticalAlign', 'width', 'height', 'fontSize'];\nvar dummyTransformable = new Transformable_1[\"default\"]();\nvar labelLayoutInnerStore = model_1.makeInner();\nvar labelLineAnimationStore = model_1.makeInner();\n\nfunction extendWithKeys(target, source, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n\n    if (source[key] != null) {\n      target[key] = source[key];\n    }\n  }\n}\n\nvar LABEL_LAYOUT_PROPS = ['x', 'y', 'rotation'];\n\nvar LabelManager = function () {\n  function LabelManager() {\n    this._labelList = [];\n    this._chartViewList = [];\n  }\n\n  LabelManager.prototype.clearLabels = function () {\n    this._labelList = [];\n    this._chartViewList = [];\n  };\n\n  LabelManager.prototype._addLabel = function (dataIndex, dataType, seriesModel, label, layoutOption) {\n    var labelStyle = label.style;\n    var hostEl = label.__hostTarget;\n    var textConfig = hostEl.textConfig || {};\n    var labelTransform = label.getComputedTransform();\n    var labelRect = label.getBoundingRect().plain();\n    graphic_1.BoundingRect.applyTransform(labelRect, labelRect, labelTransform);\n\n    if (labelTransform) {\n      dummyTransformable.setLocalTransform(labelTransform);\n    } else {\n      dummyTransformable.x = dummyTransformable.y = dummyTransformable.rotation = dummyTransformable.originX = dummyTransformable.originY = 0;\n      dummyTransformable.scaleX = dummyTransformable.scaleY = 1;\n    }\n\n    var host = label.__hostTarget;\n    var hostRect;\n\n    if (host) {\n      hostRect = host.getBoundingRect().plain();\n      var transform = host.getComputedTransform();\n      graphic_1.BoundingRect.applyTransform(hostRect, hostRect, transform);\n    }\n\n    var labelGuide = hostRect && host.getTextGuideLine();\n\n    this._labelList.push({\n      label: label,\n      labelLine: labelGuide,\n      seriesModel: seriesModel,\n      dataIndex: dataIndex,\n      dataType: dataType,\n      layoutOption: layoutOption,\n      computedLayoutOption: null,\n      rect: labelRect,\n      hostRect: hostRect,\n      priority: hostRect ? hostRect.width * hostRect.height : 0,\n      defaultAttr: {\n        ignore: label.ignore,\n        labelGuideIgnore: labelGuide && labelGuide.ignore,\n        x: dummyTransformable.x,\n        y: dummyTransformable.y,\n        rotation: dummyTransformable.rotation,\n        style: {\n          x: labelStyle.x,\n          y: labelStyle.y,\n          align: labelStyle.align,\n          verticalAlign: labelStyle.verticalAlign,\n          width: labelStyle.width,\n          height: labelStyle.height,\n          fontSize: labelStyle.fontSize\n        },\n        cursor: label.cursor,\n        attachedPos: textConfig.position,\n        attachedRot: textConfig.rotation\n      }\n    });\n  };\n\n  LabelManager.prototype.addLabelsOfSeries = function (chartView) {\n    var _this = this;\n\n    this._chartViewList.push(chartView);\n\n    var seriesModel = chartView.__model;\n    var layoutOption = seriesModel.get('labelLayout');\n\n    if (!(util_1.isFunction(layoutOption) || util_1.keys(layoutOption).length)) {\n      return;\n    }\n\n    chartView.group.traverse(function (child) {\n      if (child.ignore) {\n        return true;\n      }\n\n      var textEl = child.getTextContent();\n      var ecData = innerStore_1.getECData(child);\n\n      if (textEl && !textEl.disableLabelLayout) {\n        _this._addLabel(ecData.dataIndex, ecData.dataType, seriesModel, textEl, layoutOption);\n      }\n    });\n  };\n\n  LabelManager.prototype.updateLayoutConfig = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n\n    function createDragHandler(el, labelLineModel) {\n      return function () {\n        labelGuideHelper_1.updateLabelLinePoints(el, labelLineModel);\n      };\n    }\n\n    for (var i = 0; i < this._labelList.length; i++) {\n      var labelItem = this._labelList[i];\n      var label = labelItem.label;\n      var hostEl = label.__hostTarget;\n      var defaultLabelAttr = labelItem.defaultAttr;\n      var layoutOption = void 0;\n\n      if (typeof labelItem.layoutOption === 'function') {\n        layoutOption = labelItem.layoutOption(prepareLayoutCallbackParams(labelItem, hostEl));\n      } else {\n        layoutOption = labelItem.layoutOption;\n      }\n\n      layoutOption = layoutOption || {};\n      labelItem.computedLayoutOption = layoutOption;\n      var degreeToRadian = Math.PI / 180;\n\n      if (hostEl) {\n        hostEl.setTextConfig({\n          local: false,\n          position: layoutOption.x != null || layoutOption.y != null ? null : defaultLabelAttr.attachedPos,\n          rotation: layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.attachedRot,\n          offset: [layoutOption.dx || 0, layoutOption.dy || 0]\n        });\n      }\n\n      var needsUpdateLabelLine = false;\n\n      if (layoutOption.x != null) {\n        label.x = number_1.parsePercent(layoutOption.x, width);\n        label.setStyle('x', 0);\n        needsUpdateLabelLine = true;\n      } else {\n        label.x = defaultLabelAttr.x;\n        label.setStyle('x', defaultLabelAttr.style.x);\n      }\n\n      if (layoutOption.y != null) {\n        label.y = number_1.parsePercent(layoutOption.y, height);\n        label.setStyle('y', 0);\n        needsUpdateLabelLine = true;\n      } else {\n        label.y = defaultLabelAttr.y;\n        label.setStyle('y', defaultLabelAttr.style.y);\n      }\n\n      if (layoutOption.labelLinePoints) {\n        var guideLine = hostEl.getTextGuideLine();\n\n        if (guideLine) {\n          guideLine.setShape({\n            points: layoutOption.labelLinePoints\n          });\n          needsUpdateLabelLine = false;\n        }\n      }\n\n      var labelLayoutStore = labelLayoutInnerStore(label);\n      labelLayoutStore.needsUpdateLabelLine = needsUpdateLabelLine;\n      label.rotation = layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.rotation;\n\n      for (var k = 0; k < LABEL_OPTION_TO_STYLE_KEYS.length; k++) {\n        var key = LABEL_OPTION_TO_STYLE_KEYS[k];\n        label.setStyle(key, layoutOption[key] != null ? layoutOption[key] : defaultLabelAttr.style[key]);\n      }\n\n      if (layoutOption.draggable) {\n        label.draggable = true;\n        label.cursor = 'move';\n\n        if (hostEl) {\n          var hostModel = labelItem.seriesModel;\n\n          if (labelItem.dataIndex != null) {\n            var data = labelItem.seriesModel.getData(labelItem.dataType);\n            hostModel = data.getItemModel(labelItem.dataIndex);\n          }\n\n          label.on('drag', createDragHandler(hostEl, hostModel.getModel('labelLine')));\n        }\n      } else {\n        label.off('drag');\n        label.cursor = defaultLabelAttr.cursor;\n      }\n    }\n  };\n\n  LabelManager.prototype.layout = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var labelList = labelLayoutHelper_1.prepareLayoutList(this._labelList);\n    var labelsNeedsAdjustOnX = util_1.filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftX';\n    });\n    var labelsNeedsAdjustOnY = util_1.filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftY';\n    });\n    labelLayoutHelper_1.shiftLayoutOnX(labelsNeedsAdjustOnX, 0, width);\n    labelLayoutHelper_1.shiftLayoutOnY(labelsNeedsAdjustOnY, 0, height);\n    var labelsNeedsHideOverlap = util_1.filter(labelList, function (item) {\n      return item.layoutOption.hideOverlap;\n    });\n    labelLayoutHelper_1.hideOverlap(labelsNeedsHideOverlap);\n  };\n\n  LabelManager.prototype.processLabelsOverall = function () {\n    var _this = this;\n\n    util_1.each(this._chartViewList, function (chartView) {\n      var seriesModel = chartView.__model;\n      var ignoreLabelLineUpdate = chartView.ignoreLabelLineUpdate;\n      var animationEnabled = seriesModel.isAnimationEnabled();\n      chartView.group.traverse(function (child) {\n        if (child.ignore) {\n          return true;\n        }\n\n        var needsUpdateLabelLine = !ignoreLabelLineUpdate;\n        var label = child.getTextContent();\n\n        if (!needsUpdateLabelLine && label) {\n          needsUpdateLabelLine = labelLayoutInnerStore(label).needsUpdateLabelLine;\n        }\n\n        if (needsUpdateLabelLine) {\n          _this._updateLabelLine(child, seriesModel);\n        }\n\n        if (animationEnabled) {\n          _this._animateLabels(child, seriesModel);\n        }\n      });\n    });\n  };\n\n  LabelManager.prototype._updateLabelLine = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var ecData = innerStore_1.getECData(el);\n    var dataIndex = ecData.dataIndex;\n\n    if (textEl && dataIndex != null) {\n      var data = seriesModel.getData(ecData.dataType);\n      var itemModel = data.getItemModel(dataIndex);\n      var defaultStyle = {};\n      var visualStyle = data.getItemVisual(dataIndex, 'style');\n      var visualType = data.getVisual('drawType');\n      defaultStyle.stroke = visualStyle[visualType];\n      var labelLineModel = itemModel.getModel('labelLine');\n      labelGuideHelper_1.setLabelLineStyle(el, labelGuideHelper_1.getLabelLineStatesModels(itemModel), defaultStyle);\n      labelGuideHelper_1.updateLabelLinePoints(el, labelLineModel);\n    }\n  };\n\n  LabelManager.prototype._animateLabels = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var guideLine = el.getTextGuideLine();\n\n    if (textEl && !textEl.ignore && !textEl.invisible && !el.disableLabelAnimation && !graphic_1.isElementRemoved(el)) {\n      var layoutStore = labelLayoutInnerStore(textEl);\n      var oldLayout = layoutStore.oldLayout;\n      var ecData = innerStore_1.getECData(el);\n      var dataIndex = ecData.dataIndex;\n      var newProps = {\n        x: textEl.x,\n        y: textEl.y,\n        rotation: textEl.rotation\n      };\n      var data = seriesModel.getData(ecData.dataType);\n\n      if (!oldLayout) {\n        textEl.attr(newProps);\n\n        if (!labelStyle_1.labelInner(textEl).valueAnimation) {\n          var oldOpacity = util_1.retrieve2(textEl.style.opacity, 1);\n          textEl.style.opacity = 0;\n          graphic_1.initProps(textEl, {\n            style: {\n              opacity: oldOpacity\n            }\n          }, seriesModel, dataIndex);\n        }\n      } else {\n        textEl.attr(oldLayout);\n        var prevStates = el.prevStates;\n\n        if (prevStates) {\n          if (util_1.indexOf(prevStates, 'select') >= 0) {\n            textEl.attr(layoutStore.oldLayoutSelect);\n          }\n\n          if (util_1.indexOf(prevStates, 'emphasis') >= 0) {\n            textEl.attr(layoutStore.oldLayoutEmphasis);\n          }\n        }\n\n        graphic_1.updateProps(textEl, newProps, seriesModel, dataIndex);\n      }\n\n      layoutStore.oldLayout = newProps;\n\n      if (textEl.states.select) {\n        var layoutSelect = layoutStore.oldLayoutSelect = {};\n        extendWithKeys(layoutSelect, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutSelect, textEl.states.select, LABEL_LAYOUT_PROPS);\n      }\n\n      if (textEl.states.emphasis) {\n        var layoutEmphasis = layoutStore.oldLayoutEmphasis = {};\n        extendWithKeys(layoutEmphasis, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutEmphasis, textEl.states.emphasis, LABEL_LAYOUT_PROPS);\n      }\n\n      labelStyle_1.animateLabelValue(textEl, dataIndex, data, seriesModel);\n    }\n\n    if (guideLine && !guideLine.ignore && !guideLine.invisible) {\n      var layoutStore = labelLineAnimationStore(guideLine);\n      var oldLayout = layoutStore.oldLayout;\n      var newLayout = {\n        points: guideLine.shape.points\n      };\n\n      if (!oldLayout) {\n        guideLine.setShape(newLayout);\n        guideLine.style.strokePercent = 0;\n        graphic_1.initProps(guideLine, {\n          style: {\n            strokePercent: 1\n          }\n        }, seriesModel);\n      } else {\n        guideLine.attr({\n          shape: oldLayout\n        });\n        graphic_1.updateProps(guideLine, {\n          shape: newLayout\n        }, seriesModel);\n      }\n\n      layoutStore.oldLayout = newLayout;\n    }\n  };\n\n  return LabelManager;\n}();\n\nexports[\"default\"] = LabelManager;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/echarts/lib/label/LabelManager.js"],"names":["exports","__esModule","graphic_1","require","innerStore_1","number_1","Transformable_1","labelGuideHelper_1","model_1","util_1","labelLayoutHelper_1","labelStyle_1","cloneArr","points","newPoints","i","length","push","slice","prepareLayoutCallbackParams","labelItem","hostEl","label","labelLine","getTextGuideLine","dataIndex","dataType","seriesIndex","seriesModel","text","style","rect","hostRect","labelRect","align","verticalAlign","labelLinePoints","shape","LABEL_OPTION_TO_STYLE_KEYS","dummyTransformable","labelLayoutInnerStore","makeInner","labelLineAnimationStore","extendWithKeys","target","source","keys","key","LABEL_LAYOUT_PROPS","LabelManager","_labelList","_chartViewList","prototype","clearLabels","_addLabel","layoutOption","labelStyle","__hostTarget","textConfig","labelTransform","getComputedTransform","getBoundingRect","plain","BoundingRect","applyTransform","setLocalTransform","x","y","rotation","originX","originY","scaleX","scaleY","host","transform","labelGuide","computedLayoutOption","priority","width","height","defaultAttr","ignore","labelGuideIgnore","fontSize","cursor","attachedPos","position","attachedRot","addLabelsOfSeries","chartView","_this","__model","get","isFunction","group","traverse","child","textEl","getTextContent","ecData","getECData","disableLabelLayout","updateLayoutConfig","api","getWidth","getHeight","createDragHandler","el","labelLineModel","updateLabelLinePoints","defaultLabelAttr","degreeToRadian","Math","PI","setTextConfig","local","rotate","offset","dx","dy","needsUpdateLabelLine","parsePercent","setStyle","guideLine","setShape","labelLayoutStore","k","draggable","hostModel","data","getData","getItemModel","on","getModel","off","layout","labelList","prepareLayoutList","labelsNeedsAdjustOnX","filter","item","moveOverlap","labelsNeedsAdjustOnY","shiftLayoutOnX","shiftLayoutOnY","labelsNeedsHideOverlap","hideOverlap","processLabelsOverall","each","ignoreLabelLineUpdate","animationEnabled","isAnimationEnabled","_updateLabelLine","_animateLabels","itemModel","defaultStyle","visualStyle","getItemVisual","visualType","getVisual","stroke","setLabelLineStyle","getLabelLineStatesModels","invisible","disableLabelAnimation","isElementRemoved","layoutStore","oldLayout","newProps","attr","labelInner","valueAnimation","oldOpacity","retrieve2","opacity","initProps","prevStates","indexOf","oldLayoutSelect","oldLayoutEmphasis","updateProps","states","select","layoutSelect","emphasis","layoutEmphasis","animateLabelValue","newLayout","strokePercent"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n\"use strict\";\n\nexports.__esModule = true;\n\nvar graphic_1 = require(\"../util/graphic\");\n\nvar innerStore_1 = require(\"../util/innerStore\");\n\nvar number_1 = require(\"../util/number\");\n\nvar Transformable_1 = require(\"zrender/lib/core/Transformable\");\n\nvar labelGuideHelper_1 = require(\"./labelGuideHelper\");\n\nvar model_1 = require(\"../util/model\");\n\nvar util_1 = require(\"zrender/lib/core/util\");\n\nvar labelLayoutHelper_1 = require(\"./labelLayoutHelper\");\n\nvar labelStyle_1 = require(\"./labelStyle\");\n\nfunction cloneArr(points) {\n  if (points) {\n    var newPoints = [];\n\n    for (var i = 0; i < points.length; i++) {\n      newPoints.push(points[i].slice());\n    }\n\n    return newPoints;\n  }\n}\n\nfunction prepareLayoutCallbackParams(labelItem, hostEl) {\n  var label = labelItem.label;\n  var labelLine = hostEl && hostEl.getTextGuideLine();\n  return {\n    dataIndex: labelItem.dataIndex,\n    dataType: labelItem.dataType,\n    seriesIndex: labelItem.seriesModel.seriesIndex,\n    text: labelItem.label.style.text,\n    rect: labelItem.hostRect,\n    labelRect: labelItem.rect,\n    align: label.style.align,\n    verticalAlign: label.style.verticalAlign,\n    labelLinePoints: cloneArr(labelLine && labelLine.shape.points)\n  };\n}\n\nvar LABEL_OPTION_TO_STYLE_KEYS = ['align', 'verticalAlign', 'width', 'height', 'fontSize'];\nvar dummyTransformable = new Transformable_1[\"default\"]();\nvar labelLayoutInnerStore = model_1.makeInner();\nvar labelLineAnimationStore = model_1.makeInner();\n\nfunction extendWithKeys(target, source, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n\n    if (source[key] != null) {\n      target[key] = source[key];\n    }\n  }\n}\n\nvar LABEL_LAYOUT_PROPS = ['x', 'y', 'rotation'];\n\nvar LabelManager = function () {\n  function LabelManager() {\n    this._labelList = [];\n    this._chartViewList = [];\n  }\n\n  LabelManager.prototype.clearLabels = function () {\n    this._labelList = [];\n    this._chartViewList = [];\n  };\n\n  LabelManager.prototype._addLabel = function (dataIndex, dataType, seriesModel, label, layoutOption) {\n    var labelStyle = label.style;\n    var hostEl = label.__hostTarget;\n    var textConfig = hostEl.textConfig || {};\n    var labelTransform = label.getComputedTransform();\n    var labelRect = label.getBoundingRect().plain();\n    graphic_1.BoundingRect.applyTransform(labelRect, labelRect, labelTransform);\n\n    if (labelTransform) {\n      dummyTransformable.setLocalTransform(labelTransform);\n    } else {\n      dummyTransformable.x = dummyTransformable.y = dummyTransformable.rotation = dummyTransformable.originX = dummyTransformable.originY = 0;\n      dummyTransformable.scaleX = dummyTransformable.scaleY = 1;\n    }\n\n    var host = label.__hostTarget;\n    var hostRect;\n\n    if (host) {\n      hostRect = host.getBoundingRect().plain();\n      var transform = host.getComputedTransform();\n      graphic_1.BoundingRect.applyTransform(hostRect, hostRect, transform);\n    }\n\n    var labelGuide = hostRect && host.getTextGuideLine();\n\n    this._labelList.push({\n      label: label,\n      labelLine: labelGuide,\n      seriesModel: seriesModel,\n      dataIndex: dataIndex,\n      dataType: dataType,\n      layoutOption: layoutOption,\n      computedLayoutOption: null,\n      rect: labelRect,\n      hostRect: hostRect,\n      priority: hostRect ? hostRect.width * hostRect.height : 0,\n      defaultAttr: {\n        ignore: label.ignore,\n        labelGuideIgnore: labelGuide && labelGuide.ignore,\n        x: dummyTransformable.x,\n        y: dummyTransformable.y,\n        rotation: dummyTransformable.rotation,\n        style: {\n          x: labelStyle.x,\n          y: labelStyle.y,\n          align: labelStyle.align,\n          verticalAlign: labelStyle.verticalAlign,\n          width: labelStyle.width,\n          height: labelStyle.height,\n          fontSize: labelStyle.fontSize\n        },\n        cursor: label.cursor,\n        attachedPos: textConfig.position,\n        attachedRot: textConfig.rotation\n      }\n    });\n  };\n\n  LabelManager.prototype.addLabelsOfSeries = function (chartView) {\n    var _this = this;\n\n    this._chartViewList.push(chartView);\n\n    var seriesModel = chartView.__model;\n    var layoutOption = seriesModel.get('labelLayout');\n\n    if (!(util_1.isFunction(layoutOption) || util_1.keys(layoutOption).length)) {\n      return;\n    }\n\n    chartView.group.traverse(function (child) {\n      if (child.ignore) {\n        return true;\n      }\n\n      var textEl = child.getTextContent();\n      var ecData = innerStore_1.getECData(child);\n\n      if (textEl && !textEl.disableLabelLayout) {\n        _this._addLabel(ecData.dataIndex, ecData.dataType, seriesModel, textEl, layoutOption);\n      }\n    });\n  };\n\n  LabelManager.prototype.updateLayoutConfig = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n\n    function createDragHandler(el, labelLineModel) {\n      return function () {\n        labelGuideHelper_1.updateLabelLinePoints(el, labelLineModel);\n      };\n    }\n\n    for (var i = 0; i < this._labelList.length; i++) {\n      var labelItem = this._labelList[i];\n      var label = labelItem.label;\n      var hostEl = label.__hostTarget;\n      var defaultLabelAttr = labelItem.defaultAttr;\n      var layoutOption = void 0;\n\n      if (typeof labelItem.layoutOption === 'function') {\n        layoutOption = labelItem.layoutOption(prepareLayoutCallbackParams(labelItem, hostEl));\n      } else {\n        layoutOption = labelItem.layoutOption;\n      }\n\n      layoutOption = layoutOption || {};\n      labelItem.computedLayoutOption = layoutOption;\n      var degreeToRadian = Math.PI / 180;\n\n      if (hostEl) {\n        hostEl.setTextConfig({\n          local: false,\n          position: layoutOption.x != null || layoutOption.y != null ? null : defaultLabelAttr.attachedPos,\n          rotation: layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.attachedRot,\n          offset: [layoutOption.dx || 0, layoutOption.dy || 0]\n        });\n      }\n\n      var needsUpdateLabelLine = false;\n\n      if (layoutOption.x != null) {\n        label.x = number_1.parsePercent(layoutOption.x, width);\n        label.setStyle('x', 0);\n        needsUpdateLabelLine = true;\n      } else {\n        label.x = defaultLabelAttr.x;\n        label.setStyle('x', defaultLabelAttr.style.x);\n      }\n\n      if (layoutOption.y != null) {\n        label.y = number_1.parsePercent(layoutOption.y, height);\n        label.setStyle('y', 0);\n        needsUpdateLabelLine = true;\n      } else {\n        label.y = defaultLabelAttr.y;\n        label.setStyle('y', defaultLabelAttr.style.y);\n      }\n\n      if (layoutOption.labelLinePoints) {\n        var guideLine = hostEl.getTextGuideLine();\n\n        if (guideLine) {\n          guideLine.setShape({\n            points: layoutOption.labelLinePoints\n          });\n          needsUpdateLabelLine = false;\n        }\n      }\n\n      var labelLayoutStore = labelLayoutInnerStore(label);\n      labelLayoutStore.needsUpdateLabelLine = needsUpdateLabelLine;\n      label.rotation = layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.rotation;\n\n      for (var k = 0; k < LABEL_OPTION_TO_STYLE_KEYS.length; k++) {\n        var key = LABEL_OPTION_TO_STYLE_KEYS[k];\n        label.setStyle(key, layoutOption[key] != null ? layoutOption[key] : defaultLabelAttr.style[key]);\n      }\n\n      if (layoutOption.draggable) {\n        label.draggable = true;\n        label.cursor = 'move';\n\n        if (hostEl) {\n          var hostModel = labelItem.seriesModel;\n\n          if (labelItem.dataIndex != null) {\n            var data = labelItem.seriesModel.getData(labelItem.dataType);\n            hostModel = data.getItemModel(labelItem.dataIndex);\n          }\n\n          label.on('drag', createDragHandler(hostEl, hostModel.getModel('labelLine')));\n        }\n      } else {\n        label.off('drag');\n        label.cursor = defaultLabelAttr.cursor;\n      }\n    }\n  };\n\n  LabelManager.prototype.layout = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var labelList = labelLayoutHelper_1.prepareLayoutList(this._labelList);\n    var labelsNeedsAdjustOnX = util_1.filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftX';\n    });\n    var labelsNeedsAdjustOnY = util_1.filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftY';\n    });\n    labelLayoutHelper_1.shiftLayoutOnX(labelsNeedsAdjustOnX, 0, width);\n    labelLayoutHelper_1.shiftLayoutOnY(labelsNeedsAdjustOnY, 0, height);\n    var labelsNeedsHideOverlap = util_1.filter(labelList, function (item) {\n      return item.layoutOption.hideOverlap;\n    });\n    labelLayoutHelper_1.hideOverlap(labelsNeedsHideOverlap);\n  };\n\n  LabelManager.prototype.processLabelsOverall = function () {\n    var _this = this;\n\n    util_1.each(this._chartViewList, function (chartView) {\n      var seriesModel = chartView.__model;\n      var ignoreLabelLineUpdate = chartView.ignoreLabelLineUpdate;\n      var animationEnabled = seriesModel.isAnimationEnabled();\n      chartView.group.traverse(function (child) {\n        if (child.ignore) {\n          return true;\n        }\n\n        var needsUpdateLabelLine = !ignoreLabelLineUpdate;\n        var label = child.getTextContent();\n\n        if (!needsUpdateLabelLine && label) {\n          needsUpdateLabelLine = labelLayoutInnerStore(label).needsUpdateLabelLine;\n        }\n\n        if (needsUpdateLabelLine) {\n          _this._updateLabelLine(child, seriesModel);\n        }\n\n        if (animationEnabled) {\n          _this._animateLabels(child, seriesModel);\n        }\n      });\n    });\n  };\n\n  LabelManager.prototype._updateLabelLine = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var ecData = innerStore_1.getECData(el);\n    var dataIndex = ecData.dataIndex;\n\n    if (textEl && dataIndex != null) {\n      var data = seriesModel.getData(ecData.dataType);\n      var itemModel = data.getItemModel(dataIndex);\n      var defaultStyle = {};\n      var visualStyle = data.getItemVisual(dataIndex, 'style');\n      var visualType = data.getVisual('drawType');\n      defaultStyle.stroke = visualStyle[visualType];\n      var labelLineModel = itemModel.getModel('labelLine');\n      labelGuideHelper_1.setLabelLineStyle(el, labelGuideHelper_1.getLabelLineStatesModels(itemModel), defaultStyle);\n      labelGuideHelper_1.updateLabelLinePoints(el, labelLineModel);\n    }\n  };\n\n  LabelManager.prototype._animateLabels = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var guideLine = el.getTextGuideLine();\n\n    if (textEl && !textEl.ignore && !textEl.invisible && !el.disableLabelAnimation && !graphic_1.isElementRemoved(el)) {\n      var layoutStore = labelLayoutInnerStore(textEl);\n      var oldLayout = layoutStore.oldLayout;\n      var ecData = innerStore_1.getECData(el);\n      var dataIndex = ecData.dataIndex;\n      var newProps = {\n        x: textEl.x,\n        y: textEl.y,\n        rotation: textEl.rotation\n      };\n      var data = seriesModel.getData(ecData.dataType);\n\n      if (!oldLayout) {\n        textEl.attr(newProps);\n\n        if (!labelStyle_1.labelInner(textEl).valueAnimation) {\n          var oldOpacity = util_1.retrieve2(textEl.style.opacity, 1);\n          textEl.style.opacity = 0;\n          graphic_1.initProps(textEl, {\n            style: {\n              opacity: oldOpacity\n            }\n          }, seriesModel, dataIndex);\n        }\n      } else {\n        textEl.attr(oldLayout);\n        var prevStates = el.prevStates;\n\n        if (prevStates) {\n          if (util_1.indexOf(prevStates, 'select') >= 0) {\n            textEl.attr(layoutStore.oldLayoutSelect);\n          }\n\n          if (util_1.indexOf(prevStates, 'emphasis') >= 0) {\n            textEl.attr(layoutStore.oldLayoutEmphasis);\n          }\n        }\n\n        graphic_1.updateProps(textEl, newProps, seriesModel, dataIndex);\n      }\n\n      layoutStore.oldLayout = newProps;\n\n      if (textEl.states.select) {\n        var layoutSelect = layoutStore.oldLayoutSelect = {};\n        extendWithKeys(layoutSelect, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutSelect, textEl.states.select, LABEL_LAYOUT_PROPS);\n      }\n\n      if (textEl.states.emphasis) {\n        var layoutEmphasis = layoutStore.oldLayoutEmphasis = {};\n        extendWithKeys(layoutEmphasis, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutEmphasis, textEl.states.emphasis, LABEL_LAYOUT_PROPS);\n      }\n\n      labelStyle_1.animateLabelValue(textEl, dataIndex, data, seriesModel);\n    }\n\n    if (guideLine && !guideLine.ignore && !guideLine.invisible) {\n      var layoutStore = labelLineAnimationStore(guideLine);\n      var oldLayout = layoutStore.oldLayout;\n      var newLayout = {\n        points: guideLine.shape.points\n      };\n\n      if (!oldLayout) {\n        guideLine.setShape(newLayout);\n        guideLine.style.strokePercent = 0;\n        graphic_1.initProps(guideLine, {\n          style: {\n            strokePercent: 1\n          }\n        }, seriesModel);\n      } else {\n        guideLine.attr({\n          shape: oldLayout\n        });\n        graphic_1.updateProps(guideLine, {\n          shape: newLayout\n        }, seriesModel);\n      }\n\n      layoutStore.oldLayout = newLayout;\n    }\n  };\n\n  return LabelManager;\n}();\n\nexports[\"default\"] = LabelManager;"]},"metadata":{},"sourceType":"script"}