{"ast":null,"code":"import { mat3 } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.7,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onTouchEnd'\n    };\n  },\n  onTouchStart: function onTouchStart(evt) {\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n    evt.preventDefault(); // 如果不是缩放事件则禁止继续执行\n\n    if (!event2) {\n      return;\n    } // 第一个触摸点位置\n\n\n    this.startPoint = {\n      pageX: event1.pageX,\n      pageY: event1.pageY\n    };\n    this.moveable = true;\n\n    if (event2) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    }\n\n    this.originScale = this.currentScale || 1;\n  },\n  onTouchMove: function onTouchMove(evt) {\n    if (!this.moveable) {\n      return;\n    }\n\n    evt.preventDefault();\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n\n    if (!event2) {\n      return;\n    }\n\n    if (!this.endPoint) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    } // 获取坐标之间的距离\n\n\n    var getDistance = function getDistance(start, end) {\n      return Math.hypot(end.x - start.x, end.y - start.y);\n    }; // 双指缩放比例\n\n\n    var scale = getDistance({\n      x: event1.pageX,\n      y: event1.pageY\n    }, {\n      x: event2.pageX,\n      y: event2.pageY\n    }) / getDistance({\n      x: this.startPoint.pageX,\n      y: this.startPoint.pageY\n    }, {\n      x: this.endPoint.pageX,\n      y: this.endPoint.pageY\n    }); // 应用到画布上的缩放比例\n\n    var zoom = this.originScale * scale; // 缓存当前的缩放比例\n\n    this.currentScale = zoom;\n    var minZoom = this.get('minZoom') || this.graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || this.graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    }\n\n    var canvas = this.graph.get('canvas');\n    var point = canvas.getPointByClient(evt.clientX, evt.clientY);\n    this.graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    this.graph.emit('wheelzoom', evt);\n  },\n  onTouchEnd: function onTouchEnd() {\n    this.moveable = false;\n    this.endPoint = null;\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              node.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              edge.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 500);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              mat3.translate(groupMatrix, groupMatrix, [-x, -y]);\n              mat3.scale(groupMatrix, groupMatrix, [scale, scale]);\n              mat3.translate(groupMatrix, groupMatrix, [x, y]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/behavior/zoom-canvas.js"],"names":["mat3","clone","DELTA","getDefaultCfg","sensitivity","minZoom","undefined","maxZoom","enableOptimize","optimizeZoom","fixSelectedItems","fixAll","fixLineWidth","fixLabel","fixState","getEvents","wheel","touchstart","touchmove","touchend","onTouchStart","evt","touches","originalEvent","event1","event2","preventDefault","startPoint","pageX","pageY","moveable","endPoint","originScale","currentScale","onTouchMove","getDistance","start","end","Math","hypot","x","y","scale","zoom","get","graph","canvas","point","getPointByClient","clientX","clientY","zoomTo","emit","onTouchEnd","onWheel","e","_this","_a","shouldUpdate","call","graphZoom","getZoom","ratio","wheelDelta","optimizeZoom_1","optimized","nodes_1","getNodes","edges_1","getEdges","nodesLength_1","length","edgesLength_1","n","node","destroyed","children","childrenLength","c","shape","destoryed","hide","edgeIndex","edge","set","clearTimeout","timeout","setTimeout","currentZoom","curOptimized","getKeyShape","show","fixNodes","fixEdges","findAllByState","fixNodesLength","fn","group","getContainer","nodeModel","getModel","originStyle","getOriginStyle","itemStateStyle","getStateStyle","shapeStateStyle","getShape","type","groupMatrix","getMatrix","_b","translate","setMatrix","fontSize","lineWidth","shapeType","attr","itemStyle","shapeStyle","itemFontSize","shapeFontSize","oriFontSize","oriLineWidth","fixEdgesLength","fe"],"mappings":"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","sourcesContent":["import { mat3 } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.7,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onTouchEnd'\n    };\n  },\n  onTouchStart: function onTouchStart(evt) {\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n    evt.preventDefault(); // 如果不是缩放事件则禁止继续执行\n\n    if (!event2) {\n      return;\n    } // 第一个触摸点位置\n\n\n    this.startPoint = {\n      pageX: event1.pageX,\n      pageY: event1.pageY\n    };\n    this.moveable = true;\n\n    if (event2) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    }\n\n    this.originScale = this.currentScale || 1;\n  },\n  onTouchMove: function onTouchMove(evt) {\n    if (!this.moveable) {\n      return;\n    }\n\n    evt.preventDefault();\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n\n    if (!event2) {\n      return;\n    }\n\n    if (!this.endPoint) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    } // 获取坐标之间的距离\n\n\n    var getDistance = function getDistance(start, end) {\n      return Math.hypot(end.x - start.x, end.y - start.y);\n    }; // 双指缩放比例\n\n\n    var scale = getDistance({\n      x: event1.pageX,\n      y: event1.pageY\n    }, {\n      x: event2.pageX,\n      y: event2.pageY\n    }) / getDistance({\n      x: this.startPoint.pageX,\n      y: this.startPoint.pageY\n    }, {\n      x: this.endPoint.pageX,\n      y: this.endPoint.pageY\n    }); // 应用到画布上的缩放比例\n\n    var zoom = this.originScale * scale; // 缓存当前的缩放比例\n\n    this.currentScale = zoom;\n    var minZoom = this.get('minZoom') || this.graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || this.graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    }\n\n    var canvas = this.graph.get('canvas');\n    var point = canvas.getPointByClient(evt.clientX, evt.clientY);\n    this.graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    this.graph.emit('wheelzoom', evt);\n  },\n  onTouchEnd: function onTouchEnd() {\n    this.moveable = false;\n    this.endPoint = null;\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              node.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              edge.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 500);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              mat3.translate(groupMatrix, groupMatrix, [-x, -y]);\n              mat3.scale(groupMatrix, groupMatrix, [scale, scale]);\n              mat3.translate(groupMatrix, groupMatrix, [x, y]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};"]},"metadata":{},"sourceType":"module"}