{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCustomLegendItems = exports.getLegendItems = exports.getLegendLayout = void 0;\n\nvar util_1 = require(\"@antv/util\");\n\nvar constant_1 = require(\"../constant\");\n\nvar attr_1 = require(\"./attr\");\n\nvar marker_1 = require(\"./marker\");\n\nfunction setMarkerSymbol(marker) {\n  var symbol = marker.symbol;\n\n  if (util_1.isString(symbol) && marker_1.MarkerSymbols[symbol]) {\n    marker.symbol = marker_1.MarkerSymbols[symbol];\n  }\n}\n/**\n * @ignore\n * get the legend layout from direction\n * @param direction\n * @returns layout 'horizontal' | 'vertical'\n */\n\n\nfunction getLegendLayout(direction) {\n  return direction.startsWith(constant_1.DIRECTION.LEFT) || direction.startsWith(constant_1.DIRECTION.RIGHT) ? 'vertical' : 'horizontal';\n}\n\nexports.getLegendLayout = getLegendLayout;\n/**\n * @ignore\n * get the legend items\n * @param view\n * @param geometry\n * @param attr\n * @param themeMarker\n * @param userMarker\n * @returns legend items\n */\n\nfunction getLegendItems(view, geometry, attr, themeMarker, userMarker) {\n  var scale = attr.getScale(attr.type);\n\n  if (scale.isCategory) {\n    var field_1 = scale.field;\n    var colorAttr_1 = geometry.getAttribute('color');\n    var shapeAttr_1 = geometry.getAttribute('shape');\n    var defaultColor_1 = view.getTheme().defaultColor;\n    var isInPolar_1 = geometry.coordinate.isPolar;\n    return scale.getTicks().map(function (tick) {\n      var _a;\n\n      var text = tick.text,\n          scaleValue = tick.value;\n      var name = text;\n      var value = scale.invert(scaleValue); // 通过过滤图例项的数据，来看是否 unchecked\n\n      var unchecked = view.filterFieldData(field_1, [(_a = {}, _a[field_1] = value, _a)]).length === 0;\n      util_1.each(view.views, function (subView) {\n        var _a;\n\n        if (!subView.filterFieldData(field_1, [(_a = {}, _a[field_1] = value, _a)]).length) {\n          unchecked = true;\n        }\n      }); // @ts-ignore\n\n      var color = attr_1.getMappingValue(colorAttr_1, value, defaultColor_1);\n      var shape = attr_1.getMappingValue(shapeAttr_1, value, 'point');\n      var marker = geometry.getShapeMarker(shape, {\n        color: color,\n        isInPolar: isInPolar_1\n      }); // the marker configure order should be ensure\n\n      marker = util_1.deepMix({}, themeMarker, marker, userMarker);\n      setMarkerSymbol(marker);\n      return {\n        id: value,\n        name: name,\n        value: value,\n        marker: marker,\n        unchecked: unchecked\n      };\n    });\n  }\n\n  return [];\n}\n\nexports.getLegendItems = getLegendItems;\n/**\n * @ignore\n * custom legend 的 items 获取\n * @param themeMarker\n * @param userMarker\n * @param customItems\n */\n\nfunction getCustomLegendItems(themeMarker, userMarker, customItems) {\n  // 如果有自定义的 item，那么就直接使用，并合并主题的 marker 配置\n  return customItems.map(function (item) {\n    var marker = util_1.deepMix({}, themeMarker, userMarker, item.marker);\n    setMarkerSymbol(marker);\n    item.marker = marker;\n    return item;\n  });\n}\n\nexports.getCustomLegendItems = getCustomLegendItems;","map":{"version":3,"sources":["../../src/util/legend.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix, isString, each } from '@antv/util';\nimport View from '../chart/view';\nimport { DIRECTION } from '../constant';\nimport { Attribute, Tick } from '../dependents';\nimport Geometry from '../geometry/base';\nimport { LegendItem } from '../interface';\nimport { getMappingValue } from './attr';\nimport { MarkerSymbols } from './marker';\n\nfunction setMarkerSymbol(marker) {\n  const symbol = marker.symbol;\n  if (isString(symbol) && MarkerSymbols[symbol]) {\n    marker.symbol = MarkerSymbols[symbol];\n  }\n}\n\n/**\n * @ignore\n * get the legend layout from direction\n * @param direction\n * @returns layout 'horizontal' | 'vertical'\n */\nexport function getLegendLayout(direction: DIRECTION): 'vertical' | 'horizontal' {\n  return direction.startsWith(DIRECTION.LEFT) || direction.startsWith(DIRECTION.RIGHT) ? 'vertical' : 'horizontal';\n}\n\n/**\n * @ignore\n * get the legend items\n * @param view\n * @param geometry\n * @param attr\n * @param themeMarker\n * @param userMarker\n * @returns legend items\n */\nexport function getLegendItems(\n  view: View,\n  geometry: Geometry,\n  attr: Attribute,\n  themeMarker: object,\n  userMarker\n): any[] {\n  const scale = attr.getScale(attr.type);\n  if (scale.isCategory) {\n    const field = scale.field;\n    const colorAttr = geometry.getAttribute('color');\n    const shapeAttr = geometry.getAttribute('shape');\n    const defaultColor = view.getTheme().defaultColor;\n    const isInPolar = geometry.coordinate.isPolar;\n\n    return scale.getTicks().map((tick: Tick) => {\n      const { text, value: scaleValue } = tick;\n      const name = text;\n      const value = scale.invert(scaleValue);\n\n      // 通过过滤图例项的数据，来看是否 unchecked\n      let unchecked = view.filterFieldData(field, [{ [field]: value }]).length === 0;\n      each(view.views, (subView) => {\n        if (!subView.filterFieldData(field, [{ [field]: value }]).length) {\n          unchecked = true;\n        }\n      });\n\n      // @ts-ignore\n      const color = getMappingValue(colorAttr, value, defaultColor);\n      const shape = getMappingValue(shapeAttr, value, 'point');\n      let marker = geometry.getShapeMarker(shape, {\n        color,\n        isInPolar,\n      });\n      // the marker configure order should be ensure\n      marker = deepMix({}, themeMarker, marker, userMarker);\n\n      setMarkerSymbol(marker);\n\n      return { id: value, name, value, marker, unchecked };\n    });\n  }\n  return [];\n}\n\n/**\n * @ignore\n * custom legend 的 items 获取\n * @param themeMarker\n * @param userMarker\n * @param customItems\n */\nexport function getCustomLegendItems(themeMarker: object, userMarker: object, customItems: LegendItem[]) {\n  // 如果有自定义的 item，那么就直接使用，并合并主题的 marker 配置\n  return customItems.map((item: LegendItem) => {\n    const marker = deepMix({}, themeMarker, userMarker, item.marker);\n    setMarkerSymbol(marker);\n\n    item.marker = marker;\n    return item;\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}