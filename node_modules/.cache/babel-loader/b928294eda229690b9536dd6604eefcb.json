{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport { utils } from '../util';\nimport createNode from '../util/createNode';\nexport default function useInit(ChartClass, config) {\n  var chart = useRef();\n  var chartOptions = useRef();\n  var container = useRef(null);\n  /**\n   * Get data base64\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n  var toDataURL = function (type, encoderOptions) {\n    var _a;\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n  };\n  /**\n   * Download Iamge\n   * @param {string} name A name of image\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n\n  var downloadImage = function (name, type, encoderOptions) {\n    var _a, _b;\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    try {\n      // default png\n      if (name && name.indexOf('.') === -1) {\n        name = name + \".png\";\n      }\n\n      var imageName = name;\n\n      if (!imageName) {\n        var _config = config; // 默认值：图表 title -> 图表类型\n\n        imageName = (((_a = _config === null || _config === void 0 ? void 0 : _config.title) === null || _a === void 0 ? void 0 : _a.text) || (ChartClass === null || ChartClass === void 0 ? void 0 : ChartClass.name)) + \".png\";\n      }\n\n      var base64 = (_b = chart.current) === null || _b === void 0 ? void 0 : _b.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n      var a = document.createElement('a');\n      a.href = base64;\n      a.download = imageName;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      a = null;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  var reactDomToString = function (source, path) {\n    var hasPath = utils.hasPath,\n        setPath = utils.setPath;\n    var statisticCustomHtml = hasPath(source, path);\n    setPath(source, path, function () {\n      var arg = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        arg[_i] = arguments[_i];\n      }\n\n      var statisticDom = statisticCustomHtml.apply(void 0, arg);\n\n      if (utils.isType(statisticDom, 'String') || utils.isType(statisticDom, 'Number') || utils.isType(statisticDom, 'HTMLDivElement')) {\n        return statisticDom;\n      }\n\n      return createNode(statisticDom);\n    });\n  };\n\n  var processConfig = function () {\n    var _a;\n\n    var hasPath = utils.hasPath; // statistic\n\n    if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'content', 'customHtml']);\n    }\n\n    if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'title', 'customHtml']);\n    } // tooltip\n\n\n    if (typeof config.tooltip === 'object') {\n      if ((_a = config.tooltip) === null || _a === void 0 ? void 0 : _a.container) {\n        config.tooltip.container = createNode(config.tooltip.container);\n      }\n\n      if (hasPath(config, ['tooltip', 'customContent'])) {\n        reactDomToString(config, ['tooltip', 'customContent']);\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (chart.current && !isEqual(chartOptions.current, config)) {\n      var changeData = false;\n\n      if (chartOptions.current) {\n        // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n        var _a = chartOptions.current,\n            currentData = _a.data,\n            currentValue = _a.value,\n            currentPercent = _a.percent,\n            currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n\n        var inputData = config.data,\n            inputValue = config.value,\n            inputPercent = config.percent,\n            inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n\n        changeData = isEqual(currentConfig, inputConfig);\n      }\n\n      if (changeData) {\n        var changeType_1 = 'data';\n        var typeMaps = ['percent', 'value'];\n        var currentKeys_1 = Object.keys(config);\n        typeMaps.forEach(function (type) {\n          if (currentKeys_1.includes(type)) {\n            changeType_1 = type;\n          }\n        });\n        chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n      } else {\n        processConfig();\n        chart.current.update(config);\n      }\n\n      chartOptions.current = config;\n    }\n  }, [config]);\n  useEffect(function () {\n    if (!container.current) {\n      return function () {\n        return null;\n      };\n    }\n\n    processConfig();\n    var chartInstance = new ChartClass(container.current, __assign({}, config));\n\n    chartInstance.__proto__.toDataURL = function (type, encoderOptions) {\n      return toDataURL(type, encoderOptions);\n    };\n\n    chartInstance.__proto__.downloadImage = function (name, type, encoderOptions) {\n      return downloadImage(name, type, encoderOptions);\n    };\n\n    chartInstance.render();\n\n    if (!chartOptions.current) {\n      chartOptions.current = config;\n    }\n\n    chart.current = utils.clone(chartInstance);\n    return function () {\n      chartInstance.destroy();\n    };\n  }, []);\n  return {\n    chart: chart,\n    container: container\n  };\n}","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@ant-design/charts/es/hooks/useChart.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useRef","useEffect","isEqual","utils","createNode","useInit","ChartClass","config","chart","chartOptions","container","toDataURL","type","encoderOptions","_a","current","canvas","cfg","el","downloadImage","name","_b","imageName","_config","title","text","base64","a","document","createElement","href","download","body","appendChild","click","removeChild","err","console","log","reactDomToString","source","path","hasPath","setPath","statisticCustomHtml","arg","_i","statisticDom","isType","processConfig","tooltip","changeData","currentData","data","currentValue","value","currentPercent","percent","currentConfig","inputData","inputValue","inputPercent","inputConfig","changeType_1","typeMaps","currentKeys_1","keys","forEach","includes","update","chartInstance","__proto__","render","clone","destroy"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport { utils } from '../util';\nimport createNode from '../util/createNode';\nexport default function useInit(ChartClass, config) {\n    var chart = useRef();\n    var chartOptions = useRef();\n    var container = useRef(null);\n    /**\n     * Get data base64\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var toDataURL = function (type, encoderOptions) {\n        var _a;\n        if (type === void 0) { type = 'image/png'; }\n        return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n    };\n    /**\n     * Download Iamge\n     * @param {string} name A name of image\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var downloadImage = function (name, type, encoderOptions) {\n        var _a, _b;\n        if (type === void 0) { type = 'image/png'; }\n        try {\n            // default png\n            if (name && name.indexOf('.') === -1) {\n                name = name + \".png\";\n            }\n            var imageName = name;\n            if (!imageName) {\n                var _config = config;\n                // 默认值：图表 title -> 图表类型\n                imageName = (((_a = _config === null || _config === void 0 ? void 0 : _config.title) === null || _a === void 0 ? void 0 : _a.text) || (ChartClass === null || ChartClass === void 0 ? void 0 : ChartClass.name)) + \".png\";\n            }\n            var base64 = (_b = chart.current) === null || _b === void 0 ? void 0 : _b.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n            var a = document.createElement('a');\n            a.href = base64;\n            a.download = imageName;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            a = null;\n        }\n        catch (err) {\n            console.log(err);\n        }\n    };\n    var reactDomToString = function (source, path) {\n        var hasPath = utils.hasPath, setPath = utils.setPath;\n        var statisticCustomHtml = hasPath(source, path);\n        setPath(source, path, function () {\n            var arg = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                arg[_i] = arguments[_i];\n            }\n            var statisticDom = statisticCustomHtml.apply(void 0, arg);\n            if (utils.isType(statisticDom, 'String') ||\n                utils.isType(statisticDom, 'Number') ||\n                utils.isType(statisticDom, 'HTMLDivElement')) {\n                return statisticDom;\n            }\n            return createNode(statisticDom);\n        });\n    };\n    var processConfig = function () {\n        var _a;\n        var hasPath = utils.hasPath;\n        // statistic\n        if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'content', 'customHtml']);\n        }\n        if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'title', 'customHtml']);\n        }\n        // tooltip\n        if (typeof config.tooltip === 'object') {\n            if ((_a = config.tooltip) === null || _a === void 0 ? void 0 : _a.container) {\n                config.tooltip.container = createNode(config.tooltip.container);\n            }\n            if (hasPath(config, ['tooltip', 'customContent'])) {\n                reactDomToString(config, ['tooltip', 'customContent']);\n            }\n        }\n    };\n    useEffect(function () {\n        if (chart.current && !isEqual(chartOptions.current, config)) {\n            var changeData = false;\n            if (chartOptions.current) {\n                // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n                var _a = chartOptions.current, currentData = _a.data, currentValue = _a.value, currentPercent = _a.percent, currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n                var inputData = config.data, inputValue = config.value, inputPercent = config.percent, inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n                changeData = isEqual(currentConfig, inputConfig);\n            }\n            if (changeData) {\n                var changeType_1 = 'data';\n                var typeMaps = ['percent', 'value'];\n                var currentKeys_1 = Object.keys(config);\n                typeMaps.forEach(function (type) {\n                    if (currentKeys_1.includes(type)) {\n                        changeType_1 = type;\n                    }\n                });\n                chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n            }\n            else {\n                processConfig();\n                chart.current.update(config);\n            }\n            chartOptions.current = config;\n        }\n    }, [config]);\n    useEffect(function () {\n        if (!container.current) {\n            return function () { return null; };\n        }\n        processConfig();\n        var chartInstance = new ChartClass(container.current, __assign({}, config));\n        chartInstance.__proto__.toDataURL = function (type, encoderOptions) {\n            return toDataURL(type, encoderOptions);\n        };\n        chartInstance.__proto__.downloadImage = function (name, type, encoderOptions) {\n            return downloadImage(name, type, encoderOptions);\n        };\n        chartInstance.render();\n        if (!chartOptions.current) {\n            chartOptions.current = config;\n        }\n        chart.current = utils.clone(chartInstance);\n        return function () {\n            chartInstance.destroy();\n        };\n    }, []);\n    return {\n        chart: chart,\n        container: container,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}