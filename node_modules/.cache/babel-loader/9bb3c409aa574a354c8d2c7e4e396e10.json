{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isUndefined, isNumber, get, reduce, isObject } from '@antv/util';\nimport { LEVEL, log } from '../../utils';\nimport { ABSOLUTE_FIELD, DIFF_FIELD, IS_TOTAL, Y_FIELD } from './constants';\n/**\n * @desc 数据处理函数，统一将数据处理成[start, end]\n * @param data\n * @param xField\n * @param yField\n * @param totalLabel\n */\n\nexport function processData(data, xField, yField, newYField, total) {\n  var _a;\n\n  var newData = [];\n  reduce(data, function (r, d) {\n    var _a; // 校验数据合法性\n\n\n    log(LEVEL.WARN, isNumber(d[yField]), d[yField] + \" is not a valid number\");\n    var value = isUndefined(d[yField]) ? null : d[yField];\n    newData.push(__assign(__assign({}, d), (_a = {}, _a[newYField] = [r, r + value], _a)));\n    return r + value;\n  }, 0); // 如果需要展示总和\n\n  if (newData.length && total) {\n    var sum = get(newData, [[data.length - 1], newYField, [1]]);\n    newData.push((_a = {}, _a[xField] = total.label, _a[yField] = sum, _a[newYField] = [0, sum], _a));\n  }\n\n  return newData;\n}\n/**\n * 处理为 瀑布图 数据\n */\n\nexport function transformData(data, xField, yField, total) {\n  var processed = processData(data, xField, yField, Y_FIELD, total);\n  return processed.map(function (d, dIdx) {\n    var _a;\n\n    if (!isObject(d)) {\n      return d;\n    }\n\n    return __assign(__assign({}, d), (_a = {}, _a[ABSOLUTE_FIELD] = d[Y_FIELD][1], _a[DIFF_FIELD] = d[Y_FIELD][1] - d[Y_FIELD][0], _a[IS_TOTAL] = dIdx === data.length, _a));\n  });\n}","map":{"version":3,"sources":["../../../src/plots/waterfall/utils.ts"],"names":[],"mappings":";AAAA,SAAS,WAAT,EAAsB,QAAtB,EAAgC,GAAhC,EAAqC,MAArC,EAA6C,QAA7C,QAA6D,YAA7D;AAEA,SAAS,KAAT,EAAgB,GAAhB,QAA2B,aAA3B;AACA,SAAS,cAAT,EAAyB,UAAzB,EAAqC,QAArC,EAA+C,OAA/C,QAA8D,aAA9D;AAEA;;;;;;AAMG;;AACH,OAAM,SAAU,WAAV,CACJ,IADI,EAEJ,MAFI,EAGJ,MAHI,EAIJ,SAJI,EAKJ,KALI,EAK8B;;;AAElC,MAAM,OAAO,GAAG,EAAhB;AACA,EAAA,MAAM,CACJ,IADI,EAEJ,UAAC,CAAD,EAAI,CAAJ,EAAK;WAAA,CACH;;;AACA,IAAA,GAAG,CAAC,KAAK,CAAC,IAAP,EAAa,QAAQ,CAAC,CAAC,CAAC,MAAD,CAAF,CAArB,EAAqC,CAAC,CAAC,MAAD,CAAD,GAAS,wBAA9C,CAAH;AACA,QAAM,KAAK,GAAG,WAAW,CAAC,CAAC,CAAC,MAAD,CAAF,CAAX,GAAyB,IAAzB,GAAgC,CAAC,CAAC,MAAD,CAA/C;AACA,IAAA,OAAO,CAAC,IAAR,CAAY,QAAA,CAAA,QAAA,CAAA,EAAA,EAAM,CAAN,CAAA,GAAO,EAAA,GAAA,EAAA,EAAA,EAAA,CAAG,SAAH,CAAA,GAAe,CAAC,CAAD,EAAI,CAAC,GAAG,KAAR,CAAf,EAA6B,EAApC,EAAZ;AAEA,WAAO,CAAC,GAAG,KAAX;AACD,GATG,EAUJ,CAVI,CAAN,CAHkC,CAelC;;AACA,MAAI,OAAO,CAAC,MAAR,IAAkB,KAAtB,EAA6B;AAC3B,QAAM,GAAG,GAAG,GAAG,CAAC,OAAD,EAAU,CAAC,CAAC,IAAI,CAAC,MAAL,GAAc,CAAf,CAAD,EAAoB,SAApB,EAA+B,CAAC,CAAD,CAA/B,CAAV,CAAf;AACA,IAAA,OAAO,CAAC,IAAR,EAAY,EAAA,GAAA,EAAA,EACV,EAAA,CAAC,MAAD,CAAA,GAAU,KAAK,CAAC,KADN,EAEV,EAAA,CAAC,MAAD,CAAA,GAAU,GAFA,EAGV,EAAA,CAAC,SAAD,CAAA,GAAa,CAAC,CAAD,EAAI,GAAJ,CAHH,EAIV,EAJF;AAKD;;AACD,SAAO,OAAP;AACD;AAED;;AAEG;;AACH,OAAM,SAAU,aAAV,CACJ,IADI,EAEJ,MAFI,EAGJ,MAHI,EAIJ,KAJI,EAI8B;AAElC,MAAM,SAAS,GAAG,WAAW,CAAC,IAAD,EAAO,MAAP,EAAe,MAAf,EAAuB,OAAvB,EAAgC,KAAhC,CAA7B;AACA,SAAO,SAAS,CAAC,GAAV,CAAc,UAAC,CAAD,EAAI,IAAJ,EAAQ;;;AAC3B,QAAI,CAAC,QAAQ,CAAC,CAAD,CAAb,EAAkB;AAChB,aAAO,CAAP;AACD;;AACD,WAAA,QAAA,CAAA,QAAA,CAAA,EAAA,EACK,CADL,CAAA,GACM,EAAA,GAAA,EAAA,EAAA,EAAA,CACH,cADG,CAAA,GACc,CAAC,CAAC,OAAD,CAAD,CAAW,CAAX,CADd,EAC2B,EAAA,CAC9B,UAD8B,CAAA,GACjB,CAAC,CAAC,OAAD,CAAD,CAAW,CAAX,IAAgB,CAAC,CAAC,OAAD,CAAD,CAAW,CAAX,CAF1B,EAEuC,EAAA,CAC1C,QAD0C,CAAA,GAC/B,IAAI,KAAK,IAAI,CAAC,MAHtB,EAG4B,EAJlC,EAAA;AAMD,GAVM,CAAP;AAWD","sourcesContent":["import { isUndefined, isNumber, get, reduce, isObject } from '@antv/util';\nimport { Options } from '../../types';\nimport { LEVEL, log } from '../../utils';\nimport { ABSOLUTE_FIELD, DIFF_FIELD, IS_TOTAL, Y_FIELD } from './constants';\n\n/**\n * @desc 数据处理函数，统一将数据处理成[start, end]\n * @param data\n * @param xField\n * @param yField\n * @param totalLabel\n */\nexport function processData(\n  data: Options['data'],\n  xField: string,\n  yField: string,\n  newYField: string,\n  total?: false | { label?: string }\n) {\n  const newData = [];\n  reduce(\n    data,\n    (r, d) => {\n      // 校验数据合法性\n      log(LEVEL.WARN, isNumber(d[yField]), `${d[yField]} is not a valid number`);\n      const value = isUndefined(d[yField]) ? null : d[yField];\n      newData.push({ ...d, [newYField]: [r, r + value] });\n\n      return r + value;\n    },\n    0\n  );\n  // 如果需要展示总和\n  if (newData.length && total) {\n    const sum = get(newData, [[data.length - 1], newYField, [1]]);\n    newData.push({\n      [xField]: total.label,\n      [yField]: sum,\n      [newYField]: [0, sum],\n    });\n  }\n  return newData;\n}\n\n/**\n * 处理为 瀑布图 数据\n */\nexport function transformData(\n  data: Options['data'],\n  xField: string,\n  yField: string,\n  total?: false | { label?: string }\n) {\n  const processed = processData(data, xField, yField, Y_FIELD, total);\n  return processed.map((d, dIdx) => {\n    if (!isObject(d)) {\n      return d;\n    }\n    return {\n      ...d,\n      [ABSOLUTE_FIELD]: d[Y_FIELD][1],\n      [DIFF_FIELD]: d[Y_FIELD][1] - d[Y_FIELD][0],\n      [IS_TOTAL]: dIdx === data.length,\n    };\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}