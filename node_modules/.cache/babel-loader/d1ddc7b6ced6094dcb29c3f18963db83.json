{"ast":null,"code":"import Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\nimport { hypotenuse } from './util';\nexport default class EigenvalueDecomposition {\n  constructor(matrix, options = {}) {\n    const {\n      assumeSymmetric = false\n    } = options;\n    matrix = WrapperMatrix2D.checkMatrix(matrix);\n\n    if (!matrix.isSquare()) {\n      throw new Error('Matrix is not a square matrix');\n    }\n\n    let n = matrix.columns;\n    let V = new Matrix(n, n);\n    let d = new Float64Array(n);\n    let e = new Float64Array(n);\n    let value = matrix;\n    let i, j;\n    let isSymmetric = false;\n\n    if (assumeSymmetric) {\n      isSymmetric = true;\n    } else {\n      isSymmetric = matrix.isSymmetric();\n    }\n\n    if (isSymmetric) {\n      for (i = 0; i < n; i++) {\n        for (j = 0; j < n; j++) {\n          V.set(i, j, value.get(i, j));\n        }\n      }\n\n      tred2(n, e, d, V);\n      tql2(n, e, d, V);\n    } else {\n      let H = new Matrix(n, n);\n      let ort = new Float64Array(n);\n\n      for (j = 0; j < n; j++) {\n        for (i = 0; i < n; i++) {\n          H.set(i, j, value.get(i, j));\n        }\n      }\n\n      orthes(n, H, ort, V);\n      hqr2(n, e, d, V, H);\n    }\n\n    this.n = n;\n    this.e = e;\n    this.d = d;\n    this.V = V;\n  }\n\n  get realEigenvalues() {\n    return Array.from(this.d);\n  }\n\n  get imaginaryEigenvalues() {\n    return Array.from(this.e);\n  }\n\n  get eigenvectorMatrix() {\n    return this.V;\n  }\n\n  get diagonalMatrix() {\n    let n = this.n;\n    let e = this.e;\n    let d = this.d;\n    let X = new Matrix(n, n);\n    let i, j;\n\n    for (i = 0; i < n; i++) {\n      for (j = 0; j < n; j++) {\n        X.set(i, j, 0);\n      }\n\n      X.set(i, i, d[i]);\n\n      if (e[i] > 0) {\n        X.set(i, i + 1, e[i]);\n      } else if (e[i] < 0) {\n        X.set(i, i - 1, e[i]);\n      }\n    }\n\n    return X;\n  }\n\n}\n\nfunction tred2(n, e, d, V) {\n  let f, g, h, i, j, k, hh, scale;\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n  }\n\n  for (i = n - 1; i > 0; i--) {\n    scale = 0;\n    h = 0;\n\n    for (k = 0; k < i; k++) {\n      scale = scale + Math.abs(d[k]);\n    }\n\n    if (scale === 0) {\n      e[i] = d[i - 1];\n\n      for (j = 0; j < i; j++) {\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n        V.set(j, i, 0);\n      }\n    } else {\n      for (k = 0; k < i; k++) {\n        d[k] /= scale;\n        h += d[k] * d[k];\n      }\n\n      f = d[i - 1];\n      g = Math.sqrt(h);\n\n      if (f > 0) {\n        g = -g;\n      }\n\n      e[i] = scale * g;\n      h = h - f * g;\n      d[i - 1] = f - g;\n\n      for (j = 0; j < i; j++) {\n        e[j] = 0;\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        V.set(j, i, f);\n        g = e[j] + V.get(j, j) * f;\n\n        for (k = j + 1; k <= i - 1; k++) {\n          g += V.get(k, j) * d[k];\n          e[k] += V.get(k, j) * f;\n        }\n\n        e[j] = g;\n      }\n\n      f = 0;\n\n      for (j = 0; j < i; j++) {\n        e[j] /= h;\n        f += e[j] * d[j];\n      }\n\n      hh = f / (h + h);\n\n      for (j = 0; j < i; j++) {\n        e[j] -= hh * d[j];\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        g = e[j];\n\n        for (k = j; k <= i - 1; k++) {\n          V.set(k, j, V.get(k, j) - (f * e[k] + g * d[k]));\n        }\n\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n      }\n    }\n\n    d[i] = h;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    V.set(n - 1, i, V.get(i, i));\n    V.set(i, i, 1);\n    h = d[i + 1];\n\n    if (h !== 0) {\n      for (k = 0; k <= i; k++) {\n        d[k] = V.get(k, i + 1) / h;\n      }\n\n      for (j = 0; j <= i; j++) {\n        g = 0;\n\n        for (k = 0; k <= i; k++) {\n          g += V.get(k, i + 1) * V.get(k, j);\n        }\n\n        for (k = 0; k <= i; k++) {\n          V.set(k, j, V.get(k, j) - g * d[k]);\n        }\n      }\n    }\n\n    for (k = 0; k <= i; k++) {\n      V.set(k, i + 1, 0);\n    }\n  }\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n    V.set(n - 1, j, 0);\n  }\n\n  V.set(n - 1, n - 1, 1);\n  e[0] = 0;\n}\n\nfunction tql2(n, e, d, V) {\n  let g, h, i, j, k, l, m, p, r, dl1, c, c2, c3, el1, s, s2, iter;\n\n  for (i = 1; i < n; i++) {\n    e[i - 1] = e[i];\n  }\n\n  e[n - 1] = 0;\n  let f = 0;\n  let tst1 = 0;\n  let eps = Number.EPSILON;\n\n  for (l = 0; l < n; l++) {\n    tst1 = Math.max(tst1, Math.abs(d[l]) + Math.abs(e[l]));\n    m = l;\n\n    while (m < n) {\n      if (Math.abs(e[m]) <= eps * tst1) {\n        break;\n      }\n\n      m++;\n    }\n\n    if (m > l) {\n      iter = 0;\n\n      do {\n        iter = iter + 1;\n        g = d[l];\n        p = (d[l + 1] - g) / (2 * e[l]);\n        r = hypotenuse(p, 1);\n\n        if (p < 0) {\n          r = -r;\n        }\n\n        d[l] = e[l] / (p + r);\n        d[l + 1] = e[l] * (p + r);\n        dl1 = d[l + 1];\n        h = g - d[l];\n\n        for (i = l + 2; i < n; i++) {\n          d[i] -= h;\n        }\n\n        f = f + h;\n        p = d[m];\n        c = 1;\n        c2 = c;\n        c3 = c;\n        el1 = e[l + 1];\n        s = 0;\n        s2 = 0;\n\n        for (i = m - 1; i >= l; i--) {\n          c3 = c2;\n          c2 = c;\n          s2 = s;\n          g = c * e[i];\n          h = c * p;\n          r = hypotenuse(p, e[i]);\n          e[i + 1] = s * r;\n          s = e[i] / r;\n          c = p / r;\n          p = c * d[i] - s * g;\n          d[i + 1] = h + s * (c * g + s * d[i]);\n\n          for (k = 0; k < n; k++) {\n            h = V.get(k, i + 1);\n            V.set(k, i + 1, s * V.get(k, i) + c * h);\n            V.set(k, i, c * V.get(k, i) - s * h);\n          }\n        }\n\n        p = -s * s2 * c3 * el1 * e[l] / dl1;\n        e[l] = s * p;\n        d[l] = c * p;\n      } while (Math.abs(e[l]) > eps * tst1);\n    }\n\n    d[l] = d[l] + f;\n    e[l] = 0;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    k = i;\n    p = d[i];\n\n    for (j = i + 1; j < n; j++) {\n      if (d[j] < p) {\n        k = j;\n        p = d[j];\n      }\n    }\n\n    if (k !== i) {\n      d[k] = d[i];\n      d[i] = p;\n\n      for (j = 0; j < n; j++) {\n        p = V.get(j, i);\n        V.set(j, i, V.get(j, k));\n        V.set(j, k, p);\n      }\n    }\n  }\n}\n\nfunction orthes(n, H, ort, V) {\n  let low = 0;\n  let high = n - 1;\n  let f, g, h, i, j, m;\n  let scale;\n\n  for (m = low + 1; m <= high - 1; m++) {\n    scale = 0;\n\n    for (i = m; i <= high; i++) {\n      scale = scale + Math.abs(H.get(i, m - 1));\n    }\n\n    if (scale !== 0) {\n      h = 0;\n\n      for (i = high; i >= m; i--) {\n        ort[i] = H.get(i, m - 1) / scale;\n        h += ort[i] * ort[i];\n      }\n\n      g = Math.sqrt(h);\n\n      if (ort[m] > 0) {\n        g = -g;\n      }\n\n      h = h - ort[m] * g;\n      ort[m] = ort[m] - g;\n\n      for (j = m; j < n; j++) {\n        f = 0;\n\n        for (i = high; i >= m; i--) {\n          f += ort[i] * H.get(i, j);\n        }\n\n        f = f / h;\n\n        for (i = m; i <= high; i++) {\n          H.set(i, j, H.get(i, j) - f * ort[i]);\n        }\n      }\n\n      for (i = 0; i <= high; i++) {\n        f = 0;\n\n        for (j = high; j >= m; j--) {\n          f += ort[j] * H.get(i, j);\n        }\n\n        f = f / h;\n\n        for (j = m; j <= high; j++) {\n          H.set(i, j, H.get(i, j) - f * ort[j]);\n        }\n      }\n\n      ort[m] = scale * ort[m];\n      H.set(m, m - 1, scale * g);\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    for (j = 0; j < n; j++) {\n      V.set(i, j, i === j ? 1 : 0);\n    }\n  }\n\n  for (m = high - 1; m >= low + 1; m--) {\n    if (H.get(m, m - 1) !== 0) {\n      for (i = m + 1; i <= high; i++) {\n        ort[i] = H.get(i, m - 1);\n      }\n\n      for (j = m; j <= high; j++) {\n        g = 0;\n\n        for (i = m; i <= high; i++) {\n          g += ort[i] * V.get(i, j);\n        }\n\n        g = g / ort[m] / H.get(m, m - 1);\n\n        for (i = m; i <= high; i++) {\n          V.set(i, j, V.get(i, j) + g * ort[i]);\n        }\n      }\n    }\n  }\n}\n\nfunction hqr2(nn, e, d, V, H) {\n  let n = nn - 1;\n  let low = 0;\n  let high = nn - 1;\n  let eps = Number.EPSILON;\n  let exshift = 0;\n  let norm = 0;\n  let p = 0;\n  let q = 0;\n  let r = 0;\n  let s = 0;\n  let z = 0;\n  let iter = 0;\n  let i, j, k, l, m, t, w, x, y;\n  let ra, sa, vr, vi;\n  let notlast, cdivres;\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      d[i] = H.get(i, i);\n      e[i] = 0;\n    }\n\n    for (j = Math.max(i - 1, 0); j < nn; j++) {\n      norm = norm + Math.abs(H.get(i, j));\n    }\n  }\n\n  while (n >= low) {\n    l = n;\n\n    while (l > low) {\n      s = Math.abs(H.get(l - 1, l - 1)) + Math.abs(H.get(l, l));\n\n      if (s === 0) {\n        s = norm;\n      }\n\n      if (Math.abs(H.get(l, l - 1)) < eps * s) {\n        break;\n      }\n\n      l--;\n    }\n\n    if (l === n) {\n      H.set(n, n, H.get(n, n) + exshift);\n      d[n] = H.get(n, n);\n      e[n] = 0;\n      n--;\n      iter = 0;\n    } else if (l === n - 1) {\n      w = H.get(n, n - 1) * H.get(n - 1, n);\n      p = (H.get(n - 1, n - 1) - H.get(n, n)) / 2;\n      q = p * p + w;\n      z = Math.sqrt(Math.abs(q));\n      H.set(n, n, H.get(n, n) + exshift);\n      H.set(n - 1, n - 1, H.get(n - 1, n - 1) + exshift);\n      x = H.get(n, n);\n\n      if (q >= 0) {\n        z = p >= 0 ? p + z : p - z;\n        d[n - 1] = x + z;\n        d[n] = d[n - 1];\n\n        if (z !== 0) {\n          d[n] = x - w / z;\n        }\n\n        e[n - 1] = 0;\n        e[n] = 0;\n        x = H.get(n, n - 1);\n        s = Math.abs(x) + Math.abs(z);\n        p = x / s;\n        q = z / s;\n        r = Math.sqrt(p * p + q * q);\n        p = p / r;\n        q = q / r;\n\n        for (j = n - 1; j < nn; j++) {\n          z = H.get(n - 1, j);\n          H.set(n - 1, j, q * z + p * H.get(n, j));\n          H.set(n, j, q * H.get(n, j) - p * z);\n        }\n\n        for (i = 0; i <= n; i++) {\n          z = H.get(i, n - 1);\n          H.set(i, n - 1, q * z + p * H.get(i, n));\n          H.set(i, n, q * H.get(i, n) - p * z);\n        }\n\n        for (i = low; i <= high; i++) {\n          z = V.get(i, n - 1);\n          V.set(i, n - 1, q * z + p * V.get(i, n));\n          V.set(i, n, q * V.get(i, n) - p * z);\n        }\n      } else {\n        d[n - 1] = x + p;\n        d[n] = x + p;\n        e[n - 1] = z;\n        e[n] = -z;\n      }\n\n      n = n - 2;\n      iter = 0;\n    } else {\n      x = H.get(n, n);\n      y = 0;\n      w = 0;\n\n      if (l < n) {\n        y = H.get(n - 1, n - 1);\n        w = H.get(n, n - 1) * H.get(n - 1, n);\n      }\n\n      if (iter === 10) {\n        exshift += x;\n\n        for (i = low; i <= n; i++) {\n          H.set(i, i, H.get(i, i) - x);\n        }\n\n        s = Math.abs(H.get(n, n - 1)) + Math.abs(H.get(n - 1, n - 2));\n        x = y = 0.75 * s;\n        w = -0.4375 * s * s;\n      }\n\n      if (iter === 30) {\n        s = (y - x) / 2;\n        s = s * s + w;\n\n        if (s > 0) {\n          s = Math.sqrt(s);\n\n          if (y < x) {\n            s = -s;\n          }\n\n          s = x - w / ((y - x) / 2 + s);\n\n          for (i = low; i <= n; i++) {\n            H.set(i, i, H.get(i, i) - s);\n          }\n\n          exshift += s;\n          x = y = w = 0.964;\n        }\n      }\n\n      iter = iter + 1;\n      m = n - 2;\n\n      while (m >= l) {\n        z = H.get(m, m);\n        r = x - z;\n        s = y - z;\n        p = (r * s - w) / H.get(m + 1, m) + H.get(m, m + 1);\n        q = H.get(m + 1, m + 1) - z - r - s;\n        r = H.get(m + 2, m + 1);\n        s = Math.abs(p) + Math.abs(q) + Math.abs(r);\n        p = p / s;\n        q = q / s;\n        r = r / s;\n\n        if (m === l) {\n          break;\n        }\n\n        if (Math.abs(H.get(m, m - 1)) * (Math.abs(q) + Math.abs(r)) < eps * (Math.abs(p) * (Math.abs(H.get(m - 1, m - 1)) + Math.abs(z) + Math.abs(H.get(m + 1, m + 1))))) {\n          break;\n        }\n\n        m--;\n      }\n\n      for (i = m + 2; i <= n; i++) {\n        H.set(i, i - 2, 0);\n\n        if (i > m + 2) {\n          H.set(i, i - 3, 0);\n        }\n      }\n\n      for (k = m; k <= n - 1; k++) {\n        notlast = k !== n - 1;\n\n        if (k !== m) {\n          p = H.get(k, k - 1);\n          q = H.get(k + 1, k - 1);\n          r = notlast ? H.get(k + 2, k - 1) : 0;\n          x = Math.abs(p) + Math.abs(q) + Math.abs(r);\n\n          if (x !== 0) {\n            p = p / x;\n            q = q / x;\n            r = r / x;\n          }\n        }\n\n        if (x === 0) {\n          break;\n        }\n\n        s = Math.sqrt(p * p + q * q + r * r);\n\n        if (p < 0) {\n          s = -s;\n        }\n\n        if (s !== 0) {\n          if (k !== m) {\n            H.set(k, k - 1, -s * x);\n          } else if (l !== m) {\n            H.set(k, k - 1, -H.get(k, k - 1));\n          }\n\n          p = p + s;\n          x = p / s;\n          y = q / s;\n          z = r / s;\n          q = q / p;\n          r = r / p;\n\n          for (j = k; j < nn; j++) {\n            p = H.get(k, j) + q * H.get(k + 1, j);\n\n            if (notlast) {\n              p = p + r * H.get(k + 2, j);\n              H.set(k + 2, j, H.get(k + 2, j) - p * z);\n            }\n\n            H.set(k, j, H.get(k, j) - p * x);\n            H.set(k + 1, j, H.get(k + 1, j) - p * y);\n          }\n\n          for (i = 0; i <= Math.min(n, k + 3); i++) {\n            p = x * H.get(i, k) + y * H.get(i, k + 1);\n\n            if (notlast) {\n              p = p + z * H.get(i, k + 2);\n              H.set(i, k + 2, H.get(i, k + 2) - p * r);\n            }\n\n            H.set(i, k, H.get(i, k) - p);\n            H.set(i, k + 1, H.get(i, k + 1) - p * q);\n          }\n\n          for (i = low; i <= high; i++) {\n            p = x * V.get(i, k) + y * V.get(i, k + 1);\n\n            if (notlast) {\n              p = p + z * V.get(i, k + 2);\n              V.set(i, k + 2, V.get(i, k + 2) - p * r);\n            }\n\n            V.set(i, k, V.get(i, k) - p);\n            V.set(i, k + 1, V.get(i, k + 1) - p * q);\n          }\n        }\n      }\n    }\n  }\n\n  if (norm === 0) {\n    return;\n  }\n\n  for (n = nn - 1; n >= 0; n--) {\n    p = d[n];\n    q = e[n];\n\n    if (q === 0) {\n      l = n;\n      H.set(n, n, 1);\n\n      for (i = n - 1; i >= 0; i--) {\n        w = H.get(i, i) - p;\n        r = 0;\n\n        for (j = l; j <= n; j++) {\n          r = r + H.get(i, j) * H.get(j, n);\n        }\n\n        if (e[i] < 0) {\n          z = w;\n          s = r;\n        } else {\n          l = i;\n\n          if (e[i] === 0) {\n            H.set(i, n, w !== 0 ? -r / w : -r / (eps * norm));\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            q = (d[i] - p) * (d[i] - p) + e[i] * e[i];\n            t = (x * s - z * r) / q;\n            H.set(i, n, t);\n            H.set(i + 1, n, Math.abs(x) > Math.abs(z) ? (-r - w * t) / x : (-s - y * t) / z);\n          }\n\n          t = Math.abs(H.get(i, n));\n\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    } else if (q < 0) {\n      l = n - 1;\n\n      if (Math.abs(H.get(n, n - 1)) > Math.abs(H.get(n - 1, n))) {\n        H.set(n - 1, n - 1, q / H.get(n, n - 1));\n        H.set(n - 1, n, -(H.get(n, n) - p) / H.get(n, n - 1));\n      } else {\n        cdivres = cdiv(0, -H.get(n - 1, n), H.get(n - 1, n - 1) - p, q);\n        H.set(n - 1, n - 1, cdivres[0]);\n        H.set(n - 1, n, cdivres[1]);\n      }\n\n      H.set(n, n - 1, 0);\n      H.set(n, n, 1);\n\n      for (i = n - 2; i >= 0; i--) {\n        ra = 0;\n        sa = 0;\n\n        for (j = l; j <= n; j++) {\n          ra = ra + H.get(i, j) * H.get(j, n - 1);\n          sa = sa + H.get(i, j) * H.get(j, n);\n        }\n\n        w = H.get(i, i) - p;\n\n        if (e[i] < 0) {\n          z = w;\n          r = ra;\n          s = sa;\n        } else {\n          l = i;\n\n          if (e[i] === 0) {\n            cdivres = cdiv(-ra, -sa, w, q);\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            vr = (d[i] - p) * (d[i] - p) + e[i] * e[i] - q * q;\n            vi = (d[i] - p) * 2 * q;\n\n            if (vr === 0 && vi === 0) {\n              vr = eps * norm * (Math.abs(w) + Math.abs(q) + Math.abs(x) + Math.abs(y) + Math.abs(z));\n            }\n\n            cdivres = cdiv(x * r - z * ra + q * sa, x * s - z * sa - q * ra, vr, vi);\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n\n            if (Math.abs(x) > Math.abs(z) + Math.abs(q)) {\n              H.set(i + 1, n - 1, (-ra - w * H.get(i, n - 1) + q * H.get(i, n)) / x);\n              H.set(i + 1, n, (-sa - w * H.get(i, n) - q * H.get(i, n - 1)) / x);\n            } else {\n              cdivres = cdiv(-r - y * H.get(i, n - 1), -s - y * H.get(i, n), z, q);\n              H.set(i + 1, n - 1, cdivres[0]);\n              H.set(i + 1, n, cdivres[1]);\n            }\n          }\n\n          t = Math.max(Math.abs(H.get(i, n - 1)), Math.abs(H.get(i, n)));\n\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n - 1, H.get(j, n - 1) / t);\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      for (j = i; j < nn; j++) {\n        V.set(i, j, H.get(i, j));\n      }\n    }\n  }\n\n  for (j = nn - 1; j >= low; j--) {\n    for (i = low; i <= high; i++) {\n      z = 0;\n\n      for (k = low; k <= Math.min(j, high); k++) {\n        z = z + V.get(i, k) * H.get(k, j);\n      }\n\n      V.set(i, j, z);\n    }\n  }\n}\n\nfunction cdiv(xr, xi, yr, yi) {\n  let r, d;\n\n  if (Math.abs(yr) > Math.abs(yi)) {\n    r = yi / yr;\n    d = yr + r * yi;\n    return [(xr + r * xi) / d, (xi - r * xr) / d];\n  } else {\n    r = yr / yi;\n    d = yi + r * yr;\n    return [(r * xr + xi) / d, (r * xi - xr) / d];\n  }\n}","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/ml-matrix/src/dc/evd.js"],"names":["Matrix","WrapperMatrix2D","hypotenuse","EigenvalueDecomposition","constructor","matrix","options","assumeSymmetric","checkMatrix","isSquare","Error","n","columns","V","d","Float64Array","e","value","i","j","isSymmetric","set","get","tred2","tql2","H","ort","orthes","hqr2","realEigenvalues","Array","from","imaginaryEigenvalues","eigenvectorMatrix","diagonalMatrix","X","f","g","h","k","hh","scale","Math","abs","sqrt","l","m","p","r","dl1","c","c2","c3","el1","s","s2","iter","tst1","eps","Number","EPSILON","max","low","high","nn","exshift","norm","q","z","t","w","x","y","ra","sa","vr","vi","notlast","cdivres","min","cdiv","xr","xi","yr","yi"],"mappings":"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","sourcesContent":["import Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\n\nimport { hypotenuse } from './util';\n\nexport default class EigenvalueDecomposition {\n  constructor(matrix, options = {}) {\n    const { assumeSymmetric = false } = options;\n\n    matrix = WrapperMatrix2D.checkMatrix(matrix);\n    if (!matrix.isSquare()) {\n      throw new Error('Matrix is not a square matrix');\n    }\n\n    let n = matrix.columns;\n    let V = new Matrix(n, n);\n    let d = new Float64Array(n);\n    let e = new Float64Array(n);\n    let value = matrix;\n    let i, j;\n\n    let isSymmetric = false;\n    if (assumeSymmetric) {\n      isSymmetric = true;\n    } else {\n      isSymmetric = matrix.isSymmetric();\n    }\n\n    if (isSymmetric) {\n      for (i = 0; i < n; i++) {\n        for (j = 0; j < n; j++) {\n          V.set(i, j, value.get(i, j));\n        }\n      }\n      tred2(n, e, d, V);\n      tql2(n, e, d, V);\n    } else {\n      let H = new Matrix(n, n);\n      let ort = new Float64Array(n);\n      for (j = 0; j < n; j++) {\n        for (i = 0; i < n; i++) {\n          H.set(i, j, value.get(i, j));\n        }\n      }\n      orthes(n, H, ort, V);\n      hqr2(n, e, d, V, H);\n    }\n\n    this.n = n;\n    this.e = e;\n    this.d = d;\n    this.V = V;\n  }\n\n  get realEigenvalues() {\n    return Array.from(this.d);\n  }\n\n  get imaginaryEigenvalues() {\n    return Array.from(this.e);\n  }\n\n  get eigenvectorMatrix() {\n    return this.V;\n  }\n\n  get diagonalMatrix() {\n    let n = this.n;\n    let e = this.e;\n    let d = this.d;\n    let X = new Matrix(n, n);\n    let i, j;\n    for (i = 0; i < n; i++) {\n      for (j = 0; j < n; j++) {\n        X.set(i, j, 0);\n      }\n      X.set(i, i, d[i]);\n      if (e[i] > 0) {\n        X.set(i, i + 1, e[i]);\n      } else if (e[i] < 0) {\n        X.set(i, i - 1, e[i]);\n      }\n    }\n    return X;\n  }\n}\n\nfunction tred2(n, e, d, V) {\n  let f, g, h, i, j, k, hh, scale;\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n  }\n\n  for (i = n - 1; i > 0; i--) {\n    scale = 0;\n    h = 0;\n    for (k = 0; k < i; k++) {\n      scale = scale + Math.abs(d[k]);\n    }\n\n    if (scale === 0) {\n      e[i] = d[i - 1];\n      for (j = 0; j < i; j++) {\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n        V.set(j, i, 0);\n      }\n    } else {\n      for (k = 0; k < i; k++) {\n        d[k] /= scale;\n        h += d[k] * d[k];\n      }\n\n      f = d[i - 1];\n      g = Math.sqrt(h);\n      if (f > 0) {\n        g = -g;\n      }\n\n      e[i] = scale * g;\n      h = h - f * g;\n      d[i - 1] = f - g;\n      for (j = 0; j < i; j++) {\n        e[j] = 0;\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        V.set(j, i, f);\n        g = e[j] + V.get(j, j) * f;\n        for (k = j + 1; k <= i - 1; k++) {\n          g += V.get(k, j) * d[k];\n          e[k] += V.get(k, j) * f;\n        }\n        e[j] = g;\n      }\n\n      f = 0;\n      for (j = 0; j < i; j++) {\n        e[j] /= h;\n        f += e[j] * d[j];\n      }\n\n      hh = f / (h + h);\n      for (j = 0; j < i; j++) {\n        e[j] -= hh * d[j];\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        g = e[j];\n        for (k = j; k <= i - 1; k++) {\n          V.set(k, j, V.get(k, j) - (f * e[k] + g * d[k]));\n        }\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n      }\n    }\n    d[i] = h;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    V.set(n - 1, i, V.get(i, i));\n    V.set(i, i, 1);\n    h = d[i + 1];\n    if (h !== 0) {\n      for (k = 0; k <= i; k++) {\n        d[k] = V.get(k, i + 1) / h;\n      }\n\n      for (j = 0; j <= i; j++) {\n        g = 0;\n        for (k = 0; k <= i; k++) {\n          g += V.get(k, i + 1) * V.get(k, j);\n        }\n        for (k = 0; k <= i; k++) {\n          V.set(k, j, V.get(k, j) - g * d[k]);\n        }\n      }\n    }\n\n    for (k = 0; k <= i; k++) {\n      V.set(k, i + 1, 0);\n    }\n  }\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n    V.set(n - 1, j, 0);\n  }\n\n  V.set(n - 1, n - 1, 1);\n  e[0] = 0;\n}\n\nfunction tql2(n, e, d, V) {\n  let g, h, i, j, k, l, m, p, r, dl1, c, c2, c3, el1, s, s2, iter;\n\n  for (i = 1; i < n; i++) {\n    e[i - 1] = e[i];\n  }\n\n  e[n - 1] = 0;\n\n  let f = 0;\n  let tst1 = 0;\n  let eps = Number.EPSILON;\n\n  for (l = 0; l < n; l++) {\n    tst1 = Math.max(tst1, Math.abs(d[l]) + Math.abs(e[l]));\n    m = l;\n    while (m < n) {\n      if (Math.abs(e[m]) <= eps * tst1) {\n        break;\n      }\n      m++;\n    }\n\n    if (m > l) {\n      iter = 0;\n      do {\n        iter = iter + 1;\n\n        g = d[l];\n        p = (d[l + 1] - g) / (2 * e[l]);\n        r = hypotenuse(p, 1);\n        if (p < 0) {\n          r = -r;\n        }\n\n        d[l] = e[l] / (p + r);\n        d[l + 1] = e[l] * (p + r);\n        dl1 = d[l + 1];\n        h = g - d[l];\n        for (i = l + 2; i < n; i++) {\n          d[i] -= h;\n        }\n\n        f = f + h;\n\n        p = d[m];\n        c = 1;\n        c2 = c;\n        c3 = c;\n        el1 = e[l + 1];\n        s = 0;\n        s2 = 0;\n        for (i = m - 1; i >= l; i--) {\n          c3 = c2;\n          c2 = c;\n          s2 = s;\n          g = c * e[i];\n          h = c * p;\n          r = hypotenuse(p, e[i]);\n          e[i + 1] = s * r;\n          s = e[i] / r;\n          c = p / r;\n          p = c * d[i] - s * g;\n          d[i + 1] = h + s * (c * g + s * d[i]);\n\n          for (k = 0; k < n; k++) {\n            h = V.get(k, i + 1);\n            V.set(k, i + 1, s * V.get(k, i) + c * h);\n            V.set(k, i, c * V.get(k, i) - s * h);\n          }\n        }\n\n        p = (-s * s2 * c3 * el1 * e[l]) / dl1;\n        e[l] = s * p;\n        d[l] = c * p;\n      } while (Math.abs(e[l]) > eps * tst1);\n    }\n    d[l] = d[l] + f;\n    e[l] = 0;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    k = i;\n    p = d[i];\n    for (j = i + 1; j < n; j++) {\n      if (d[j] < p) {\n        k = j;\n        p = d[j];\n      }\n    }\n\n    if (k !== i) {\n      d[k] = d[i];\n      d[i] = p;\n      for (j = 0; j < n; j++) {\n        p = V.get(j, i);\n        V.set(j, i, V.get(j, k));\n        V.set(j, k, p);\n      }\n    }\n  }\n}\n\nfunction orthes(n, H, ort, V) {\n  let low = 0;\n  let high = n - 1;\n  let f, g, h, i, j, m;\n  let scale;\n\n  for (m = low + 1; m <= high - 1; m++) {\n    scale = 0;\n    for (i = m; i <= high; i++) {\n      scale = scale + Math.abs(H.get(i, m - 1));\n    }\n\n    if (scale !== 0) {\n      h = 0;\n      for (i = high; i >= m; i--) {\n        ort[i] = H.get(i, m - 1) / scale;\n        h += ort[i] * ort[i];\n      }\n\n      g = Math.sqrt(h);\n      if (ort[m] > 0) {\n        g = -g;\n      }\n\n      h = h - ort[m] * g;\n      ort[m] = ort[m] - g;\n\n      for (j = m; j < n; j++) {\n        f = 0;\n        for (i = high; i >= m; i--) {\n          f += ort[i] * H.get(i, j);\n        }\n\n        f = f / h;\n        for (i = m; i <= high; i++) {\n          H.set(i, j, H.get(i, j) - f * ort[i]);\n        }\n      }\n\n      for (i = 0; i <= high; i++) {\n        f = 0;\n        for (j = high; j >= m; j--) {\n          f += ort[j] * H.get(i, j);\n        }\n\n        f = f / h;\n        for (j = m; j <= high; j++) {\n          H.set(i, j, H.get(i, j) - f * ort[j]);\n        }\n      }\n\n      ort[m] = scale * ort[m];\n      H.set(m, m - 1, scale * g);\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    for (j = 0; j < n; j++) {\n      V.set(i, j, i === j ? 1 : 0);\n    }\n  }\n\n  for (m = high - 1; m >= low + 1; m--) {\n    if (H.get(m, m - 1) !== 0) {\n      for (i = m + 1; i <= high; i++) {\n        ort[i] = H.get(i, m - 1);\n      }\n\n      for (j = m; j <= high; j++) {\n        g = 0;\n        for (i = m; i <= high; i++) {\n          g += ort[i] * V.get(i, j);\n        }\n\n        g = g / ort[m] / H.get(m, m - 1);\n        for (i = m; i <= high; i++) {\n          V.set(i, j, V.get(i, j) + g * ort[i]);\n        }\n      }\n    }\n  }\n}\n\nfunction hqr2(nn, e, d, V, H) {\n  let n = nn - 1;\n  let low = 0;\n  let high = nn - 1;\n  let eps = Number.EPSILON;\n  let exshift = 0;\n  let norm = 0;\n  let p = 0;\n  let q = 0;\n  let r = 0;\n  let s = 0;\n  let z = 0;\n  let iter = 0;\n  let i, j, k, l, m, t, w, x, y;\n  let ra, sa, vr, vi;\n  let notlast, cdivres;\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      d[i] = H.get(i, i);\n      e[i] = 0;\n    }\n\n    for (j = Math.max(i - 1, 0); j < nn; j++) {\n      norm = norm + Math.abs(H.get(i, j));\n    }\n  }\n\n  while (n >= low) {\n    l = n;\n    while (l > low) {\n      s = Math.abs(H.get(l - 1, l - 1)) + Math.abs(H.get(l, l));\n      if (s === 0) {\n        s = norm;\n      }\n      if (Math.abs(H.get(l, l - 1)) < eps * s) {\n        break;\n      }\n      l--;\n    }\n\n    if (l === n) {\n      H.set(n, n, H.get(n, n) + exshift);\n      d[n] = H.get(n, n);\n      e[n] = 0;\n      n--;\n      iter = 0;\n    } else if (l === n - 1) {\n      w = H.get(n, n - 1) * H.get(n - 1, n);\n      p = (H.get(n - 1, n - 1) - H.get(n, n)) / 2;\n      q = p * p + w;\n      z = Math.sqrt(Math.abs(q));\n      H.set(n, n, H.get(n, n) + exshift);\n      H.set(n - 1, n - 1, H.get(n - 1, n - 1) + exshift);\n      x = H.get(n, n);\n\n      if (q >= 0) {\n        z = p >= 0 ? p + z : p - z;\n        d[n - 1] = x + z;\n        d[n] = d[n - 1];\n        if (z !== 0) {\n          d[n] = x - w / z;\n        }\n        e[n - 1] = 0;\n        e[n] = 0;\n        x = H.get(n, n - 1);\n        s = Math.abs(x) + Math.abs(z);\n        p = x / s;\n        q = z / s;\n        r = Math.sqrt(p * p + q * q);\n        p = p / r;\n        q = q / r;\n\n        for (j = n - 1; j < nn; j++) {\n          z = H.get(n - 1, j);\n          H.set(n - 1, j, q * z + p * H.get(n, j));\n          H.set(n, j, q * H.get(n, j) - p * z);\n        }\n\n        for (i = 0; i <= n; i++) {\n          z = H.get(i, n - 1);\n          H.set(i, n - 1, q * z + p * H.get(i, n));\n          H.set(i, n, q * H.get(i, n) - p * z);\n        }\n\n        for (i = low; i <= high; i++) {\n          z = V.get(i, n - 1);\n          V.set(i, n - 1, q * z + p * V.get(i, n));\n          V.set(i, n, q * V.get(i, n) - p * z);\n        }\n      } else {\n        d[n - 1] = x + p;\n        d[n] = x + p;\n        e[n - 1] = z;\n        e[n] = -z;\n      }\n\n      n = n - 2;\n      iter = 0;\n    } else {\n      x = H.get(n, n);\n      y = 0;\n      w = 0;\n      if (l < n) {\n        y = H.get(n - 1, n - 1);\n        w = H.get(n, n - 1) * H.get(n - 1, n);\n      }\n\n      if (iter === 10) {\n        exshift += x;\n        for (i = low; i <= n; i++) {\n          H.set(i, i, H.get(i, i) - x);\n        }\n        s = Math.abs(H.get(n, n - 1)) + Math.abs(H.get(n - 1, n - 2));\n        x = y = 0.75 * s;\n        w = -0.4375 * s * s;\n      }\n\n      if (iter === 30) {\n        s = (y - x) / 2;\n        s = s * s + w;\n        if (s > 0) {\n          s = Math.sqrt(s);\n          if (y < x) {\n            s = -s;\n          }\n          s = x - w / ((y - x) / 2 + s);\n          for (i = low; i <= n; i++) {\n            H.set(i, i, H.get(i, i) - s);\n          }\n          exshift += s;\n          x = y = w = 0.964;\n        }\n      }\n\n      iter = iter + 1;\n\n      m = n - 2;\n      while (m >= l) {\n        z = H.get(m, m);\n        r = x - z;\n        s = y - z;\n        p = (r * s - w) / H.get(m + 1, m) + H.get(m, m + 1);\n        q = H.get(m + 1, m + 1) - z - r - s;\n        r = H.get(m + 2, m + 1);\n        s = Math.abs(p) + Math.abs(q) + Math.abs(r);\n        p = p / s;\n        q = q / s;\n        r = r / s;\n        if (m === l) {\n          break;\n        }\n        if (\n          Math.abs(H.get(m, m - 1)) * (Math.abs(q) + Math.abs(r)) <\n          eps *\n            (Math.abs(p) *\n              (Math.abs(H.get(m - 1, m - 1)) +\n                Math.abs(z) +\n                Math.abs(H.get(m + 1, m + 1))))\n        ) {\n          break;\n        }\n        m--;\n      }\n\n      for (i = m + 2; i <= n; i++) {\n        H.set(i, i - 2, 0);\n        if (i > m + 2) {\n          H.set(i, i - 3, 0);\n        }\n      }\n\n      for (k = m; k <= n - 1; k++) {\n        notlast = k !== n - 1;\n        if (k !== m) {\n          p = H.get(k, k - 1);\n          q = H.get(k + 1, k - 1);\n          r = notlast ? H.get(k + 2, k - 1) : 0;\n          x = Math.abs(p) + Math.abs(q) + Math.abs(r);\n          if (x !== 0) {\n            p = p / x;\n            q = q / x;\n            r = r / x;\n          }\n        }\n\n        if (x === 0) {\n          break;\n        }\n\n        s = Math.sqrt(p * p + q * q + r * r);\n        if (p < 0) {\n          s = -s;\n        }\n\n        if (s !== 0) {\n          if (k !== m) {\n            H.set(k, k - 1, -s * x);\n          } else if (l !== m) {\n            H.set(k, k - 1, -H.get(k, k - 1));\n          }\n\n          p = p + s;\n          x = p / s;\n          y = q / s;\n          z = r / s;\n          q = q / p;\n          r = r / p;\n\n          for (j = k; j < nn; j++) {\n            p = H.get(k, j) + q * H.get(k + 1, j);\n            if (notlast) {\n              p = p + r * H.get(k + 2, j);\n              H.set(k + 2, j, H.get(k + 2, j) - p * z);\n            }\n\n            H.set(k, j, H.get(k, j) - p * x);\n            H.set(k + 1, j, H.get(k + 1, j) - p * y);\n          }\n\n          for (i = 0; i <= Math.min(n, k + 3); i++) {\n            p = x * H.get(i, k) + y * H.get(i, k + 1);\n            if (notlast) {\n              p = p + z * H.get(i, k + 2);\n              H.set(i, k + 2, H.get(i, k + 2) - p * r);\n            }\n\n            H.set(i, k, H.get(i, k) - p);\n            H.set(i, k + 1, H.get(i, k + 1) - p * q);\n          }\n\n          for (i = low; i <= high; i++) {\n            p = x * V.get(i, k) + y * V.get(i, k + 1);\n            if (notlast) {\n              p = p + z * V.get(i, k + 2);\n              V.set(i, k + 2, V.get(i, k + 2) - p * r);\n            }\n\n            V.set(i, k, V.get(i, k) - p);\n            V.set(i, k + 1, V.get(i, k + 1) - p * q);\n          }\n        }\n      }\n    }\n  }\n\n  if (norm === 0) {\n    return;\n  }\n\n  for (n = nn - 1; n >= 0; n--) {\n    p = d[n];\n    q = e[n];\n\n    if (q === 0) {\n      l = n;\n      H.set(n, n, 1);\n      for (i = n - 1; i >= 0; i--) {\n        w = H.get(i, i) - p;\n        r = 0;\n        for (j = l; j <= n; j++) {\n          r = r + H.get(i, j) * H.get(j, n);\n        }\n\n        if (e[i] < 0) {\n          z = w;\n          s = r;\n        } else {\n          l = i;\n          if (e[i] === 0) {\n            H.set(i, n, w !== 0 ? -r / w : -r / (eps * norm));\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            q = (d[i] - p) * (d[i] - p) + e[i] * e[i];\n            t = (x * s - z * r) / q;\n            H.set(i, n, t);\n            H.set(\n              i + 1,\n              n,\n              Math.abs(x) > Math.abs(z) ? (-r - w * t) / x : (-s - y * t) / z,\n            );\n          }\n\n          t = Math.abs(H.get(i, n));\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    } else if (q < 0) {\n      l = n - 1;\n\n      if (Math.abs(H.get(n, n - 1)) > Math.abs(H.get(n - 1, n))) {\n        H.set(n - 1, n - 1, q / H.get(n, n - 1));\n        H.set(n - 1, n, -(H.get(n, n) - p) / H.get(n, n - 1));\n      } else {\n        cdivres = cdiv(0, -H.get(n - 1, n), H.get(n - 1, n - 1) - p, q);\n        H.set(n - 1, n - 1, cdivres[0]);\n        H.set(n - 1, n, cdivres[1]);\n      }\n\n      H.set(n, n - 1, 0);\n      H.set(n, n, 1);\n      for (i = n - 2; i >= 0; i--) {\n        ra = 0;\n        sa = 0;\n        for (j = l; j <= n; j++) {\n          ra = ra + H.get(i, j) * H.get(j, n - 1);\n          sa = sa + H.get(i, j) * H.get(j, n);\n        }\n\n        w = H.get(i, i) - p;\n\n        if (e[i] < 0) {\n          z = w;\n          r = ra;\n          s = sa;\n        } else {\n          l = i;\n          if (e[i] === 0) {\n            cdivres = cdiv(-ra, -sa, w, q);\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            vr = (d[i] - p) * (d[i] - p) + e[i] * e[i] - q * q;\n            vi = (d[i] - p) * 2 * q;\n            if (vr === 0 && vi === 0) {\n              vr =\n                eps *\n                norm *\n                (Math.abs(w) +\n                  Math.abs(q) +\n                  Math.abs(x) +\n                  Math.abs(y) +\n                  Math.abs(z));\n            }\n            cdivres = cdiv(\n              x * r - z * ra + q * sa,\n              x * s - z * sa - q * ra,\n              vr,\n              vi,\n            );\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n            if (Math.abs(x) > Math.abs(z) + Math.abs(q)) {\n              H.set(\n                i + 1,\n                n - 1,\n                (-ra - w * H.get(i, n - 1) + q * H.get(i, n)) / x,\n              );\n              H.set(\n                i + 1,\n                n,\n                (-sa - w * H.get(i, n) - q * H.get(i, n - 1)) / x,\n              );\n            } else {\n              cdivres = cdiv(\n                -r - y * H.get(i, n - 1),\n                -s - y * H.get(i, n),\n                z,\n                q,\n              );\n              H.set(i + 1, n - 1, cdivres[0]);\n              H.set(i + 1, n, cdivres[1]);\n            }\n          }\n\n          t = Math.max(Math.abs(H.get(i, n - 1)), Math.abs(H.get(i, n)));\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n - 1, H.get(j, n - 1) / t);\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      for (j = i; j < nn; j++) {\n        V.set(i, j, H.get(i, j));\n      }\n    }\n  }\n\n  for (j = nn - 1; j >= low; j--) {\n    for (i = low; i <= high; i++) {\n      z = 0;\n      for (k = low; k <= Math.min(j, high); k++) {\n        z = z + V.get(i, k) * H.get(k, j);\n      }\n      V.set(i, j, z);\n    }\n  }\n}\n\nfunction cdiv(xr, xi, yr, yi) {\n  let r, d;\n  if (Math.abs(yr) > Math.abs(yi)) {\n    r = yi / yr;\n    d = yr + r * yi;\n    return [(xr + r * xi) / d, (xi - r * xr) / d];\n  } else {\n    r = yr / yi;\n    d = yi + r * yr;\n    return [(r * xr + xi) / d, (r * xi - xr) / d];\n  }\n}\n"]},"metadata":{},"sourceType":"module"}