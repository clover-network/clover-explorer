{"ast":null,"code":"import { __extends } from \"tslib\";\nimport Base from '../base';\nimport isString from '@antv/util/lib/is-string';\nimport createDOM from '@antv/dom-util/lib/create-dom';\nimport modifyCSS from '@antv/dom-util/lib/modify-css';\nimport isNil from '@antv/util/lib/is-nil';\nimport { mat3 } from '@antv/matrix-util';\nimport { applyMatrix } from '../../util/math';\n\nfunction getImgNaturalDimension(img, callback) {\n  var nWidth, nHeight;\n\n  if (img.naturalWidth) {\n    // 现代浏览器\n    nWidth = img.naturalWidth;\n    nHeight = img.naturalHeight;\n  } else {\n    // IE6/7/8\n    var image_1 = new Image();\n    image_1.src = img.src;\n\n    image_1.onload = function () {\n      callback === null || callback === void 0 ? void 0 : callback(image_1.width, image_1.height);\n    };\n  }\n\n  return [nWidth, nHeight];\n}\n\nvar ImageMiniMap =\n/** @class */\nfunction (_super) {\n  __extends(ImageMiniMap, _super);\n\n  function ImageMiniMap() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ImageMiniMap.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-minimap',\n      viewportClassName: 'g6-minimap-viewport',\n      width: 200,\n      delegateStyle: {\n        fill: '#40a9ff',\n        stroke: '#096dd9'\n      },\n      refresh: true\n    };\n  };\n\n  ImageMiniMap.prototype.getEvents = function () {\n    return {\n      beforepaint: 'updateViewport',\n      beforeanimate: 'disableRefresh',\n      afteranimate: 'enableRefresh',\n      viewportchange: 'disableOneRefresh'\n    };\n  }; // 若是正在进行动画，不刷新缩略图\n\n\n  ImageMiniMap.prototype.disableRefresh = function () {\n    this.set('refresh', false);\n  };\n\n  ImageMiniMap.prototype.enableRefresh = function () {\n    this.set('refresh', true);\n    this.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.disableOneRefresh = function () {\n    this.set('viewportChange', true);\n  };\n\n  ImageMiniMap.prototype.initViewport = function () {\n    var _this = this;\n\n    var cfgs = this._cfgs; // cWidth and cHeight are the width and height of the minimap's container\n\n    var graph = cfgs.graph;\n    if (this.destroyed) return;\n    var containerDOM = this.get('container');\n    var viewport = createDOM(\"<div class=\" + cfgs.viewportClassName + \"\\n      style='position:absolute;\\n        left:0;\\n        top:0;\\n        box-sizing:border-box;\\n        border: 2px solid #1980ff'>\\n      </div>\"); // 计算拖拽水平方向距离\n\n    var x = 0; // 计算拖拽垂直方向距离\n\n    var y = 0; // 是否在拖拽minimap的视口\n\n    var dragging = false; // 缓存viewport当前对于画布的x\n\n    var left = 0; // 缓存viewport当前对于画布的y\n\n    var top = 0; // 缓存viewport当前宽度\n\n    var width = 0; // 缓存viewport当前高度\n\n    var height = 0;\n    var ratio = 0;\n    var zoom = 0;\n    containerDOM.addEventListener('mousedown', function (e) {\n      cfgs.refresh = false;\n\n      if (e.target !== viewport) {\n        return;\n      } // 如果视口已经最大了，不需要拖拽\n\n\n      var style = viewport.style;\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      if (width > cWidth || height > cHeight) {\n        return;\n      }\n\n      zoom = graph.getZoom();\n      ratio = _this.get('ratio');\n      dragging = true;\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mousemove', function (e) {\n      if (!dragging || isNil(e.clientX) || isNil(e.clientY)) {\n        return;\n      }\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      var style = viewport.style;\n      left = parseInt(style.left, 10);\n      top = parseInt(style.top, 10);\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n      var dx = x - e.clientX;\n      var dy = y - e.clientY; // 若视口移动到最左边或最右边了,仅移动到边界\n\n      if (left - dx < 0) {\n        dx = left;\n      } else if (left - dx + width >= cWidth) {\n        dx = 0;\n      } // 若视口移动到最上或最下边了，仅移动到边界\n\n\n      if (top - dy < 0) {\n        dy = top;\n      } else if (top - dy + height >= cHeight) {\n        dy = 0;\n      }\n\n      left -= dx;\n      top -= dy; // 先移动视口，避免移动到边上以后出现视口闪烁\n\n      modifyCSS(viewport, {\n        left: left + \"px\",\n        top: top + \"px\"\n      }); // graph 移动需要偏移量 dx/dy * 缩放比例才会得到正确的移动距离\n\n      graph.translate(dx * zoom / ratio, dy * zoom / ratio);\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mouseleave', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    containerDOM.addEventListener('mouseup', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    this.set('viewport', viewport);\n    containerDOM.appendChild(viewport);\n  };\n  /**\n   * 更新 viewport 视图\n   */\n\n\n  ImageMiniMap.prototype.updateViewport = function () {\n    if (this.destroyed) return;\n    var ratio = this.get('ratio');\n    var cWidth = this.get('width');\n    var cHeight = this.get('height');\n    var graph = this.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphWidth / graphHeight;\n    var graphGroup = graph.getGroup(); // 主图的 bbox（矩阵变换相关的 bbox）\n\n    var graphCanvasBBox = graphGroup.getCanvasBBox(); // 扩展 graphBBox 到和 graphWidth / graphHeight 等比\n\n    var graphCanvasBBoxMean = [(graphCanvasBBox.minX + graphCanvasBBox.maxX) / 2, (graphCanvasBBox.minY + graphCanvasBBox.maxY) / 2];\n    var graphCanvasBBoxSize = [graphCanvasBBox.maxX - graphCanvasBBox.minX, graphCanvasBBox.maxY - graphCanvasBBox.minY];\n    var expandedGraphCanvasBBox = {\n      centerX: graphCanvasBBoxMean[0],\n      centerY: graphCanvasBBoxMean[1],\n      width: 0,\n      height: 0,\n      minX: 0,\n      minY: 0\n    };\n\n    if (graphCanvasBBox[0] / graphCanvasBBox[1] > aspectRatio) {\n      expandedGraphCanvasBBox.width = graphCanvasBBoxSize[0];\n      expandedGraphCanvasBBox.height = expandedGraphCanvasBBox.width / aspectRatio;\n    } else {\n      expandedGraphCanvasBBox.height = graphCanvasBBoxSize[1];\n      expandedGraphCanvasBBox.width = expandedGraphCanvasBBox.height * aspectRatio;\n    }\n\n    expandedGraphCanvasBBox.minX = graphCanvasBBoxMean[0] - expandedGraphCanvasBBox.width / 2;\n    expandedGraphCanvasBBox.minY = graphCanvasBBoxMean[1] - expandedGraphCanvasBBox.height / 2;\n    var graphMatrix = graphGroup.getMatrix();\n    if (!graphMatrix) graphMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var invertGraphMatrix = mat3.invert([], graphMatrix);\n    var minXY = applyMatrix({\n      x: expandedGraphCanvasBBox.minX,\n      y: expandedGraphCanvasBBox.minY\n    }, invertGraphMatrix); // 扩展 graphBBox 后的 bbox 的左上角对应的 canvas container 坐标\n\n    var topLeft = graph.getCanvasByPoint(minXY.x, minXY.y);\n    var viewport = this.get('viewport');\n\n    if (!viewport) {\n      this.initViewport();\n    } // Viewport 与 minimap container 的比例 =  Graph container 与 expandedGraphBBox 比例\n\n\n    var vpToMc = graphWidth / expandedGraphCanvasBBox.width; // viewport 宽高 = vpToMc * minimap container 宽高\n\n    var width = vpToMc * cWidth;\n    var height = vpToMc * cHeight; // vierport 左上角到 minimap container 的距离 / minimap container 宽高\n    // = 主图 expandedBBox 左上角 canvas container 坐标距离 / expandedBBox 宽高\n\n    var left = cWidth * -topLeft.x / expandedGraphCanvasBBox.width;\n    var top = cHeight * -topLeft.y / expandedGraphCanvasBBox.height;\n    var right = left + width;\n    var bottom = top + height;\n\n    if (left < 0) {\n      width += left;\n      left = 0;\n    }\n\n    if (right > cWidth) {\n      width = width - (right - cWidth);\n    }\n\n    if (top < 0) {\n      height += top;\n      top = 0;\n    }\n\n    if (bottom > cHeight) {\n      height = height - (bottom - cHeight);\n    } // 缓存目前缩放比，在移动 minimap 视窗时就不用再计算大图的移动量\n\n\n    this.set('ratio', ratio);\n    var correctLeft = left + \"px\";\n    var correctTop = top + \"px\";\n    modifyCSS(viewport, {\n      left: correctLeft,\n      top: correctTop,\n      width: width + \"px\",\n      height: height + \"px\"\n    });\n  };\n\n  ImageMiniMap.prototype.init = function () {\n    this.initContainer();\n  };\n  /**\n   * 初始化 Minimap 的容器\n   */\n\n\n  ImageMiniMap.prototype.initContainer = function () {\n    var self = this;\n    var graph = self.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphHeight / graphWidth;\n    var className = self.get('className');\n    var parentNode = self.get('container'); // size of the minimap's container\n\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    if (!cWidth && !cHeight) {\n      cWidth = 200;\n    }\n\n    if (cWidth) {\n      cHeight = aspectRatio * cWidth;\n      self.set('height', cHeight);\n    } else {\n      cWidth = 1 / aspectRatio * cHeight;\n      self.set('width', cWidth);\n    }\n\n    var container = createDOM(\"<div class='\" + className + \"' style='width: \" + cWidth + \"px; height: \" + cHeight + \"px; overflow: hidden; position: relative;'></div>\");\n\n    if (isString(parentNode)) {\n      parentNode = document.getElementById(parentNode);\n    }\n\n    if (parentNode) {\n      parentNode.appendChild(container);\n    } else {\n      graph.get('container').appendChild(container);\n    }\n\n    self.set('container', container);\n    var containerDOM = createDOM(\"<div class=\\\"g6-minimap-container\\\" style=\\\"position: relative; width: 100%; height: 100%; text-align: center; display: table;\\\"></div>\");\n    container.appendChild(containerDOM);\n    var span = createDOM(\"<span style=\\\"display: table-cell; vertical-align: middle; \\\"></span>\");\n    containerDOM.appendChild(span);\n    self.set('containerDOM', containerDOM);\n    self.set('containerSpan', span);\n    var img = createDOM(\"<img alt=\\\"\\\" src=\\\"\" + this.get('graphImg') + \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\");\n    self.set('imgDOM', img);\n    self.updateImgSize();\n    span.appendChild(img);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.updateImgSize = function () {\n    var self = this;\n    var imgDOM = self.get('imgDOM');\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    imgDOM.onload = function () {\n      var naturalSize = getImgNaturalDimension(imgDOM);\n\n      if (naturalSize[0] > naturalSize[1]) {\n        imgDOM.width = cWidth;\n      } else {\n        imgDOM.height = cHeight;\n      }\n    };\n  };\n\n  ImageMiniMap.prototype.updateCanvas = function () {\n    // 如果是在动画，则不刷新视图\n    var isRefresh = this.get('refresh');\n\n    if (!isRefresh) {\n      return;\n    }\n\n    var graph = this.get('graph');\n\n    if (graph.get('destroyed')) {\n      return;\n    } // 如果是视口变换，也不刷新视图，但是需要重置视口大小和位置\n\n\n    if (this.get('viewportChange')) {\n      this.set('viewportChange', false);\n      this.updateViewport();\n    }\n\n    var cWidth = this.get('width');\n    var graphBBox = graph.get('canvas').getCanvasBBox();\n    var width = graphBBox.width;\n    var ratio = cWidth / width; // // 更新minimap视口\n\n    this.set('ratio', ratio);\n    this.updateViewport();\n  };\n  /**\n   * 获取minimap的窗口\n   * @return {HTMLElement} 窗口的dom实例\n   */\n\n\n  ImageMiniMap.prototype.getViewport = function () {\n    return this.get('viewport');\n  };\n  /**\n   * 获取minimap的容器dom\n   * @return {HTMLElement} dom\n   */\n\n\n  ImageMiniMap.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  ImageMiniMap.prototype.updateGraphImg = function (img) {\n    var self = this;\n    var oriImgDOM = self.get('imgDOM');\n    oriImgDOM.remove();\n    self.set('graphImg', img);\n    var imgDOM = createDOM(\"<img alt=\\\"\\\" src=\\\"\" + img + \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\");\n    self.set('imgDOM', imgDOM);\n    imgDOM.src = img;\n    self.updateImgSize();\n    var span = self.get('containerSpan');\n    span.appendChild(imgDOM);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.destroy = function () {\n    var container = this.get('container');\n    container.parentNode.removeChild(container);\n  };\n\n  return ImageMiniMap;\n}(Base);\n\nexport default ImageMiniMap;","map":{"version":3,"sources":["/Users/wanglijie/wanglijie/clover-defi-wallet/node_modules/@antv/g6/es/plugins/imageMinimap/index.js"],"names":["__extends","Base","isString","createDOM","modifyCSS","isNil","mat3","applyMatrix","getImgNaturalDimension","img","callback","nWidth","nHeight","naturalWidth","naturalHeight","image_1","Image","src","onload","width","height","ImageMiniMap","_super","apply","arguments","prototype","getDefaultCfgs","container","className","viewportClassName","delegateStyle","fill","stroke","refresh","getEvents","beforepaint","beforeanimate","afteranimate","viewportchange","disableRefresh","set","enableRefresh","updateCanvas","disableOneRefresh","initViewport","_this","cfgs","_cfgs","graph","destroyed","containerDOM","get","viewport","x","y","dragging","left","top","ratio","zoom","addEventListener","e","target","style","parseInt","cWidth","cHeight","getZoom","clientX","clientY","dx","dy","translate","appendChild","updateViewport","graphWidth","graphHeight","aspectRatio","graphGroup","getGroup","graphCanvasBBox","getCanvasBBox","graphCanvasBBoxMean","minX","maxX","minY","maxY","graphCanvasBBoxSize","expandedGraphCanvasBBox","centerX","centerY","graphMatrix","getMatrix","invertGraphMatrix","invert","minXY","topLeft","getCanvasByPoint","vpToMc","right","bottom","correctLeft","correctTop","init","initContainer","self","parentNode","document","getElementById","span","updateImgSize","imgDOM","naturalSize","isRefresh","graphBBox","getViewport","getContainer","updateGraphImg","oriImgDOM","remove","destroy","removeChild"],"mappings":"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","sourcesContent":["import { __extends } from \"tslib\";\nimport Base from '../base';\nimport isString from '@antv/util/lib/is-string';\nimport createDOM from '@antv/dom-util/lib/create-dom';\nimport modifyCSS from '@antv/dom-util/lib/modify-css';\nimport isNil from '@antv/util/lib/is-nil';\nimport { mat3 } from '@antv/matrix-util';\nimport { applyMatrix } from '../../util/math';\n\nfunction getImgNaturalDimension(img, callback) {\n  var nWidth, nHeight;\n\n  if (img.naturalWidth) {\n    // 现代浏览器\n    nWidth = img.naturalWidth;\n    nHeight = img.naturalHeight;\n  } else {\n    // IE6/7/8\n    var image_1 = new Image();\n    image_1.src = img.src;\n\n    image_1.onload = function () {\n      callback === null || callback === void 0 ? void 0 : callback(image_1.width, image_1.height);\n    };\n  }\n\n  return [nWidth, nHeight];\n}\n\nvar ImageMiniMap =\n/** @class */\nfunction (_super) {\n  __extends(ImageMiniMap, _super);\n\n  function ImageMiniMap() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ImageMiniMap.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-minimap',\n      viewportClassName: 'g6-minimap-viewport',\n      width: 200,\n      delegateStyle: {\n        fill: '#40a9ff',\n        stroke: '#096dd9'\n      },\n      refresh: true\n    };\n  };\n\n  ImageMiniMap.prototype.getEvents = function () {\n    return {\n      beforepaint: 'updateViewport',\n      beforeanimate: 'disableRefresh',\n      afteranimate: 'enableRefresh',\n      viewportchange: 'disableOneRefresh'\n    };\n  }; // 若是正在进行动画，不刷新缩略图\n\n\n  ImageMiniMap.prototype.disableRefresh = function () {\n    this.set('refresh', false);\n  };\n\n  ImageMiniMap.prototype.enableRefresh = function () {\n    this.set('refresh', true);\n    this.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.disableOneRefresh = function () {\n    this.set('viewportChange', true);\n  };\n\n  ImageMiniMap.prototype.initViewport = function () {\n    var _this = this;\n\n    var cfgs = this._cfgs; // cWidth and cHeight are the width and height of the minimap's container\n\n    var graph = cfgs.graph;\n    if (this.destroyed) return;\n    var containerDOM = this.get('container');\n    var viewport = createDOM(\"<div class=\" + cfgs.viewportClassName + \"\\n      style='position:absolute;\\n        left:0;\\n        top:0;\\n        box-sizing:border-box;\\n        border: 2px solid #1980ff'>\\n      </div>\"); // 计算拖拽水平方向距离\n\n    var x = 0; // 计算拖拽垂直方向距离\n\n    var y = 0; // 是否在拖拽minimap的视口\n\n    var dragging = false; // 缓存viewport当前对于画布的x\n\n    var left = 0; // 缓存viewport当前对于画布的y\n\n    var top = 0; // 缓存viewport当前宽度\n\n    var width = 0; // 缓存viewport当前高度\n\n    var height = 0;\n    var ratio = 0;\n    var zoom = 0;\n    containerDOM.addEventListener('mousedown', function (e) {\n      cfgs.refresh = false;\n\n      if (e.target !== viewport) {\n        return;\n      } // 如果视口已经最大了，不需要拖拽\n\n\n      var style = viewport.style;\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      if (width > cWidth || height > cHeight) {\n        return;\n      }\n\n      zoom = graph.getZoom();\n      ratio = _this.get('ratio');\n      dragging = true;\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mousemove', function (e) {\n      if (!dragging || isNil(e.clientX) || isNil(e.clientY)) {\n        return;\n      }\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      var style = viewport.style;\n      left = parseInt(style.left, 10);\n      top = parseInt(style.top, 10);\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n      var dx = x - e.clientX;\n      var dy = y - e.clientY; // 若视口移动到最左边或最右边了,仅移动到边界\n\n      if (left - dx < 0) {\n        dx = left;\n      } else if (left - dx + width >= cWidth) {\n        dx = 0;\n      } // 若视口移动到最上或最下边了，仅移动到边界\n\n\n      if (top - dy < 0) {\n        dy = top;\n      } else if (top - dy + height >= cHeight) {\n        dy = 0;\n      }\n\n      left -= dx;\n      top -= dy; // 先移动视口，避免移动到边上以后出现视口闪烁\n\n      modifyCSS(viewport, {\n        left: left + \"px\",\n        top: top + \"px\"\n      }); // graph 移动需要偏移量 dx/dy * 缩放比例才会得到正确的移动距离\n\n      graph.translate(dx * zoom / ratio, dy * zoom / ratio);\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mouseleave', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    containerDOM.addEventListener('mouseup', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    this.set('viewport', viewport);\n    containerDOM.appendChild(viewport);\n  };\n  /**\n   * 更新 viewport 视图\n   */\n\n\n  ImageMiniMap.prototype.updateViewport = function () {\n    if (this.destroyed) return;\n    var ratio = this.get('ratio');\n    var cWidth = this.get('width');\n    var cHeight = this.get('height');\n    var graph = this.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphWidth / graphHeight;\n    var graphGroup = graph.getGroup(); // 主图的 bbox（矩阵变换相关的 bbox）\n\n    var graphCanvasBBox = graphGroup.getCanvasBBox(); // 扩展 graphBBox 到和 graphWidth / graphHeight 等比\n\n    var graphCanvasBBoxMean = [(graphCanvasBBox.minX + graphCanvasBBox.maxX) / 2, (graphCanvasBBox.minY + graphCanvasBBox.maxY) / 2];\n    var graphCanvasBBoxSize = [graphCanvasBBox.maxX - graphCanvasBBox.minX, graphCanvasBBox.maxY - graphCanvasBBox.minY];\n    var expandedGraphCanvasBBox = {\n      centerX: graphCanvasBBoxMean[0],\n      centerY: graphCanvasBBoxMean[1],\n      width: 0,\n      height: 0,\n      minX: 0,\n      minY: 0\n    };\n\n    if (graphCanvasBBox[0] / graphCanvasBBox[1] > aspectRatio) {\n      expandedGraphCanvasBBox.width = graphCanvasBBoxSize[0];\n      expandedGraphCanvasBBox.height = expandedGraphCanvasBBox.width / aspectRatio;\n    } else {\n      expandedGraphCanvasBBox.height = graphCanvasBBoxSize[1];\n      expandedGraphCanvasBBox.width = expandedGraphCanvasBBox.height * aspectRatio;\n    }\n\n    expandedGraphCanvasBBox.minX = graphCanvasBBoxMean[0] - expandedGraphCanvasBBox.width / 2;\n    expandedGraphCanvasBBox.minY = graphCanvasBBoxMean[1] - expandedGraphCanvasBBox.height / 2;\n    var graphMatrix = graphGroup.getMatrix();\n    if (!graphMatrix) graphMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var invertGraphMatrix = mat3.invert([], graphMatrix);\n    var minXY = applyMatrix({\n      x: expandedGraphCanvasBBox.minX,\n      y: expandedGraphCanvasBBox.minY\n    }, invertGraphMatrix); // 扩展 graphBBox 后的 bbox 的左上角对应的 canvas container 坐标\n\n    var topLeft = graph.getCanvasByPoint(minXY.x, minXY.y);\n    var viewport = this.get('viewport');\n\n    if (!viewport) {\n      this.initViewport();\n    } // Viewport 与 minimap container 的比例 =  Graph container 与 expandedGraphBBox 比例\n\n\n    var vpToMc = graphWidth / expandedGraphCanvasBBox.width; // viewport 宽高 = vpToMc * minimap container 宽高\n\n    var width = vpToMc * cWidth;\n    var height = vpToMc * cHeight; // vierport 左上角到 minimap container 的距离 / minimap container 宽高\n    // = 主图 expandedBBox 左上角 canvas container 坐标距离 / expandedBBox 宽高\n\n    var left = cWidth * -topLeft.x / expandedGraphCanvasBBox.width;\n    var top = cHeight * -topLeft.y / expandedGraphCanvasBBox.height;\n    var right = left + width;\n    var bottom = top + height;\n\n    if (left < 0) {\n      width += left;\n      left = 0;\n    }\n\n    if (right > cWidth) {\n      width = width - (right - cWidth);\n    }\n\n    if (top < 0) {\n      height += top;\n      top = 0;\n    }\n\n    if (bottom > cHeight) {\n      height = height - (bottom - cHeight);\n    } // 缓存目前缩放比，在移动 minimap 视窗时就不用再计算大图的移动量\n\n\n    this.set('ratio', ratio);\n    var correctLeft = left + \"px\";\n    var correctTop = top + \"px\";\n    modifyCSS(viewport, {\n      left: correctLeft,\n      top: correctTop,\n      width: width + \"px\",\n      height: height + \"px\"\n    });\n  };\n\n  ImageMiniMap.prototype.init = function () {\n    this.initContainer();\n  };\n  /**\n   * 初始化 Minimap 的容器\n   */\n\n\n  ImageMiniMap.prototype.initContainer = function () {\n    var self = this;\n    var graph = self.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphHeight / graphWidth;\n    var className = self.get('className');\n    var parentNode = self.get('container'); // size of the minimap's container\n\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    if (!cWidth && !cHeight) {\n      cWidth = 200;\n    }\n\n    if (cWidth) {\n      cHeight = aspectRatio * cWidth;\n      self.set('height', cHeight);\n    } else {\n      cWidth = 1 / aspectRatio * cHeight;\n      self.set('width', cWidth);\n    }\n\n    var container = createDOM(\"<div class='\" + className + \"' style='width: \" + cWidth + \"px; height: \" + cHeight + \"px; overflow: hidden; position: relative;'></div>\");\n\n    if (isString(parentNode)) {\n      parentNode = document.getElementById(parentNode);\n    }\n\n    if (parentNode) {\n      parentNode.appendChild(container);\n    } else {\n      graph.get('container').appendChild(container);\n    }\n\n    self.set('container', container);\n    var containerDOM = createDOM(\"<div class=\\\"g6-minimap-container\\\" style=\\\"position: relative; width: 100%; height: 100%; text-align: center; display: table;\\\"></div>\");\n    container.appendChild(containerDOM);\n    var span = createDOM(\"<span style=\\\"display: table-cell; vertical-align: middle; \\\"></span>\");\n    containerDOM.appendChild(span);\n    self.set('containerDOM', containerDOM);\n    self.set('containerSpan', span);\n    var img = createDOM(\"<img alt=\\\"\\\" src=\\\"\" + this.get('graphImg') + \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\");\n    self.set('imgDOM', img);\n    self.updateImgSize();\n    span.appendChild(img);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.updateImgSize = function () {\n    var self = this;\n    var imgDOM = self.get('imgDOM');\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    imgDOM.onload = function () {\n      var naturalSize = getImgNaturalDimension(imgDOM);\n\n      if (naturalSize[0] > naturalSize[1]) {\n        imgDOM.width = cWidth;\n      } else {\n        imgDOM.height = cHeight;\n      }\n    };\n  };\n\n  ImageMiniMap.prototype.updateCanvas = function () {\n    // 如果是在动画，则不刷新视图\n    var isRefresh = this.get('refresh');\n\n    if (!isRefresh) {\n      return;\n    }\n\n    var graph = this.get('graph');\n\n    if (graph.get('destroyed')) {\n      return;\n    } // 如果是视口变换，也不刷新视图，但是需要重置视口大小和位置\n\n\n    if (this.get('viewportChange')) {\n      this.set('viewportChange', false);\n      this.updateViewport();\n    }\n\n    var cWidth = this.get('width');\n    var graphBBox = graph.get('canvas').getCanvasBBox();\n    var width = graphBBox.width;\n    var ratio = cWidth / width; // // 更新minimap视口\n\n    this.set('ratio', ratio);\n    this.updateViewport();\n  };\n  /**\n   * 获取minimap的窗口\n   * @return {HTMLElement} 窗口的dom实例\n   */\n\n\n  ImageMiniMap.prototype.getViewport = function () {\n    return this.get('viewport');\n  };\n  /**\n   * 获取minimap的容器dom\n   * @return {HTMLElement} dom\n   */\n\n\n  ImageMiniMap.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  ImageMiniMap.prototype.updateGraphImg = function (img) {\n    var self = this;\n    var oriImgDOM = self.get('imgDOM');\n    oriImgDOM.remove();\n    self.set('graphImg', img);\n    var imgDOM = createDOM(\"<img alt=\\\"\\\" src=\\\"\" + img + \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\");\n    self.set('imgDOM', imgDOM);\n    imgDOM.src = img;\n    self.updateImgSize();\n    var span = self.get('containerSpan');\n    span.appendChild(imgDOM);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.destroy = function () {\n    var container = this.get('container');\n    container.parentNode.removeChild(container);\n  };\n\n  return ImageMiniMap;\n}(Base);\n\nexport default ImageMiniMap;"]},"metadata":{},"sourceType":"module"}