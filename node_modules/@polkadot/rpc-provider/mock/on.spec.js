"use strict";

var _create = require("@polkadot/types/create");

var _ = require(".");

// Copyright 2017-2020 @polkadot/rpc-provider authors & contributors
// SPDX-License-Identifier: Apache-2.0
describe('on', () => {
  const registry = new _create.TypeRegistry();
  let mock;
  beforeEach(() => {
    mock = new _.MockProvider(registry);
  });
  it('it emits both connected and disconnected events', done => {
    const events = {
      connected: false,
      disconnected: false
    };

    const handler = type => {
      mock.on(type, () => {
        events[type] = true;

        if (Object.values(events).filter(value => value).length === 2) {
          done();
        }
      });
    };

    handler('connected');
    handler('disconnected');
  });
});