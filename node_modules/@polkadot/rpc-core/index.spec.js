"use strict";

var _mock = require("@polkadot/rpc-provider/mock");

var _create = require("@polkadot/types/create");

var _util = require("@polkadot/util");

var _ = require(".");

// Copyright 2017-2020 @polkadot/rpc-core authors & contributors
// SPDX-License-Identifier: Apache-2.0
describe('Api', () => {
  const registry = new _create.TypeRegistry();
  it('requires a provider with a send method', () => {
    expect(() => new _.RpcCore('234', registry, {})).toThrow(/Expected Provider/);
  });
  it('allows for the definition of user RPCs', () => {
    const rpc = new _.RpcCore('567', registry, new _mock.MockProvider(registry), {
      testing: {
        foo: {
          description: 'foo',
          params: [{
            name: 'bar',
            type: 'u32'
          }],
          type: 'Balance'
        }
      }
    }); // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access

    expect((0, _util.isFunction)(rpc.testing.foo)).toBe(true);
    expect(rpc.sections.includes('testing')).toBe(true);
    expect(rpc.mapping.get('testing_foo')).toEqual({
      description: 'foo',
      isSubscription: false,
      jsonrpc: 'testing_foo',
      method: 'foo',
      params: [{
        name: 'bar',
        type: 'u32'
      }],
      section: 'testing',
      type: 'Balance'
    });
  });
});